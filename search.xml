<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Medium | éè®¢é˜…ä¸‹é˜…è¯»æ–‡ç« </title>
    <url>/posts/40149/</url>
    <content><![CDATA[<p>åœ¨ä¸ç”¨è®¢é˜…çš„æƒ…å†µä¸‹ï¼Œä¸å—é™åˆ¶çš„é˜…è¯»æ–‡ç« ï¼Œæˆ‘ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ PC è¿›è¡Œé˜…è¯»ï¼Œå› ä¸ºå®½å±çœ‹ä¸œè¥¿ï¼Œæ¯”è¾ƒçˆ½ã€‚<span id="more"></span>åˆ—ä¸¾ä¸‹æ–¹æ³•</p>
<h3 id="1-chrome-ä½¿ç”¨æ— ç—•æ¨¡å¼"><a href="#1-chrome-ä½¿ç”¨æ— ç—•æ¨¡å¼" class="headerlink" title="1 chrome ä½¿ç”¨æ— ç—•æ¨¡å¼"></a>1 chrome ä½¿ç”¨æ— ç—•æ¨¡å¼</h3><p>å¤åˆ¶é“¾æ¥åœ°å€åˆ°æ— ç—•çª—å£æ‰“å¼€ï¼Œå³å¯æ­£å¸¸é˜…è¯»ã€‚</p>
<p>ç¼ºç‚¹ï¼šæ¯æ¬¡é˜…è¯»æ–‡ç« éƒ½éœ€è¦èµ°è¿™æ ·ä¸€ç¯‡æµç¨‹ï¼Œæœ‰äº›æµªè´¹åŠŸå¤«ï¼Œå¯¹äºæˆ‘è¿™æ ·çš„ <code>medium</code> é‡åº¦ç”¨æˆ·ï¼Œå¿ƒæ€æ˜¯è¦å´©æ‰çš„ã€‚ä½†æ˜¯å¦‚æœåªæ˜¯å¶å°”é˜…è¯»ä¸‹ï¼Œå¯ä»¥è¿™æ ·æ“ä½œã€‚</p>
<h3 id="2-ä½¿ç”¨æ’ä»¶ï¼šmedium-unlimited"><a href="#2-ä½¿ç”¨æ’ä»¶ï¼šmedium-unlimited" class="headerlink" title="2 ä½¿ç”¨æ’ä»¶ï¼šmedium-unlimited"></a>2 ä½¿ç”¨æ’ä»¶ï¼šmedium-unlimited</h3><p>åœ°å€ï¼š<a href="https://github.com/manojVivek/medium-unlimited">https://github.com/manojVivek/medium-unlimited</a></p>
<p>å®‰è£…åï¼Œå³å¯é¡ºæ»‘æµç•…çš„äº«å—é˜…è¯»ã€‚</p>
<p>ç¼ºç‚¹ï¼šå—æµè§ˆå™¨é™åˆ¶ï¼Œå…¶å®è¿™ä¸ªä¹Ÿä¸ç®—æ˜¯ä»€ä¹ˆç¼ºç‚¹ï¼Œæ¯•ç«Ÿ <code>chrome</code> å’Œ <code>firefox</code> ç®—æ˜¯å¾ˆä¸é”™çš„æµè§ˆå™¨äº†ã€‚</p>
]]></content>
      <categories>
        <category>æ‚è®°</category>
      </categories>
      <tags>
        <tag>Medium</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac-è§£é”ç½‘æ˜“äº‘ç½®ç°éŸ³ä¹</title>
    <url>/posts/41185/</url>
    <content><![CDATA[<p>æˆ‘çš„ç½‘æ˜“äº‘é»‘èƒ¶ä¼šå‘˜ VIP åˆ°æœŸäº†ï¼Œæš‚æ—¶ä¸æƒ³ç»­æœŸï¼Œæ‰¾äº†ä¸ªæ³•å­è§£é”ç½®ç°çš„æ­Œï¼Œåé¢å†æƒ³æƒ³ç»­æœŸçš„äº‹æƒ…ã€‚è§£é”çš„åŸç†æ¯”è¾ƒç®€å•ï¼ŒåŠ«æŒç½‘æ˜“äº‘éŸ³ä¹å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ‰“åˆ°ä»£ç†æœåŠ¡ä¸­å»ï¼Œä»£ç†æœåŠ¡ä¼šè‡ªåŠ¨è§£æï¼Œå¦‚æœæœ‰äº›æ­Œå¬ä¸äº†ï¼Œä¼šè‡ªåŠ¨è¯·æ±‚å…¶ä»–éŸ³æºè¿›è¡Œæ›¿æ¢ï¼Œè¿™ä¸ªå¤§å®¶éƒ½æ‡‚çš„ã€‚ä¸‹é¢è®°å½•ä¸‹æ­¥éª¤ã€‚<span id="more"></span></p>
<p>å·¥å…·å’Œå¯¹åº”çš„ç‰ˆæœ¬ï¼š</p>
<ul>
<li>ç½‘æ˜“äº‘éŸ³ä¹ for macï¼š2.0.0 (690) ä¸‹è½½åœ°å€ï¼š<a href="http://d1.music.126.net/dmusic/NeteaseMusic_2.0.0_690_web.dmg">http://d1.music.126.net/dmusic/NeteaseMusic_2.0.0_690_web.dmg</a></li>
<li>mac: 10.15.5 (19F101)</li>
<li>node: v10.16.3</li>
<li>Proxifier for mac: v2.26 ä¸‹è½½åœ°å€: <a href="https://xclient.info/s/proxifier.html">https://xclient.info/s/proxifier.html</a></li>
</ul>
<h3 id="1-ä¸‹è½½è§£é”é¡¹ç›®"><a href="#1-ä¸‹è½½è§£é”é¡¹ç›®" class="headerlink" title="1 ä¸‹è½½è§£é”é¡¹ç›®"></a>1 ä¸‹è½½è§£é”é¡¹ç›®</h3><p>Githubï¼š<a href="https://github.com/nondanee/UnblockNeteaseMusic">https://github.com/nondanee/UnblockNeteaseMusic</a></p>
<p>è¿™é‡Œç…§ç€æ–‡æ¡£å…‹éš†ï¼Œç„¶ååŒå‡»å®‰è£…å…¶ä¸­çš„ ca.crt å¹¶è®¾ç½®ä¿¡ä»»ã€‚å› ä¸ºåé¢è¦è·‘æœåŠ¡ï¼Œæ–°å»ºäº† m.sh å¹¶èµ‹äºˆå¯æ‰§è¡Œçš„æƒé™ï¼Œç›´æ¥ç”¨ m.sh ä»£ç å¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">pattern=&#x27;[(].*[)]&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ³¨æ„è¿™é‡Œæ”¹æˆè‡ªå·±çš„ç›®å½•åœ°å€</span></span><br><span class="line">path=~/Documents/githubpro/UnblockNeteaseMusic/app.js</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œæ˜¯è·å– music.163.com çš„ IP åœ°å€</span></span><br><span class="line">ip=`ping music.163.com -c 1 | grep -o $pattern`</span><br><span class="line">ip=$&#123;ip:1&#125;</span><br><span class="line">ip=$&#123;ip%?&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œçš„ç«¯å£å·è‡ªå·±å¯ä»¥è°ƒæ•´</span></span><br><span class="line">sudo node app.js -p 63455:7777 -f $ip</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨åŒ…å« m.sh çš„ç›®å½•ä¸‹æ‰§è¡Œ m.sh</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./m.sh</span></span><br><span class="line"></span><br><span class="line">HTTP Server running @ http://0.0.0.0:63455</span><br><span class="line">HTTPS Server running @ http://0.0.0.0:7777</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šping music.163.com å‡ºæ¥çš„ IP åœ°å€æœ‰å¯èƒ½æ˜¯å˜åŒ–çš„ï¼Œso å¦‚æœæ­Œå¬ä¸äº†ï¼Œé‡æ–°è¿è¡ŒæœåŠ¡å³å¯ã€‚</p>
<h3 id="2-ä»£ç†è®¾ç½®"><a href="#2-ä»£ç†è®¾ç½®" class="headerlink" title="2 ä»£ç†è®¾ç½®"></a>2 ä»£ç†è®¾ç½®</h3><p>å› ä¸ºç½‘æ˜“äº‘ mac çš„å®¢æˆ·ç«¯æ²¡æœ‰å¯ä»¥è®¾ç½®ä»£ç†çš„åœ°æ–¹ï¼Œæœ‰äº›å‚²å¨‡ï¼Œé‚£å°±ä½¿ç”¨ Proxifier æ¥è§£å†³å§ã€‚</p>
<p>2.1 æ·»åŠ  Proxiesï¼Œåœ°å€å†™ 127.0.0.1 ç«¯å£å¯¹åº”ä¸Šé¢ï¼Œä¸º 63455<br>2.2 æ·»åŠ  Rules</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Applications ä¸º NeteaseMusic;com.apple.WebKit.Networking</span><br><span class="line"></span><br><span class="line">Target Hosts ä¸º *.music<span class="number">.163</span>.com;*.music<span class="number">.126</span>.net;*.netease.com;music<span class="number">.163</span>.com;interface.music<span class="number">.163</span>.com</span><br><span class="line"></span><br><span class="line">Action ä¸ºä¸Šé¢åˆ›å»ºçš„ï¼Œå³ Proxy HTTPS <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">63455</span></span><br></pre></td></tr></table></figure>

<p>2.3 DNS é…ç½®<br>åœ¨ Resolve hostnames through proxy å‰é¢æ‰“å‹¾</p>
<p>å¥½äº†ï¼Œä»£ç†é…ç½®å¥½äº†ã€‚</p>
<h3 id="3-é‡å¯ç½‘æ˜“äº‘éŸ³ä¹"><a href="#3-é‡å¯ç½‘æ˜“äº‘éŸ³ä¹" class="headerlink" title="3 é‡å¯ç½‘æ˜“äº‘éŸ³ä¹"></a>3 é‡å¯ç½‘æ˜“äº‘éŸ³ä¹</h3><p>æœç´¢ JAY çš„æ­Œï¼Œä¹‹å‰ç½®ç°çš„æ­Œå¯ä»¥æ’­æ”¾äº†ï¼Œä¾‹å¦‚å¬ä»¥çˆ¶ä¹‹åï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">TUNNEL &gt; localhost:63455</span><br><span class="line">MITM &gt; music.163.com</span><br><span class="line">MITM &gt; music.163.com</span><br><span class="line">[1400394244] ä»¥çˆ¶ä¹‹å (Live)</span><br><span class="line">http://sz.sycdn.kuwo.cn/cadd34fd7d42d643db5257b182f07ad5/5f57a6b9/resource/n1/69/17/1415834243.mp3</span><br><span class="line">MITM &gt; music.163.com</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¿™ç§æ–¹å¼å¬æ­Œå‘¢ï¼Œå› ä¸ºè¦è·‘æœåŠ¡å’Œä»£ç†ï¼Œso æœ€å¥½è¿˜æ˜¯ç”¨è„šæœ¬æ‰“å¼€ç½‘æ˜“äº‘éŸ³ä¹ï¼Œçœäº‹ã€‚</p>
]]></content>
      <categories>
        <category>å±é™©è¾¹ç¼˜</category>
      </categories>
      <tags>
        <tag>Mac</tag>
      </tags>
  </entry>
  <entry>
    <title>èµ„æºåŠ é€Ÿç³»åˆ—ä¹‹ Github</title>
    <url>/posts/19128/</url>
    <content><![CDATA[<h3 id="1-æ•…äº‹å‘ç”ŸèƒŒæ™¯"><a href="#1-æ•…äº‹å‘ç”ŸèƒŒæ™¯" class="headerlink" title="1 æ•…äº‹å‘ç”ŸèƒŒæ™¯"></a>1 æ•…äº‹å‘ç”ŸèƒŒæ™¯</h3><p>è¿™æ®µæ—¶é—´ï¼Œgithub çš„ clone å¿«ææ­»äººäº†ï¼Œé€Ÿåº¦æ…¢çš„ä¸€é€¼ï¼Œä¸Šç½‘çœ‹äº†å‡ ç§æ–¹æ³•<span id="more"></span></p>
<ol>
<li>æ”¹ hostsï¼ˆäº²æµ‹å·®å¼‚ä¸å¤§ï¼‰</li>
<li>å…ˆæ‹‰åˆ° giteeï¼Œå†ä» gitee å…‹éš†</li>
<li>èµ°ä»£ç†</li>
</ol>
<p>æˆ‘ä½¿ç”¨äº†ä»£ç†ï¼Œç¬¬äºŒç§æ–¹æ³•ä¸é€‚åˆæˆ‘ï¼Œä¸ºä»€ä¹ˆï¼Œä¸€ä¸ªæ˜¯è‡ªå·±æ‡’ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯å®‰è£…æŸäº›è½¯ä»¶ï¼Œè¿™äº›è½¯ä»¶ç‰¹ä¹ˆçš„è‡ªå·±å†™æ­»äº† clone åœ°å€ï¼ˆä¸€èˆ¬éƒ½æ˜¯ä¸èƒ½æ”¹çš„ï¼‰ï¼Œæ‰€ä»¥æœæ–­æŠ›å¼ƒï¼Œç›´å¥”ç¬¬ä¸‰ç§æ–¹å¼</p>
<h3 id="2-æ‰§è¡Œæ–¹æ³•"><a href="#2-æ‰§è¡Œæ–¹æ³•" class="headerlink" title="2 æ‰§è¡Œæ–¹æ³•"></a>2 æ‰§è¡Œæ–¹æ³•</h3><p><strong>èµ°ä»£ç†ï¼Œä½ ç‰¹ä¹ˆçš„éœ€è¦ä¸ªæ¢¯å­å‘€</strong></p>
<p>æˆ‘ä½¿ç”¨çš„æ˜¯ ss æœåŠ¡ï¼Œçœ‹å›¾è¯´è¯</p>
<p><img src="/posts/19128/addGithubSpeed_ssproxy.png" alt="ssproxy.png"></p>
<p>å¾ˆæ¸…æ™°ï¼Œæ²¡æ¯›ç—…ï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ­¥</p>
<p>ä¸åŒçš„åè®®ä»–çš„ä»£ç†é…ç½®å„ä¸ç›¸åŒ</p>
<ul>
<li><code>core.gitproxy</code>Â  ç”¨äº Â <code>git://</code>Â  åè®®</li>
<li><code>http.proxy</code>Â  ç”¨äº Â <code>http://</code>Â  åè®®</li>
<li><code>https.proxy</code>Â  ç”¨äº Â <code>https://</code>Â  åè®®</li>
</ul>
<p>å…¨å±€è®¾ç½® git çš„é…ç½®</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"># è¿™é‡Œæ˜¯é’ˆå¯¹ http å’Œ https åè®®çš„</span><br><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> http<span class="variable">.proxy</span> &#x27;socks5:<span class="comment">//127.0.0.1:1086&#x27;</span></span><br><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> https<span class="variable">.proxy</span> &#x27;socks5:<span class="comment">//127.0.0.1:1086&#x27;</span></span><br><span class="line"></span><br><span class="line"># è¿™é‡Œæ˜¯é’ˆå¯¹ git åè®®çš„</span><br><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> core<span class="variable">.gitproxy</span> <span class="string">&quot;git-proxy&quot;</span></span><br><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> socks<span class="variable">.proxy</span> &#x27;socks5:<span class="comment">//127.0.0.1:1086&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®å®Œåï¼Œçœ‹ä¸‹ git çš„å…¨å±€é…ç½® <code>git config --global --list</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user.name=xxxx</span><br><span class="line">user.email=xxxxx@gmail.com</span><br><span class="line">core.excludesfile=/Users/kycool/.gitignore_global</span><br><span class="line">core.gitproxy=git-proxy</span><br><span class="line">difftool.sourcetree.cmd=opendiff <span class="string">&quot;$LOCAL&quot;</span> <span class="string">&quot;$REMOTE&quot;</span></span><br><span class="line">difftool.sourcetree.path=</span><br><span class="line">mergetool.sourcetree.cmd=/Applications/Sourcetree.app/Contents/Resources/opendiff-w.sh <span class="string">&quot;$LOCAL&quot;</span> <span class="string">&quot;$REMOTE&quot;</span> -ancestor <span class="string">&quot;$BASE&quot;</span> -merge <span class="string">&quot;$MERGED&quot;</span></span><br><span class="line">mergetool.sourcetree.trustexitcode=true</span><br><span class="line">commit.template=/Users/kycool/.stCommitMsg</span><br><span class="line">http.proxy=socks5://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1086</span></span><br><span class="line">https.proxy=socks5://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1086</span></span><br><span class="line">socks.proxy=socks5://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1086</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœåé¢æƒ³åˆ æ‰è¿™äº›é…ç½®ï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">git config --<span class="keyword">global</span> --unset é”®</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ  ssh é…ç½®ï¼Œåœ¨ <code>.ssh/config</code> æ–‡ä»¶ä¸­æ·»åŠ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">HostName github.com</span><br><span class="line">User git</span><br><span class="line">port <span class="number">22</span></span><br><span class="line">UseKeychain yes</span><br><span class="line">IdentityFile /Users/kycool/.ssh/id_rsa</span><br><span class="line">ProxyCommand nc -v -x <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1086</span> %h %p</span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œåˆ°äº«å—çš„æ—¶å€™äº†ï¼Œæˆ‘æµ‹è¯•äº† git åè®®å’Œ https åè®®</p>
<h3 id="3-å…‹éš†æµ‹è¯•"><a href="#3-å…‹éš†æµ‹è¯•" class="headerlink" title="3 å…‹éš†æµ‹è¯•"></a>3 å…‹éš†æµ‹è¯•</h3><p><strong>git åè®®</strong>: clone antd-pro</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ git clone git@github.com:ant-design/ant-design-pro.git</span><br><span class="line">Cloning into <span class="string">&#x27;ant-design-pro&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: <span class="number">31</span>, done.</span><br><span class="line">remote: Counting objects: <span class="number">100</span>% (<span class="number">31</span>/<span class="number">31</span>), done.</span><br><span class="line">remote: Compressing objects: <span class="number">100</span>% (<span class="number">29</span>/<span class="number">29</span>), done.</span><br><span class="line">remote: Total <span class="number">18085</span> (delta <span class="number">9</span>), reused <span class="number">14</span> (delta <span class="number">2</span>), pack-reused <span class="number">18054</span></span><br><span class="line">Receiving objects: <span class="number">100</span>% (<span class="number">18085</span>/<span class="number">18085</span>), <span class="number">6.02</span> MiB | <span class="number">299.00</span> KiB/s, done.</span><br><span class="line">Resolving deltas: <span class="number">100</span>% (<span class="number">12239</span>/<span class="number">12239</span>), done.</span><br></pre></td></tr></table></figure>

<p>ä»æ¥æ²¡æœ‰è§è¿‡çš„é€Ÿåº¦ï¼Œå‡ ä¹æ˜¯ç§’æ€</p>
<p><strong>https åè®®</strong>: hexo init mm</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ hexo init mm</span><br><span class="line">INFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git</span><br><span class="line">Cloning into <span class="string">&#x27;/Users/kycool/Documents/test/mm&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: <span class="number">30</span>, done.</span><br><span class="line">remote: Counting objects: <span class="number">100</span>% (<span class="number">30</span>/<span class="number">30</span>), done.</span><br><span class="line">remote: Compressing objects: <span class="number">100</span>% (<span class="number">24</span>/<span class="number">24</span>), done.</span><br><span class="line">remote: Total <span class="number">161</span> (delta <span class="number">12</span>), reused <span class="number">12</span> (delta <span class="number">4</span>), pack-reused <span class="number">131</span></span><br><span class="line">Receiving objects: <span class="number">100</span>% (<span class="number">161</span>/<span class="number">161</span>), <span class="number">31.79</span> KiB | <span class="number">206.00</span> KiB/s, done.</span><br><span class="line">Resolving deltas: <span class="number">100</span>% (<span class="number">74</span>/<span class="number">74</span>), done.</span><br><span class="line">Submodule <span class="string">&#x27;themes/landscape&#x27;</span> (https://github.com/hexojs/hexo-theme-landscape.git) registered <span class="keyword">for</span> path <span class="string">&#x27;themes/landscape&#x27;</span></span><br><span class="line">Cloning into <span class="string">&#x27;/Users/kycool/Documents/test/mm/themes/landscape&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: <span class="number">9</span>, done.</span><br><span class="line">remote: Counting objects: <span class="number">100</span>% (<span class="number">9</span>/<span class="number">9</span>), done.</span><br><span class="line">remote: Compressing objects: <span class="number">100</span>% (<span class="number">9</span>/<span class="number">9</span>), done.</span><br><span class="line">remote: Total <span class="number">1063</span> (delta <span class="number">1</span>), reused <span class="number">1</span> (delta <span class="number">0</span>), pack-reused <span class="number">1054</span></span><br><span class="line">Receiving objects: <span class="number">100</span>% (<span class="number">1063</span>/<span class="number">1063</span>), <span class="number">3.22</span> MiB | <span class="number">217.00</span> KiB/s, done.</span><br><span class="line">Resolving deltas: <span class="number">100</span>% (<span class="number">582</span>/<span class="number">582</span>), done.</span><br><span class="line">Submodule path <span class="string">&#x27;themes/landscape&#x27;</span>: checked out <span class="string">&#x27;73a23c51f8487cfcd7c6deec96ccc7543960d350&#x27;</span></span><br><span class="line">INFO  Install dependencies</span><br></pre></td></tr></table></figure>

<p>é€Ÿåº¦å’Œä¸Šé¢ä¸€ä¸ªå‡ ä¹ä¸ç›¸ä¸Šä¸‹ã€‚</p>
<p>æµ‹è¯•çš„é€Ÿåº¦æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œæˆ‘è§‚å¯Ÿæœ‰ç¬é—´è·‘åˆ° 600 KiB&#x2F;sï¼Œæˆ‘ä¼°æ‘¸ç€å¦‚æœä»£ç†æœåŠ¡å™¨çš„å¸¦å®½ç‰›é€¼çš„è¯ï¼Œé‚£é€Ÿåº¦æƒ³éƒ½ä¸æ•¢æƒ³ã€‚</p>
<h3 id="4-ä¸è¶³çš„åœ°æ–¹"><a href="#4-ä¸è¶³çš„åœ°æ–¹" class="headerlink" title="4 ä¸è¶³çš„åœ°æ–¹"></a>4 ä¸è¶³çš„åœ°æ–¹</h3><p>è¿™é‡Œé¢çš„å“ªä¸€ç§æ–¹æ³•éƒ½æ˜¯æœ‰äº›ä¸è¶³çš„ï¼Œæ¢¯å­å¶å°”ä¹Ÿä¼šæŠ½é£ï¼Œå› ä¸ºæ˜¯æˆ‘ä¹°çš„åˆ«äººå®¶çš„æœåŠ¡ï¼Œè¿™ç§ä¿éšœä¸èƒ½ä¸»è§‚æ§åˆ¶ï¼ŒæŠ½é£å°±å›åˆ°è§£æ”¾å‰äº†ã€‚</p>
]]></content>
      <categories>
        <category>èµ„æºåŠ é€Ÿ</category>
      </categories>
      <tags>
        <tag>åŠ é€Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ¬åœ°å¼€å‘ä½¿ç”¨ https</title>
    <url>/posts/32953/</url>
    <content><![CDATA[<p>è¿™é˜µå­æœ¬åœ°å¼€å‘æµ‹è¯•ï¼Œéœ€è¦æœ¬åœ°å¯ä»¥ä½¿ç”¨ HTTPS è¯ä¹¦ï¼Œæ‰¾åˆ°äº† <code>mkcert</code> è¿™ä¸ªå‚»ç“œå¼çš„å·¥å…·ï¼ˆ<a href="https://github.com/FiloSottile/mkcert">https://github.com/FiloSottile/mkcert</a>),</p>
<p>mkcert è®¾è®¡å¾ˆç®€å•ï¼Œä¼˜é›…ï¼Œéšè—äº†å‡ ä¹æ‰€æœ‰ç”Ÿæˆ TLS è¯ä¹¦æ‰€å¿…é¡»çš„çŸ¥è¯†ï¼Œå®ƒé€‚ç”¨äºä»»ä½•åŸŸåï¼Œä¸»æœºåï¼ŒIPï¼ŒåŒ…æ‹¬ localhostï¼Œä½†æ˜¯åˆ‡è®°ï¼Œåªèƒ½åœ¨æœ¬åœ°ä½¿ç”¨ã€‚<span id="more"></span></p>
<p>è¯ä¹¦æ˜¯ç”±ä½ è‡ªå·±çš„ç§æœ‰ CA ç­¾å‘ï¼Œå½“ä½ è¿è¡Œ <code>mkcert-install</code> ä¼šè‡ªåŠ¨é…ç½®è¿™äº›ä¿¡ä»»ï¼Œå› æ­¤ï¼Œå½“æµè§ˆå™¨è®¿é—®æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºå®‰å…¨æ ‡è¯†ã€‚</p>
<p>ä¸ OpenSSL ä¸åŒçš„æ˜¯ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªè¯ä¹¦é…ç½®å¾ˆå¤šé€‰é¡¹ã€‚mkcert æœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯ä½œä¸ºå¼€å‘è€…å·¥å…·ï¼Œèšç„¦äºè®©æœ¬åœ°ç¯å¢ƒé…ç½® TLS è¯ä¹¦å˜å¾—ç®€å•é«˜æ•ˆã€‚</p>
<h3 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1 å®‰è£…"></a>1 å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew install mkcert</span><br><span class="line">brew install nss # if you use Firefox</span><br></pre></td></tr></table></figure>

<h3 id="2-ä½¿ç”¨"><a href="#2-ä½¿ç”¨" class="headerlink" title="2 ä½¿ç”¨"></a>2 ä½¿ç”¨</h3><p>æ‚¨éœ€è¦é¦–å…ˆåœ¨ç³»ç»Ÿä¿¡ä»»åº“ä¸­å®‰è£…æœ¬åœ° CA.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mkcert -install</span></span><br><span class="line"></span><br><span class="line">Using the local CA at &quot;/Users/kycool/Library/Application Support/mkcert&quot; âœ¨</span><br><span class="line">The local CA is already installed in the system trust store! ğŸ‘</span><br></pre></td></tr></table></figure>

<p>å®Œæˆåï¼Œå¯ä»¥ç»™è‡ªå·±çš„æœ¬åœ°åŸŸåç”Ÿæˆè¯ä¹¦äº†ï¼Œç”Ÿæˆè¯ä¹¦å¾ˆç®€å•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> mkcert kycooltest.cn <span class="string">&#x27;*.kycooltest.cn&#x27;</span> localhost 127.0.0.1 ::1</span></span><br><span class="line">Using the local CA at &quot;/Users/kycool/Library/Application Support/mkcert&quot; âœ¨</span><br><span class="line"></span><br><span class="line">Created a new certificate valid for the following names ğŸ“œ</span><br><span class="line"> - &quot;kycooltest.cn&quot;</span><br><span class="line"> - &quot;*.kycooltest.cn&quot;</span><br><span class="line"> - &quot;localhost&quot;</span><br><span class="line"> - &quot;127.0.0.1&quot;</span><br><span class="line"> - &quot;::1&quot;</span><br><span class="line"></span><br><span class="line">Reminder: X.509 wildcards only go one level deep, so this won&#x27;t match a.b.kycooltest.cn â„¹ï¸</span><br><span class="line"></span><br><span class="line">The certificate is at &quot;./kycooltest.cn+4.pem&quot; and the key at &quot;./kycooltest.cn+4-key.pem&quot; âœ…</span><br></pre></td></tr></table></figure>

<h3 id="3-éªŒè¯"><a href="#3-éªŒè¯" class="headerlink" title="3 éªŒè¯"></a>3 éªŒè¯</h3><p>æ·»åŠ æœ¬åœ° <code>hosts</code> è®°å½•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> kycooltest.cn</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ  nginx é…ç½®æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen *:<span class="number">443</span> ssl;</span><br><span class="line">    server_name  kycooltest.cn;</span><br><span class="line"></span><br><span class="line">    root /var/www;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /Users/kycool/Documents/caddy/kycooltest.cn+<span class="number">4.</span>pem;</span><br><span class="line">    ssl_certificate_key /Users/kycool/Documents/caddy/kycooltest.cn+<span class="number">4</span>-key.pem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€åœ¨ æµè§ˆå™¨ä¸­æ‰“å¼€ <code>https://kycooltest.cn</code></p>
<p><img src="/posts/32953/mkcert.png" alt="mkcert.png"></p>
]]></content>
      <categories>
        <category>å¼€å‘å·¥å…·</category>
      </categories>
      <tags>
        <tag>https</tag>
      </tags>
  </entry>
  <entry>
    <title>Antdï¼šForm çš„ InitialValues é‡ç½®</title>
    <url>/posts/59046/</url>
    <content><![CDATA[<p>æè¿°ï¼šç¼–è¾‘é¡µé¢ä¸­ <code>Form</code> çš„ <code>InitialValues</code> çš„é‡ç½®</p>
<span id="more"></span>

<h3 id="1-åœºæ™¯æè¿°"><a href="#1-åœºæ™¯æè¿°" class="headerlink" title="1 åœºæ™¯æè¿°"></a>1 åœºæ™¯æè¿°</h3><p>ç®¡ç†åå°çš„é€šç”¨åœºæ™¯ï¼Œåˆ—è¡¨é¡µé¢ï¼Œç„¶åç‚¹å‡»æ–°å»ºæˆ–è€…æ›´æ–°ï¼Œè¿™é‡Œè¯´çš„æ˜¯æ›´æ–°çš„åœºæ™¯ï¼Œå¼‚æ­¥è¯·æ±‚ï¼Œé‡æ–°æ¸²æŸ“è¡¨å•ã€‚</p>
<p>ç®¡ç†åå°ä½¿ç”¨ <code>antd-pro</code> æ­å»ºï¼Œ<code>antd</code> ä½¿ç”¨äº† <code>4.x</code> ç‰ˆæœ¬ï¼Œæ³¨æ„è¿™ä¸ªç‰ˆæœ¬å¯¹ <code>Form</code> åšäº†äº›è°ƒæ•´ã€‚</p>
<p>ç‚¹å‡»æ›´æ–°è¿›å…¥è¡¨å•é¡µé¢ï¼Œæˆ‘è®¾ç½®äº† <code>state</code> çš„åˆå§‹å€¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">state = &#123;</span><br><span class="line">  <span class="attr">initialValues</span>: &#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¼‚æ­¥è¯·æ±‚ï¼Œè¯·æ±‚åˆ°ç»“æœåï¼Œéœ€è¦é‡ç½® <code>initialValues</code>ï¼Œä½†æ˜¯æ ¹æ® <code>antd</code> çš„æ–‡æ¡£</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">initialValue è¡¨å•é»˜è®¤å€¼ï¼Œåªæœ‰åˆå§‹åŒ–ä»¥åŠé‡ç½®æ—¶ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¼‚æ­¥è¯·æ±‚åå¦‚æœé‡æ–° <code>setState(&#123; initialValues &#125;)</code>ï¼Œè¿™æ ·æ˜¯æ— æ•ˆçš„ï¼Œä½ ä¼šçœ‹åˆ°å¯¹åº”çš„è¡¨å•ä¸­æ²¡æœ‰æ•°æ®ï¼Œéƒ½æ˜¯ç©ºçš„ã€‚åªèƒ½é‡ç½®ï¼Œè¿™ç§é—®é¢˜æ€ä¹ˆè§£å†³æ‰</p>
<h3 id="2-é‡ç½®-initialValues"><a href="#2-é‡ç½®-initialValues" class="headerlink" title="2 é‡ç½® initialValues"></a>2 é‡ç½® initialValues</h3><p><strong>2.1 å¦‚æœæ˜¯å‡½æ•°å¼ç»„ä»¶ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ <code>Form.useForm</code> åˆ›å»ºè¡¨å•æ•°æ®åŸŸè¿›è¡Œæ§åˆ¶</strong></p>
<p>ä½¿ç”¨ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [form] = <span class="title class_">Form</span>.<span class="title function_">useForm</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å¼‚æ­¥è¯·æ±‚ä¸­é‡ç½®è¡¨å•åˆå§‹å€¼</span></span><br><span class="line"><span class="title function_">asyncRequest</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">initialValues</span>) =&gt;</span> form.<span class="title function_">setFieldsValue</span>(&#123; initialValues &#125;));</span><br></pre></td></tr></table></figure>

<p><strong>2.2 å¦‚æœæ˜¯åœ¨ class component ä¸‹ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ ref è·å–æ•°æ®åŸŸ</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  formRef = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line"></span><br><span class="line">  UNSAFE_componentWillMount = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨å¼‚æ­¥è¯·æ±‚ä¸­é‡ç½®è¡¨å•åˆå§‹å€¼</span></span><br><span class="line">    <span class="title function_">asyncRequest</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">initialValues</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">formRef</span>.<span class="property">current</span>.<span class="title function_">setFieldsValue</span>(&#123; initialValues &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äº <code>UNSAFE_componentWillMount</code> å£°æ˜å‘¨æœŸå‡½æ•°ï¼Œæœ‰äº›å£°æ˜å‘¨æœŸå‡½æ•°åœ¨æœªæ¥ç‰ˆæœ¬ä¸­ä¼šè¢«ç§»é™¤æˆ–è€…é‡å‘½åï¼Œè¿™ä¸ªå¯ä»¥æµè§ˆ <a href="https://reactjs.org/blog/2018/03/27/update-on-async-rendering.html">https://reactjs.org/blog/2018/03/27/update-on-async-rendering.html</a></p>
<h3 id="3-å®Œæ•´çš„å‚è€ƒç¤ºä¾‹"><a href="#3-å®Œæ•´çš„å‚è€ƒç¤ºä¾‹" class="headerlink" title="3 å®Œæ•´çš„å‚è€ƒç¤ºä¾‹"></a>3 å®Œæ•´çš„å‚è€ƒç¤ºä¾‹</h3><p>è¿™é‡Œæˆ‘ä½¿ç”¨äº†ç±»ç»„ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Form</span>, <span class="title class_">Input</span>, <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&quot;antd&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FairyUploader</span> <span class="keyword">from</span> <span class="string">&quot;@/fairy/components/Uploader&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FairyRichTextEditor</span> <span class="keyword">from</span> <span class="string">&quot;@/fairy/components/RichTextEditor&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;@/utils/store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">CreateUpdateForm</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">create</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">initialValues</span>: &#123;&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  formRef = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">UNSAFE_componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">match</span>.<span class="property">params</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ•°æ®è¯¦æƒ…</span></span><br><span class="line">    <span class="keyword">if</span> (id) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">create</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">      store</span><br><span class="line">        .<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;product/retrieve&quot;</span>,</span><br><span class="line">          <span class="attr">payload</span>: &#123; id &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">initialValues</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">formRef</span>.<span class="property">current</span>.<span class="title function_">setFieldsValue</span>(initialValues);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onFinish = <span class="function">(<span class="params">values</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Success:&quot;</span>, values);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  onFinishFailed = <span class="function">(<span class="params">errorInfo</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Failed:&quot;</span>, errorInfo);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; initialValues, create &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">const</span> formProps = &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;basic&quot;</span>,</span><br><span class="line">      <span class="attr">onFinish</span>: <span class="variable language_">this</span>.<span class="property">onFinish</span>,</span><br><span class="line">      <span class="attr">onFinishFailed</span>: <span class="variable language_">this</span>.<span class="property">onFinishFailed</span>,</span><br><span class="line">      initialValues,</span><br><span class="line">      <span class="attr">ref</span>: <span class="variable language_">this</span>.<span class="property">formRef</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> &#123;<span class="attr">...formProps</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;å§“å&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &quot;<span class="attr">è¯·å¡«å†™å§“å</span>&quot; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;èŒä¸š&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;position&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &quot;<span class="attr">è¯·è¾“å…¥èŒä¸š</span>&quot; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;å¤´åƒ&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;avatar&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &quot;<span class="attr">è¯·ä¸Šä¼ å¤´åƒ</span>&quot; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">FairyUploader</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;æè¿°&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;description&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &quot;<span class="attr">è¯·è¾“å…¥æè¿°</span>&quot; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">FairyRichTextEditor</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">htmlType</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;create ? &quot;ä¿å­˜&quot; : &quot;æ›´æ–°&quot;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4 å°ç»“"></a>4 å°ç»“</h3><ul>
<li><code>antd</code> å¯¹äºå„ç§ä½¿ç”¨åœºæ™¯è¿˜æ˜¯ç»™å‡ºäº†è¯¦ç»†çš„è¯´æ˜å’Œä¾‹å­å‚è€ƒçš„ï¼Œè¿™ä¸ªå¾ˆèµã€‚</li>
<li>ä½¿ç”¨ <code>React</code> çš„å„ç§è­¦å‘Šï¼Œè¿™ä¸ªéœ€è¦è®¤çœŸæ ¹æ®å®˜æ–¹çš„å¼•å¯¼è¿›è¡Œè°ƒæ•´ã€‚</li>
<li>æ ¹æ®ä¸Šé¢çš„å‚è€ƒç¤ºä¾‹å¯ä»¥æƒ³åˆ°å¯¹äºè¿™ç§é€šç”¨çš„æ›´æ–°åˆ›å»ºè¡¨å•ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨é€šç”¨çš„ <code>HOC</code>ï¼Œæ ¹æ®ä¸åŒçš„é…ç½®æ¸²æŸ“å‡ºä¸åŒçš„é¡µé¢ï¼Œè¿™æ ·ä¸€ä¸ªé«˜é˜¶ç»„ä»¶å¯ä»¥è§£å†³æ‰é€šç”¨çš„åˆ›å»ºæ›´æ–°è¡¨å•ã€‚åŒæ ·ï¼Œå¯¹äºåˆ—è¡¨é¡µé¢ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå…¶å®è¯´ç™½äº†ï¼Œç®¡ç†åå°å¯ä»¥æ ¹æ®é…ç½®ç”Ÿæˆå‡ºæ¥ã€‚å¯¹äºä¸€äº›éœ€è¦è‡ªå®šä¹‰çš„ä¸šåŠ¡ï¼Œå¯ä»¥è®©é«˜é˜¶ç»„ä»¶æ”¯æŒç»§æ‰¿å’Œé’©å­çš„é‡ç½®æ¥è§£å†³ï¼Œå¦‚æœå®åœ¨è§£å†³ä¸äº†çš„ä¸šåŠ¡ï¼Œå¯ä»¥å•ç‹¬å†™é¡µé¢ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å¯¹äºè¿™ä¸ªï¼Œæˆ‘ä¼šä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« æ¥é™ˆè¿°ä¸‹ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>redux</tag>
        <tag>Antd</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯ | é‡æ„ gulpfile.js</title>
    <url>/posts/18305/</url>
    <content><![CDATA[<p>è¿­ä»£æŒç»­é‡æ„ gulpfile.js<span id="more"></span></p>
<h3 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1 èƒŒæ™¯"></a>1 èƒŒæ™¯</h3><p>å‰ç«¯ä»»åŠ¡æ‰“åŒ…å·¥å…·é€‰ç”¨çš„æ˜¯ <code>gulp</code>, å½“æ—¶é€‰ç”¨ <code>gulp</code> ä¹Ÿæ˜¯å¶ç„¶ï¼Œåœ¨ä½¿ç”¨ <code>grunt</code> åˆæœŸï¼Œç¿»é˜… <code>dailyjs.com</code> æ—¶å‘ç°ä¸€ç‰‡æ–‡ç« ç€é‡ä»‹ç»äº† <code>gulp</code>, ç”šè‡³è¿˜é¢„è¨€æ˜¯ <code>grunt</code> çš„åŠ²æ•Œï¼Œå¥½å¥‡å¿ƒé©±ä½¿ï¼Œç¡®å®å‘ç°ï¼Œ<code>gulp</code> çš„æµçš„æ¦‚å¿µæ›´äººæ€§åŒ–ï¼Œçœ‹ç€å½“æ—¶å†™çš„ <code>grunt</code> é…ç½®æ–‡ä»¶ï¼Œä¸å¿ç›´è§† <!--more--></p>
<p>ç”±äºé¡¹ç›®çš„ä¸æ–­è¿­ä»£ï¼Œå‰ç«¯çš„ä»»åŠ¡ä¹Ÿåœ¨ä¸æ–­çš„è¿­ä»£ï¼Œä»»åŠ¡è¶Šæ¥è¶Šå¤šï¼Œæ²¡æœ‰ä¼˜åŒ–å‰ï¼Œå…¨éƒ¨çš„ä»»åŠ¡éƒ½åœ¨ä¸€ä¸ªå•ç‹¬çš„ <code>gulpfile.js</code> ä¸­ï¼Œåæ¥éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå‘ç°ä¿®æ”¹ä¸€ä¸ªä»»åŠ¡æ—¶ï¼ŒæŸ¥è¯¢å¥½éº»çƒ¦ï¼Œäº”ç™¾è¡Œå·¦å³çš„ä»£ç è®©äººçƒ¦èºï¼Œä»£ç ç»“æ„å’Œ <a href="https://github.com/gulpjs/gulp/blob/master/docs/recipes/using-multiple-sources-in-one-task.md">https://github.com/gulpjs/gulp/blob/master/docs/recipes/using-multiple-sources-in-one-task.md</a> å¦‚å‡ºä¸€è¾™</p>
<p>é‡æ„ <code>gulpfile.js</code> å¿…é¡»è¦è¿›è¡Œ</p>
<h3 id="2-é‡æ„è¿­ä»£-1-æ‹†åˆ†ä»»åŠ¡"><a href="#2-é‡æ„è¿­ä»£-1-æ‹†åˆ†ä»»åŠ¡" class="headerlink" title="2 é‡æ„è¿­ä»£ 1: æ‹†åˆ†ä»»åŠ¡"></a>2 é‡æ„è¿­ä»£ 1: æ‹†åˆ†ä»»åŠ¡</h3><p>æœ€å…ˆæ˜¯æŒ‰ç…§ <a href="https://github.com/gulpjs/gulp/blob/master/docs/recipes/split-tasks-across-multiple-files.md">https://github.com/gulpjs/gulp/blob/master/docs/recipes/split-tasks-across-multiple-files.md</a> æ­¤æ–‡æ¡£ä¸­çš„æ¶æ„è¿›è¡Œè¿­ä»£çš„</p>
<h4 id="æ–‡ä»¶ç»“æ„"><a href="#æ–‡ä»¶ç»“æ„" class="headerlink" title="æ–‡ä»¶ç»“æ„"></a>æ–‡ä»¶ç»“æ„</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">gulpfile.<span class="property">js</span></span><br><span class="line">tasks/</span><br><span class="line">â”œâ”€â”€ xxxx.<span class="property">js</span></span><br><span class="line">â”œâ”€â”€ xxxx.<span class="property">js</span></span><br><span class="line">â””â”€â”€ image.<span class="property">js</span></span><br></pre></td></tr></table></figure>

<h4 id="image-js"><a href="#image-js" class="headerlink" title="image.js"></a>image.js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">&quot;gulp-imagemin&quot;</span>);</span><br><span class="line"></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&quot;img&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> gulp</span><br><span class="line">    .<span class="title function_">src</span>(<span class="string">&quot;./images/**/*.*&quot;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(</span><br><span class="line">      <span class="title function_">imagemin</span>(&#123;</span><br><span class="line">        <span class="attr">optimizationLevel</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">progressive</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&quot;./imagemini&quot;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="gulpfile-js"><a href="#gulpfile-js" class="headerlink" title="gulpfile.js"></a>gulpfile.js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> requireDir = <span class="built_in">require</span>(<span class="string">&quot;require-dir&quot;</span>),</span><br><span class="line">  tasks = <span class="title function_">requireDir</span>(<span class="string">&quot;./tasks&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–‡ä»¶æ¶æ„è®©ä»»åŠ¡æŒ‰ç…§ç±»å‹åˆ†æˆå­ä»»åŠ¡æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œé¡¿æ—¶æ„Ÿè§‰å¹²å‡€äº†å¾ˆå¤šï¼Œè¿™æ—¶å¯ä»¥è‡ªç”±çš„æ·»åŠ å­ä»»åŠ¡ï¼Œè€Œä¸ç”¨ç®¡ <code>gulpfile.js</code>, æ­¤æ—¶å­ä»»åŠ¡å¥½æ¯”æ’ä»¶ï¼Œéœ€è¦å°±æ·»åŠ ï¼Œæ²¡ç”¨å°±åˆ é™¤ï¼Œç›¸å½“æ–¹ä¾¿</p>
<h3 id="3-é‡æ„è¿­ä»£-2-é¿å…æ¨¡å—å’Œæ’ä»¶é‡å¤ä¾èµ–"><a href="#3-é‡æ„è¿­ä»£-2-é¿å…æ¨¡å—å’Œæ’ä»¶é‡å¤ä¾èµ–" class="headerlink" title="3 é‡æ„è¿­ä»£ 2: é¿å…æ¨¡å—å’Œæ’ä»¶é‡å¤ä¾èµ–"></a>3 é‡æ„è¿­ä»£ 2: é¿å…æ¨¡å—å’Œæ’ä»¶é‡å¤ä¾èµ–</h3><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå‘ç°è¿™ç§ç»„ç»‡æ¶æ„è¿˜æ˜¯æœ‰äº›ä¸æ–¹ä¾¿ï¼Œä¸æ–¹ä¾¿åœ¨å“ªé‡Œå‘¢ï¼Œæ¯ä¸€ä¸ªä»»åŠ¡æ–‡ä»¶ä¸­ï¼Œæˆ‘éƒ½è¦å†™ <code>var xxx = require(&#39;xxx&#39;)</code>, å¦‚æœä½ æ˜¯ç”¨ä¸Šé¢çš„æ¶æ„ï¼Œä»»åŠ¡å¤šçš„æ—¶å€™ï¼Œä¼°è®¡ä¹Ÿä¼šæŠ“ç‹‚ï¼Œå› ä¸ºä½ ä¼šå‘ç° <code>æ’ä»¶å’Œæ¨¡å—ä¾èµ–è¢«é‡å¤çš„å¼•å…¥è¿›æ¥</code>ï¼Œè¿™æ ·å°±æé«˜äº†æˆæœ¬</p>
<p>æˆ‘ä¸æƒ³åœ¨å­ä»»åŠ¡æ–‡ä»¶ä¸­é‡å¤çš„å¼•å…¥ <code>æ’ä»¶æˆ–æ¨¡å—ä¾èµ–</code>ï¼Œæœ‰æ²¡æœ‰ä¸Šé¢å¥½æ–¹æ³•ï¼Œ<code>stackoverflow</code> æ˜¯ä¸ªå¥½è€å¸ˆï¼Œè€å¸ˆå‘ŠçŸ¥ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>gulp-load-plugins</code> æ’ä»¶<br>åœ°å€ï¼š<a href="https://www.npmjs.com/package/gulp-load-plugins">https://www.npmjs.com/package/gulp-load-plugins</a></li>
<li>æŠŠå­ä»»åŠ¡å°è£…æˆæ¨¡å—</li>
</ul>
<h4 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">gulpfile.<span class="property">js</span></span><br><span class="line">tasks/</span><br><span class="line">â”œâ”€â”€ xxxx.<span class="property">js</span></span><br><span class="line">â”œâ”€â”€ xxxx.<span class="property">js</span></span><br><span class="line">â””â”€â”€ image.<span class="property">js</span></span><br></pre></td></tr></table></figure>

<h4 id="gulpfile-js-1"><a href="#gulpfile-js-1" class="headerlink" title="gulpfile.js"></a>gulpfile.js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>),</span><br><span class="line">  gulpLoadPlugins = <span class="built_in">require</span>(<span class="string">&quot;gulp-load-plugins&quot;</span>);</span><br><span class="line"><span class="comment">// è¿™é‡Œè¯·æŸ¥çœ‹æ–‡æ¡£</span></span><br><span class="line">gulpLoadPlugins.<span class="property">imagemin</span> = <span class="built_in">require</span>(<span class="string">&quot;gulp-imagemin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;./tasks/image&quot;</span>)(gulp, gulpLoadPlugins);</span><br></pre></td></tr></table></figure>

<h4 id="image-js-1"><a href="#image-js-1" class="headerlink" title="image.js"></a>image.js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">gulp, Plugin</span>) &#123;</span><br><span class="line">  gulp.<span class="title function_">task</span>(<span class="string">&quot;img&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp</span><br><span class="line">      .<span class="title function_">src</span>(<span class="string">&quot;./images/**/*.*&quot;</span>)</span><br><span class="line">      .<span class="title function_">pipe</span>(</span><br><span class="line">        <span class="title class_">Plugin</span>.<span class="title function_">imagemin</span>(&#123;</span><br><span class="line">          <span class="attr">optimizationLevel</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">progressive</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      )</span><br><span class="line">      .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&quot;./imagemini&quot;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä»»åŠ¡ ä¸€åˆ‡æ­£å¸¸ï¼Œæ­¤æ—¶ä¸€ä¸ªæ–‡ä»¶æµ‹è¯•å·²ç» ok</p>
<p>ä½†æ˜¯ <code>./tasks</code> ä¸‹é¢æ˜¯æœ‰å¾ˆå¤šçš„å­ä»»åŠ¡ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªè¿­ä»£åŠ è½½ï¼Œä¿®æ”¹ <code>gulpfile.js</code> å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>),</span><br><span class="line">  gulpLoadPlugins = <span class="built_in">require</span>(<span class="string">&quot;gulp-load-plugins&quot;</span>),</span><br><span class="line">  <span class="comment">// è¿™é‡Œè·å–å­ä»»åŠ¡æ–‡ä»¶åˆ—è¡¨ ä½¿ç”¨äº† fs æ¨¡å—</span></span><br><span class="line">  gulpTaskList = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>).<span class="title function_">readdirSync</span>(<span class="string">&quot;./tasks/&quot;</span>);</span><br><span class="line"><span class="comment">// è¿™é‡Œè¯·æŸ¥çœ‹æ–‡æ¡£</span></span><br><span class="line">gulpLoadPlugins.<span class="property">imagemin</span> = <span class="built_in">require</span>(<span class="string">&quot;gulp-imagemin&quot;</span>);</span><br><span class="line"></span><br><span class="line">gulpTaskList.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">taskfile</span>) &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&quot;./tasks/&quot;</span> + taskfile)(gulp, gulpLoadPlugins);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ¬¡è¿­ä»£é¿å…äº†<code>é‡å¤ä¾èµ–</code>çš„é—®é¢˜ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ï¼Œæ‰€æœ‰çš„ä¾èµ–éƒ½å£°æ˜åœ¨ <code>gulpTaskList</code> å‘½åç©ºé—´ä¸‹ï¼Œå¦‚æœä½ ä¾èµ–å¾ˆå¤šæ’ä»¶æˆ–æ¨¡å—ï¼Œ<code>gulpfile.js</code> ä¹Ÿæ˜¯ç›¸å½“é•¿ï¼Œé±¼å’Œç†ŠæŒä¸å¯å…¼å¾—ï¼Œåœ¨ç°åœ¨æƒ…å†µä¸‹ï¼Œåªèƒ½å¯»æ‰¾æœ€ä½³çš„è§£å†³æ–¹æ¡ˆ</p>
<h3 id="4-é‡æ„è¿­ä»£-3-å‚æ•°é…ç½®å…¨å±€åŒ–"><a href="#4-é‡æ„è¿­ä»£-3-å‚æ•°é…ç½®å…¨å±€åŒ–" class="headerlink" title="4 é‡æ„è¿­ä»£ 3: å‚æ•°é…ç½®å…¨å±€åŒ–"></a>4 é‡æ„è¿­ä»£ 3: å‚æ•°é…ç½®å…¨å±€åŒ–</h3><p>å…¶å®ç¬¬äºŒéƒ¨è¿­ä»£ä¹‹åï¼Œå°±å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œä½†è¿˜æ˜¯æœ‰å°ä¼™ä¼´æŠ±æ€¨ï¼Œæœ‰äº›å­ä»»åŠ¡æœ‰ç›¸åŒçš„å‚æ•°ï¼Œèƒ½ä¸èƒ½æŠ½å–å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œso ç»§ç»­ç¿»é˜…æ–‡æ¡£</p>
<p>å‚è€ƒæ–‡æ¡£<a href="https://github.com/gulpjs/gulp/blob/master/docs/recipes/using-external-config-file.md">https://github.com/gulpjs/gulp/blob/master/docs/recipes/using-external-config-file.md</a></p>
<h4 id="ä»£ç ç»“æ„-1"><a href="#ä»£ç ç»“æ„-1" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">gulpfile.<span class="property">js</span></span><br><span class="line">gulp</span><br><span class="line">â”œâ”€â”€ config.<span class="property">json</span></span><br><span class="line">â”œâ”€â”€ tasks/</span><br><span class="line">    â”œâ”€â”€ xxxx.<span class="property">js</span></span><br><span class="line">    â”œâ”€â”€ xxxx.<span class="property">js</span></span><br><span class="line">    â””â”€â”€ image.<span class="property">js</span></span><br></pre></td></tr></table></figure>

<p><code>æ³¨æ„ï¼šæ–‡ä»¶å¤¹å±‚æ¬¡å˜äº†</code></p>
<h4 id="config-json"><a href="#config-json" class="headerlink" title="config.json"></a>config.json</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;pnglevel&quot;</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="gulpfile-js-2"><a href="#gulpfile-js-2" class="headerlink" title="gulpfile.js"></a>gulpfile.js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>)</span><br><span class="line">  , config = <span class="built_in">require</span>(<span class="string">&#x27;./gulp/config.json&#x27;</span>);</span><br><span class="line">  , gulpLoadPlugins = <span class="built_in">require</span>(<span class="string">&#x27;gulp-load-plugins&#x27;</span>)</span><br><span class="line">  , gulpTaskList = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readdirSync</span>(<span class="string">&#x27;./gulp/tasks/&#x27;</span>)</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line">gulpLoadPlugins.<span class="property">imagemin</span> = <span class="built_in">require</span>(<span class="string">&#x27;gulp-imagemin&#x27;</span>);</span><br><span class="line"></span><br><span class="line">gulpTaskList.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">taskfile</span>) &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;./gulp/tasks/&#x27;</span> + taskfile)(gulp, gulpLoadPlugins, config);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="image-js-2"><a href="#image-js-2" class="headerlink" title="image.js"></a>image.js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">gulp, Plugin, config</span>) &#123;</span><br><span class="line">  gulp.<span class="title function_">task</span>(<span class="string">&quot;img&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp</span><br><span class="line">      .<span class="title function_">src</span>(<span class="string">&quot;./images/**/*.*&quot;</span>)</span><br><span class="line">      .<span class="title function_">pipe</span>(</span><br><span class="line">        <span class="title class_">Plugin</span>.<span class="title function_">imagemin</span>(&#123;</span><br><span class="line">          <span class="attr">optimizationLevel</span>: config.<span class="property">pnglevel</span>,</span><br><span class="line">          <span class="attr">progressive</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      )</span><br><span class="line">      .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&quot;./imagemini&quot;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ¬¡è¿­ä»£ç»“æŸåï¼Œæˆ‘æŠŠå­ä»»åŠ¡ä¸­é€šç”¨çš„é…ç½®éƒ½å†™åˆ° <code>./gulp/config.json</code> ä¸­ï¼Œå…¨å±€é…ç½®</p>
<h3 id="5-é‡æ„è¿­ä»£-4-å‚æ•°é…ç½®æ¨¡å—åŒ–"><a href="#5-é‡æ„è¿­ä»£-4-å‚æ•°é…ç½®æ¨¡å—åŒ–" class="headerlink" title="5 é‡æ„è¿­ä»£ 4: å‚æ•°é…ç½®æ¨¡å—åŒ–"></a>5 é‡æ„è¿­ä»£ 4: å‚æ•°é…ç½®æ¨¡å—åŒ–</h3><p>æ­¤æ¬¡è¿­ä»£ç´§è·Ÿè¿­ä»£ 3ï¼Œ<code>json</code> ä¸å¤Ÿå®Œç¾ï¼Œä¸æƒ³æ¯æ¬¡å»å†™ <code>&quot;&quot;</code>, è¿™é‡Œæˆ‘æŠŠé…ç½®æ–‡ä»¶å°è£…æˆä¸€ä¸ªæ¨¡å—</p>
<p>å³è¿­ä»£ 3 ä¸­çš„ <code>config.json</code> å˜æˆäº† <code>config.js</code></p>
<h4 id="config-js"><a href="#config-js" class="headerlink" title="config.js"></a>config.js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> config = &#123;</span><br><span class="line">    <span class="attr">pnglevel</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="gulpfile-js-åŠ è½½"><a href="#gulpfile-js-åŠ è½½" class="headerlink" title="gulpfile.js åŠ è½½"></a>gulpfile.js åŠ è½½</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">&quot;./gulp/gulp.config&quot;</span>)();</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–ä¸å˜ï¼Œå½“å°è£…æˆä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œä½ å°±å‘ç°å¥½å¤„å¤šå¤šäº†ï¼Œå¯ä»¥åœ¨æ¨¡å—ä¸­æ·»åŠ å‡½æ•°ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠé…ç½®æ‹†åˆ†ï¼Œæ ¹æ®ä½ çš„ä¸šåŠ¡éœ€è¦ï¼Œè‡ªç”±è°ƒæ•´</p>
<h3 id="6-åè®°"><a href="#6-åè®°" class="headerlink" title="6 åè®°"></a>6 åè®°</h3><p>é€šè¿‡ 4 æ­¥çš„è¿­ä»£ï¼Œæ•´ä¸ªä»£ç ç»„ç»‡æ¶æ„å°±æ¸…æ™°å¤šäº†ï¼Œå¾ˆæ„Ÿè°¢è¿™ä¹ˆå¤šçƒ­çˆ±å¼€æºï¼Œä¹äºåŠ©äººçš„æœ‹å‹ï¼Œè°¢è°¢</p>
<p>æ³¨æ„ï¼šå­ä»»åŠ¡ä¸­æ³¨æ„æ–‡ä»¶å¤¹çš„å±‚æ¬¡ï¼Œå­ä»»åŠ¡ä¸­çš„æ–‡ä»¶å¤¹æ˜¯ä»¥ <code>gulpfile.js</code> ä¸ºåŸºå‡†ï¼Œå› ä¸º <code>gulpfile.js</code> æŠŠå­ä»»åŠ¡éƒ½åŒ…å«è¿›æ¥äº†</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Gulp</tag>
      </tags>
  </entry>
  <entry>
    <title>Debian | Media change please insert the disc labeled</title>
    <url>/posts/20380/</url>
    <content><![CDATA[<p>ä½¿ç”¨ <code>apt install xxx</code> æ—¶ï¼Œå‡ºç°ä¸‹é¢çš„æŠ¥é”™ <span id="more"></span></p>
<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p><code>apt update</code> æ‰§è¡Œæ—¶ï¼ŒæŠ¥ä»¥ä¸‹é”™è¯¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Media change: please insert the disc labeled</span><br><span class="line"></span><br><span class="line">media change: please insert the disc labeled</span><br><span class="line">Debian 10.9.3 - Release amd64 (20210327.10) in the drive /media/cdrom/ and press enter</span><br></pre></td></tr></table></figure>

<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>é”™è¯¯ä¿¡æ¯é€šå¸¸å‡ºç°åœ¨ä½¿ç”¨åŸºäº <code>Debian</code> æˆ– <code>Ubuntu</code> çš„ Linux å‘è¡Œç‰ˆæ—¶ï¼Œå‡ºç°è¿™ä¸ªé”™è¯¯çš„åŸå› æ˜¯ <code>/etc/apt/sources.list</code> æ–‡ä»¶ä¸­ä»ç„¶ä¿ç•™æœ‰å…‰ç›˜ <code>ï¼ˆCD/DVDï¼‰</code> æºï¼Œå¯¼è‡´ç³»ç»Ÿåœ¨å°è¯•å®‰è£…è½¯ä»¶åŒ…æˆ–æ›´æ–°æ—¶è¯•å›¾ä»å…‰ç›˜æºè¯»å–æ•°æ®ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç¼–è¾‘ <code>/etc/apt/sources.list</code> æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰æˆ–åˆ é™¤ä¸å…‰ç›˜æºç›¸å…³çš„è¡Œã€‚</p>
<h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><p>æŸ¥çœ‹ä¸‹ <code>/etc/apt/sources.list</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># deb cdrom:[Debian GNU/Linux 10.9.0 _Buster_ - Official amd64 DVD Binary-1 20210327-10:39]/ buster contrib main</span></span><br><span class="line"></span><br><span class="line">deb cdrom:[Debian GNU/Linux <span class="number">10.9</span><span class="number">.0</span> _Buster_ - Official amd64 DVD Binary-<span class="number">1</span> <span class="number">20210327</span>-<span class="number">10</span>:<span class="number">39</span>]/ buster contrib main</span><br><span class="line"></span><br><span class="line">deb http://security.debian.org/debian-security buster/updates main contrib</span><br><span class="line">deb-src http://security.debian.org/debian-security buster/updates main contrib</span><br><span class="line"></span><br><span class="line"><span class="comment"># buster-updates, previously known as &#x27;volatile&#x27;</span></span><br><span class="line"><span class="comment"># A network mirror was not selected during install.  The following entries</span></span><br><span class="line"><span class="comment"># are provided as examples, but you should amend them as appropriate</span></span><br><span class="line"><span class="comment"># for your mirror of choice.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># deb http://deb.debian.org/debian/ buster-updates main contrib</span></span><br><span class="line"><span class="comment"># deb-src http://deb.debian.org/debian/ buster-updates main contrib</span></span><br></pre></td></tr></table></figure>

<p>æ³¨é‡Šæ‰ä¸å…‰ç›˜æºç›¸å…³çš„è¡Œï¼Œé€šå¸¸ä»¥ <code>deb cdrom:</code> å¼€å¤´ã€‚<br>è¿™é‡Œå³æŠŠåŒ…å« <code>deb cdrom:</code> è¿™è¡Œç»™æ³¨é‡Šæ‰ï¼Œä¸ºäº†åŠ å¿«æ›´æ–°é€Ÿåº¦ï¼ŒæŠŠ <code>apt</code> æºè®¾ç½®æˆæ¸…åæºï¼Œä¿®æ”¹åçš„æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># deb cdrom:[Debian GNU/Linux 10.9.0 _Buster_ - Official amd64 DVD Binary-1 20210327-10:39]/ buster contrib main</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deb cdrom:[Debian GNU/Linux 10.9.0 _Buster_ - Official amd64 DVD Binary-1 20210327-10:39]/ buster contrib main</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deb https://security.debian.org/debian-security buster/updates main contrib</span></span><br><span class="line"><span class="comment"># deb-src http://security.debian.org/debian-security buster/updates main contrib</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># buster-updates, previously known as &#x27;volatile&#x27;</span></span><br><span class="line"><span class="comment"># A network mirror was not selected during install.  The following entries</span></span><br><span class="line"><span class="comment"># are provided as examples, but you should amend them as appropriate</span></span><br><span class="line"><span class="comment"># for your mirror of choice.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># deb http://deb.debian.org/debian/ buster-updates main contrib</span></span><br><span class="line"><span class="comment"># deb-src http://deb.debian.org/debian/ buster-updates main contrib</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œ <code>apt update</code>ï¼Œæœ€åé‡æ–°å®‰è£…è½¯ä»¶æˆåŠŸã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Debian</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºæœªæ‰¾åˆ°å…¥å£ sitemap.json</title>
    <url>/posts/6541/</url>
    <content><![CDATA[<p><code>Error</code>: æœªæ‰¾åˆ°å…¥å£ <code>sitemap.json</code> æ–‡ä»¶ï¼Œæˆ–è€…æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥åé‡æ–°ç¼–è¯‘</p>
<span id="more"></span>

<h3 id="1-é—®é¢˜æè¿°"><a href="#1-é—®é¢˜æè¿°" class="headerlink" title="1 é—®é¢˜æè¿°"></a>1 é—®é¢˜æè¿°</h3><p>ä»Šå¤©åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­å‘ç°äº†ä¸€ä¸ªé”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯ä¸€ç›´æ²¡æœ‰æ³¨æ„åˆ°ã€‚</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">`Error`: æœªæ‰¾åˆ°å…¥å£ `sitemap.json` æ–‡ä»¶ï¼Œæˆ–è€…æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥åé‡æ–°ç¼–è¯‘</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé”™è¯¯ä¸ä¼šå½±å“å°ç¨‹åºçš„æ­£å¸¸ä½¿ç”¨ï¼ŒæŸ¥é˜…äº†æ–‡æ¡£ï¼ˆ<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/sitemap.html%60">å¾®ä¿¡å°ç¨‹åº sitemap.json</a>ï¼‰ï¼Œæ‰çŸ¥é“è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥ç»™å¾®ä¿¡å°ç¨‹åºæœç´¢å»ºç«‹ç´¢å¼•ç”¨çš„ï¼Œä¸‹é¢å†ä»”ç»†åˆ†æä¸‹è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<h3 id="2-è§£å†³æ–¹æ³•"><a href="#2-è§£å†³æ–¹æ³•" class="headerlink" title="2 è§£å†³æ–¹æ³•"></a>2 è§£å†³æ–¹æ³•</h3><p>ç¬¬ä¸€æ­¥ï¼šæˆ‘æ ¹æ®é”™è¯¯æè¿°ï¼Œåœ¨ app.jsx(æˆ‘ä½¿ç”¨äº† Taro) åŒçº§ç›®å½•ä¸‹æ–°å»ºäº†ä¸€ä¸ª <code>sitemap.json</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šæ¥ç€åœ¨ <code>app.jsx</code> ä¸­çš„ <code>config</code> ä¸­æ·»åŠ </p>
<figure class="highlight sml"><table><tr><td class="code"><pre><span class="line">sitemapLocation: <span class="symbol">&#x27;sitemap</span>.json&#x27;,</span><br></pre></td></tr></table></figure>

<p>ç„¶åç¼–è¯‘æµ‹è¯•ï¼Œå‘ç°è¿˜æ˜¯å‡ºç°åŒæ ·çš„é”™è¯¯ï¼Œç„¶åå‘ç° <code>dist</code> æ–‡ä»¶å¤¹ä¸‹é¢æ²¡æœ‰ <code>sitemap.json</code> æ–‡ä»¶ï¼Œè¿™ä¸ªå¯èƒ½æ˜¯ <code>Taro</code> ä¸æ”¯æŒçš„åŸå› ï¼Œä½†æ˜¯ <code>Taro</code> è¿˜æ˜¯æä¾›äº†ä¸€ä¸ª <code>copy</code> çš„ç¼–è¯‘åŠŸèƒ½ï¼ˆ<a href="https://nervjs.github.io/taro/docs/config-detail.html#copy">Taro ç¼–è¯‘é…ç½® copy</a>)ï¼Œæ‘˜å‡ºæ¥å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>copy</p>
</blockquote>
<p>æ–‡ä»¶ <code>copy</code> é…ç½®ï¼ŒåŒ…å«ä¸¤ä¸ªé…ç½®é¡¹ <code>patterns</code> å’Œ <code>options</code>ã€‚</p>
<p><strong>copy.patterns</strong></p>
<p>ç”¨æ¥æŒ‡å®šéœ€è¦æ‹·è´çš„æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œæ•°ç»„ç±»å‹ï¼Œæ¯ä¸€é¡¹éƒ½å¿…é¡»åŒ…å« <code>from</code> ã€<code>to</code> çš„é…ç½®ï¼Œåˆ†åˆ«ä»£è¡¨æ¥æºå’Œéœ€è¦æ‹·è´åˆ°çš„ç›®å½•ï¼ŒåŒæ—¶å¯ä»¥è®¾ç½® <code>ignore</code> é…ç½®æ¥æŒ‡å®šéœ€è¦å¿½ç•¥çš„æ–‡ä»¶ï¼Œ <code>ignore</code> æ˜¯æŒ‡å®šçš„ <code>glob</code> ç±»å‹å­—ç¬¦ä¸²ï¼Œæˆ–è€… glob å­—ç¬¦ä¸²æ•°ç»„ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç›®å‰ <code>from</code> å¿…é¡»æŒ‡å®šå­˜åœ¨çš„æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œæš‚ä¸æ”¯æŒ <code>glob</code> æ ¼å¼ï¼Œ <code>from</code> å’Œ <code>to</code> ç›´æ¥ç½®é¡¶é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ç›®å½•ï¼Œå»ºè®® <code>from</code> ä»¥ <code>src</code> ç›®å½•å¼€å¤´ï¼Œ<code>to</code> ä»¥ <code>dist</code> ç›®å½•å¼€å¤´ã€‚</p>
<p>ä¸€èˆ¬æœ‰å¦‚ä¸‹çš„ä½¿ç”¨å½¢å¼ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">copy: &#123;</span><br><span class="line">    patterns: [</span><br><span class="line">        &#123; <span class="selector-tag">from</span>: <span class="string">&#x27;src/asset/tt/&#x27;</span>, to: <span class="string">&#x27;dist/asset/tt/&#x27;</span>, ignore: <span class="string">&#x27;*.js&#x27;</span> &#125;, // æŒ‡å®šéœ€è¦ copy çš„ç›®å½•</span><br><span class="line">        &#123; <span class="selector-tag">from</span>: <span class="string">&#x27;src/asset/tt/sd.jpg&#x27;</span>, to: <span class="string">&#x27;dist/asset/tt/sd.jpg&#x27;</span> &#125; // æŒ‡å®šéœ€è¦ copy çš„æ–‡ä»¶</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>copy.options</strong></p>
<p>æ‹·è´é…ç½®ï¼Œç›®å‰å¯ä»¥æŒ‡å®šå…¨å±€çš„ <code>ignore</code>ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">copy: &#123;</span><br><span class="line">    options: &#123;</span><br><span class="line">        ignore: [<span class="string">&#x27;*.js&#x27;</span>, <span class="string">&#x27;*.css&#x27;</span>] // å…¨å±€çš„ ignore</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼šå¥½äº†ï¼Œçœ‹å®Œæ–‡æ¡£åï¼Œç›´æ¥ä¿®æ”¹ <code>Taro</code> çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">copy: &#123;</span><br><span class="line">    patterns: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="selector-tag">from</span>: <span class="string">&#x27;src/sitemap.json&#x27;</span>,</span><br><span class="line">            to: <span class="string">&#x27;dist/sitemap.json&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    options: &#123;&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡ç¼–è¯‘æµ‹è¯•ï¼Œæ­£å¸¸ï¼ŒæŸ¥çœ‹ <code>dist</code> æ–‡ä»¶å¤¹ä¹Ÿå­˜åœ¨ <code>sitemap.json</code> æ–‡ä»¶ã€‚</p>
<h3 id="3-èŠä¸‹-sitemap"><a href="#3-èŠä¸‹-sitemap" class="headerlink" title="3 èŠä¸‹ sitemap"></a>3 èŠä¸‹ sitemap</h3><p>è¿™ä¸ªåŠŸèƒ½ä¸é”™ï¼Œå¢åŠ å°ç¨‹åºçš„æ›å…‰åº¦ï¼Œè€Œä¸”å¼€å‘è€…è¿˜å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦è‡ªå®šä¹‰è¢«ç´¢å¼•çš„é¡µé¢ï¼Œå¾ˆå®ç”¨ã€‚å¦‚æœä½ ä¸å…³å¿ƒè¿™äº›ä¸œè¥¿ï¼Œå°±å‚è€ƒæˆ‘çš„ <code>sitemap.json</code> é…ç½®ã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Taro</tag>
        <tag>å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux | æŸ¥çœ‹æœåŠ¡å™¨ç™»å½•ç”¨æˆ·çš„æ´»åŠ¨æƒ…å†µ</title>
    <url>/posts/10000/</url>
    <content><![CDATA[<p>ä¸ºäº†å®‰å…¨ï¼Œä¼šç»å¸¸æ€§çš„æŸ¥çœ‹æœåŠ¡å™¨ç™»å½•çš„ç”¨æˆ·çš„æƒ…å†µï¼Œä¸‹é¢åˆ—ä¸¾å¸¸ç”¨å‘½ä»¤çš„ä½¿ç”¨<span id="more"></span></p>
<h2 id="1-utmp-wtmp-btmp-æ–‡ä»¶"><a href="#1-utmp-wtmp-btmp-æ–‡ä»¶" class="headerlink" title="1 utmp wtmp btmp æ–‡ä»¶"></a>1 utmp wtmp btmp æ–‡ä»¶</h2><p>è¿™é‡Œåšä¸ªå‰ç½®è¯´æ˜ï¼Œå› ä¸ºæ¥ä¸‹æ¥çš„å¾ˆå¤šå‘½ä»¤éƒ½ä¸è¿™äº›æ–‡ä»¶æœ‰ç€åƒä¸ä¸‡ç¼•çš„å…³ç³»ã€‚</p>
<h3 id="1-1-æ–‡ä»¶è¯´æ˜"><a href="#1-1-æ–‡ä»¶è¯´æ˜" class="headerlink" title="1.1 æ–‡ä»¶è¯´æ˜"></a>1.1 æ–‡ä»¶è¯´æ˜</h3><p>Linux ç”¨æˆ·ç™»å½•çš„ä¿¡æ¯ä¸€èˆ¬æ”¾åœ¨äº†è¿™ä¸‰ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
<ul>
<li><code>/var/run/utmp</code>ï¼šè®°å½•å½“å‰æ­£åœ¨ç™»å½•ç³»ç»Ÿçš„ç”¨æˆ·ä¿¡æ¯ï¼Œ<code>who</code> å’Œ <code>w</code>ï¼Œ<code>uptime</code> å‘½ä»¤é»˜è®¤ä½¿ç”¨æ­¤æ–‡ä»¶ã€‚</li>
<li><code>/var/log/wtmp</code>ï¼šè®°å½•ç™»å½•è¿‡æ­¤ç³»ç»Ÿçš„ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç°åœ¨å’Œè¿‡å»ï¼ˆå…¶å®å°±æ˜¯è®°å½• utmp æ–‡ä»¶çš„å†å²è®°å½•ï¼‰ï¼Œé»˜è®¤ç”± <code>last</code> å‘½ä»¤æŸ¥çœ‹ã€‚</li>
<li><code>/var/log/btmp</code>ï¼šè®°å½•å¤±è´¥çš„å°è¯•ç™»å½•ä¿¡æ¯ï¼ˆè¿™ä¸ªä¹Ÿå›Šæ‹¬äº†æ¶æ„çš„å°è¯•æš´åŠ›ç™»å½•çš„å°è¯•)ï¼Œé»˜è®¤ç”± <code>lastb</code> å‘½ä»¤æŸ¥çœ‹ã€‚</li>
</ul>
<p>è¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”è¿™ä¸‰ä¸ªæ–‡ä»¶ç»“æ„å®Œå…¨ç›¸åŒï¼Œç»“æ„ä½“çš„å®šä¹‰åœ¨ <code>/usr/include/utmp.h</code> æ–‡ä»¶ä¸­ã€‚</p>
<h3 id="1-2-logrotate"><a href="#1-2-logrotate" class="headerlink" title="1.2 logrotate"></a>1.2 logrotate</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡ä»¶çš„æ—¥å¿—ä¿¡æ¯ä¼šé€šè¿‡ <code>logrotate</code> æ—¥å¿—ç®¡ç†å·¥å…·å®šæœŸæ¸…ç†ï¼Œ<code>logrotate</code> çš„é…ç½®æ–‡ä»¶ï¼ˆ<code>/etc/logrotate.conf</code>)ï¼Œå…¶æ˜¯ <code>logrotate</code> çš„ç¼ºçœé…ç½®ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ä¸éœ€è¦å¯¹å®ƒè¿›è¡Œä¿®æ”¹ã€‚æ—¥å¿—æ–‡ä»¶çš„è½®å¾ªå‹ç¼©ç­‰é…ç½®å­˜æ”¾åœ¨ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå®ƒä»¬ä½ç½®æ˜¯ï¼š<code>/etc/logrotate.d/</code> ç›®å½•ä¸‹ï¼Œä»–ä¼šè¦†ç›–ç¼ºçœé…ç½®ã€‚</p>
<p>å¦‚æœä¸æƒ³è®°å½•ç›¸å…³ä¿¡æ¯ï¼Œåˆ™å¯ä»¥ç›´æ¥åˆ é™¤ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚å¦‚æœç³»ç»Ÿä¸å­˜åœ¨æ”¹æ–‡ä»¶ï¼Œåˆ™æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶å³å¯ã€‚è¿™é‡Œçœ‹ä¸‹é»˜è®¤çš„ç³»ç»Ÿæ—¥å¿—é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict logrotate.d]# cat syslog</span><br><span class="line">/var/log/cron</span><br><span class="line">/var/log/maillog</span><br><span class="line">/var/log/messages</span><br><span class="line">/var/log/secure</span><br><span class="line">/var/log/spooler</span><br><span class="line">&#123;</span><br><span class="line">    missingok</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">	/bin/kill -HUP `cat /var/run/syslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || true</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-æ³¨æ„ç»†èŠ‚"><a href="#1-3-æ³¨æ„ç»†èŠ‚" class="headerlink" title="1.3 æ³¨æ„ç»†èŠ‚"></a>1.3 æ³¨æ„ç»†èŠ‚</h3><p>ä¸Šé¢ä¸ºä»€ä¹ˆè¯´ <code>/var/log/wtmp</code> å…¶å®æ˜¯è®°å½• <code>/var/run/utmp</code> æ–‡ä»¶çš„å†å²è®°å½•å‘¢ï¼Œé€šè¿‡å†…å®¹å¯¹ä¸‹ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict bits]# utmpdump /var/run/utmp</span><br><span class="line">Utmp dump of /var/run/utmp</span><br><span class="line">[2] [00000] [~~  ] [reboot  ] [~           ] [3.10.0-1160.66.1.el7.x86_64] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 23:54:09 2018   ]</span><br><span class="line">[1] [00051] [~~  ] [runlevel] [~           ] [3.10.0-1160.66.1.el7.x86_64] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2018   ]</span><br><span class="line">[6] [01060] [tty1] [LOGIN   ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2018   ]</span><br><span class="line">[6] [01059] [tyS0] [LOGIN   ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2018   ]</span><br><span class="line">[7] [14985] [ts/0] [root    ] [pts/0       ] [121.32.197.136      ] [121.32.197.136 ] [ä¸€ 7æœˆ 18 10:59:15 2018   ]</span><br><span class="line"></span><br><span class="line">[root@kycool-strict bits]# utmpdump /var/log/wtmp</span><br><span class="line">Utmp dump of /var/log/wtmp</span><br><span class="line">[8] [01088] [tyS0] [        ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 5æœˆ 25 10:46:00 2018   ]</span><br><span class="line">[8] [01089] [tty1] [        ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 5æœˆ 25 10:46:00 2018   ]</span><br><span class="line">[2] [00000] [~~  ] [reboot  ] [~           ] [3.10.0-1160.66.1.el7.x86_64] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 23:54:09 2018   ]</span><br><span class="line">[1] [00051] [~~  ] [runlevel] [~           ] [3.10.0-1160.66.1.el7.x86_64] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2018   ]</span><br><span class="line">[5] [01060] [tty1] [        ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2018   ]</span><br><span class="line">[5] [01059] [tyS0] [        ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2018   ]</span><br><span class="line">[6] [01060] [tty1] [LOGIN   ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2018   ]</span><br><span class="line">[6] [01059] [tyS0] [LOGIN   ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2018   ]</span><br><span class="line">[7] [01379] [ts/0] [root    ] [pts/0       ] [113.65.29.194       ] [113.65.29.194  ] [ä¸‰ 6æœˆ 29 15:55:51 2018   ]</span><br><span class="line">[8] [01377] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:56:27 2018   ]</span><br><span class="line">[7] [01404] [ts/0] [root    ] [pts/0       ] [113.65.29.194       ] [113.65.29.194  ] [ä¸‰ 6æœˆ 29 15:56:29 2018   ]</span><br><span class="line">[8] [01402] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 16:03:01 2018   ]</span><br><span class="line">[7] [01589] [ts/0] [root    ] [pts/0       ] [113.65.29.194       ] [113.65.29.194  ] [ä¸‰ 6æœˆ 29 16:04:39 2018   ]</span><br><span class="line">[8] [01587] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 20:12:05 2018   ]</span><br><span class="line">[7] [04064] [ts/0] [root    ] [pts/0       ] [121.32.199.178      ] [121.32.199.178 ] [äºŒ 7æœˆ 12 15:03:05 2018   ]</span><br><span class="line">[8] [04062] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [äºŒ 7æœˆ 12 17:26:21 2018   ]</span><br><span class="line">[7] [14985] [ts/0] [root    ] [pts/0       ] [121.32.197.136      ] [121.32.197.136 ] [ä¸€ 7æœˆ 18 10:59:15 2018   ]</span><br></pre></td></tr></table></figure>

<h2 id="2-å¸¸ç”¨å‘½ä»¤"><a href="#2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2 å¸¸ç”¨å‘½ä»¤"></a>2 å¸¸ç”¨å‘½ä»¤</h2><h3 id="2-1-w"><a href="#2-1-w" class="headerlink" title="2.1 w"></a>2.1 w</h3><p>æŸ¥çœ‹å½“å‰ç™»å…¥ç³»ç»Ÿçš„ç”¨æˆ·ä¿¡æ¯åŠç”¨æˆ·å½“å‰çš„çº¿ç¨‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict ~]# w</span><br><span class="line"></span><br><span class="line"> 11:09:28 up 18 days, 19:15,  1 user,  load average: 0.00, 0.01, 0.05</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/0    121.32.197.136   10:59    0.00s  0.00s  0.00s w</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºè§£é‡Šï¼š<br><strong>ä¸ŠåŠéƒ¨åˆ†</strong><br><code>11:09:28 up 18 days, 19:15, 1 user, load average: 0.00, 0.01, 0.05</code><br>è¿™é‡Œå…¶å®ç±»ä¼¼äº <code>top</code> çš„ç¬¬ä¸€è¡Œï¼Œæ˜¾ç¤ºäº†å½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œå¼€æœºè¿è¡Œå¤šä¹…ï¼ˆ<code>up</code>ï¼‰ï¼Œæœ‰å¤šå°‘ç”¨æˆ·ç™»å½•ï¼ˆ<code>users</code>ï¼‰ï¼Œ<br>ä»¥åŠ <code>1</code> åˆ†é’Ÿï¼Œ<code>5</code> åˆ†é’Ÿï¼Œ<code>15</code> åˆ†é’Ÿå‰çš„å¹³å‡è´Ÿè½½ï¼ˆ<code>load average</code>ï¼‰ã€‚</p>
<p><strong>ä¸‹åŠéƒ¨åˆ†</strong><br>ä¸‹ç­éƒ¨åˆ†ç±»ä¼¼äºè¡¨æ ¼ï¼Œè¿™å°±å°±ç®€è¿°ä¸‹è¡¨å¤´çš„å«ä¹‰</p>
<ul>
<li><code>USER</code>ï¼šç™»å½•çš„ç”¨æˆ·å</li>
<li><code>TTY</code>ï¼šç™»å½•çš„ç»ˆç«¯</li>
<li><code>FROM</code>ï¼šç”¨æˆ·ä»å“ªä¸ª IP åœ°å€è¿›è¡Œç™»å½•</li>
<li><code>LOGIN@</code>ï¼šç™»å½•æ—¶é—´</li>
<li><code>IDLE</code>ï¼šç”¨æˆ·é—²ç½®æ—¶é—´</li>
<li><code>JCPU</code>ï¼šå¤„äºè¯¥ç»ˆç«¯è¿æ¥ä¸‹çš„æ‰€æœ‰è¿›ç¨‹å ç”¨çš„ CPU è¿ç®—æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´ä¸åŒ…å«è¿‡å»çš„åå°ä½œä¸šæ—¶é—´ï¼Œä½†æ˜¯<br>åŒ…æ‹¬å½“å‰æ­£åœ¨è¿è¡Œçš„åå°ä½œä¸šæ—¶é—´</li>
<li><code>PCPU</code>ï¼šå½“å‰è¿›ç¨‹æ‰€å ç”¨çš„ CPU è¿ç®—æ—¶é—´</li>
<li><code>WHAT</code>ï¼šå½“å‰æ­£åœ¨è¿è¡Œçš„å‘½ä»¤</li>
</ul>
<h3 id="2-2-who"><a href="#2-2-who" class="headerlink" title="2.2 who"></a>2.2 who</h3><p>æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·çš„æƒ…å†µ</p>
<p>å½“ä¸æŒ‡å®šä»»ä½•å‚æ•°æ—¶ï¼Œå°†æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰“å°ä¿¡æ¯ï¼š<br><strong>ç™»å½•ç”¨æˆ·åç§°ï¼Œç»ˆç«¯ä¿¡æ¯ï¼Œç™»å½•æ—¶é—´ï¼Œç”¨æˆ·ç™»å½• IP åœ°å€</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict ~]# who</span><br><span class="line">root     pts/0        2018-07-18 10:59 (112.22.194.16)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ man who æ—¶ï¼Œå‘ç°äº†ä¸€å¥è¯ï¼š</p>
<p><code>If FILE is not specified, use /var/run/utmp. /var/log/wtmp as FILE is common.</code></p>
<p>å³å¦‚æœä¸æŒ‡å®šæ–‡ä»¶ï¼Œé»˜è®¤ä½¿ç”¨ <code>/var/run/utmp</code> æ–‡ä»¶ï¼Œå½“å‰ä¹Ÿå¯ä»¥æŒ‡å®šæ–‡ä»¶ï¼Œè¿›è¡ŒæŸ¥çœ‹</p>
<p>ä¸‹é¢ä½¿ç”¨ <code>wtmp</code> æ–‡ä»¶è¿›è¡ŒæŸ¥çœ‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict ~]<span class="comment"># who /var/log/wtmp</span></span><br><span class="line">root pts/<span class="number">0</span> <span class="number">2018</span>-06-<span class="number">29</span> <span class="number">15</span>:<span class="number">55</span> (<span class="number">113.65</span><span class="number">.29</span><span class="number">.194</span>)</span><br><span class="line">root pts/<span class="number">0</span> <span class="number">2018</span>-06-<span class="number">29</span> <span class="number">15</span>:<span class="number">56</span> (<span class="number">113.65</span><span class="number">.29</span><span class="number">.194</span>)</span><br><span class="line">root pts/<span class="number">0</span> <span class="number">2018</span>-06-<span class="number">29</span> <span class="number">16</span>:04 (<span class="number">113.65</span><span class="number">.29</span><span class="number">.194</span>)</span><br><span class="line">root pts/<span class="number">0</span> <span class="number">2018</span>-07-<span class="number">12</span> <span class="number">15</span>:03 (<span class="number">121.32</span><span class="number">.199</span><span class="number">.178</span>)</span><br><span class="line">root pts/<span class="number">0</span> <span class="number">2018</span>-07-<span class="number">18</span> <span class="number">10</span>:<span class="number">59</span> (<span class="number">121.32</span><span class="number">.197</span><span class="number">.136</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹åˆ°äº†è¿‡å»ï¼Œç°åœ¨ç™»å½•ç”¨æˆ·çš„æƒ…å†µ</p>
<h3 id="2-3-users"><a href="#2-3-users" class="headerlink" title="2.3 users"></a>2.3 users</h3><p>æŸ¥çœ‹å½“å‰æœåŠ¡å™¨æ‰€æœ‰ç™»å½•ç”¨æˆ·çš„æƒ…å†µï¼Œæ›´è¯¦ç»†çš„å¯ä»¥æŸ¥çœ‹æ‰‹å†Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict ~]# users</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<h3 id="2-4-lastlog"><a href="#2-4-lastlog" class="headerlink" title="2.4 lastlog"></a>2.4 lastlog</h3><p>åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·æœ€è¿‘ç™»å½•çš„ä¿¡æ¯ï¼Œæˆ–è€…æŒ‡å®šç”¨æˆ·çš„æœ€è¿‘ç™»å½•ä¿¡æ¯ã€‚å…¶å¼•ç”¨çš„æ–‡ä»¶æ˜¯ï¼š<code>/var/log/lastlog</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict log]# lastlog</span><br><span class="line">ç”¨æˆ·å           ç«¯å£     æ¥è‡ª             æœ€åç™»é™†æ—¶é—´</span><br><span class="line">future          pts/0    121.32.197.136   ä¸€ 7æœˆ 18 10:59:15 +0800 2022</span><br><span class="line">bin                                        **ä»æœªç™»å½•è¿‡**</span><br><span class="line">daemon                                     **ä»æœªç™»å½•è¿‡**</span><br><span class="line">adm                                        **ä»æœªç™»å½•è¿‡**</span><br><span class="line">lp                                         **ä»æœªç™»å½•è¿‡**</span><br><span class="line">sync                                       **ä»æœªç™»å½•è¿‡**</span><br><span class="line">shutdown                                   **ä»æœªç™»å½•è¿‡**</span><br><span class="line">halt                                       **ä»æœªç™»å½•è¿‡**</span><br><span class="line">mail                                       **ä»æœªç™»å½•è¿‡**</span><br><span class="line">operator                                   **ä»æœªç™»å½•è¿‡**</span><br></pre></td></tr></table></figure>

<h3 id="3-5-last"><a href="#3-5-last" class="headerlink" title="3.5 last"></a>3.5 last</h3><p>åˆ—å‡ºå½“å‰å’Œæ›¾ç»ç™»å½•ç³»ç»Ÿçš„ç”¨æˆ·ä¿¡æ¯ã€‚é»˜è®¤è¯»å– <code>/var/log/wtmp</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict log]# last</span><br><span class="line">root     pts/0        121.32.197.136   Mon Jul 18 10:59   still logged in</span><br><span class="line">root     pts/0        121.32.199.178   Tue Jul 12 15:03 - 17:26  (02:23)</span><br><span class="line">root     pts/0        113.65.29.194    Wed Jun 29 16:04 - 20:12  (04:07)</span><br><span class="line">root     pts/0        113.65.29.194    Wed Jun 29 15:56 - 16:03  (00:06)</span><br><span class="line">root     pts/0        113.65.29.194    Wed Jun 29 15:55 - 15:56  (00:00)</span><br><span class="line">reboot   system boot  3.10.0-1160.66.1 Wed Jun 29 23:54 - 13:54 (18+14:00)</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>last -f</code> å‚æ•°æŒ‡å®šè¯»å–æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯ <code>/var/log/btmp</code>ï¼Œ<code>/var/run/utmp</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict log]# last -f /var/run/utmp</span><br><span class="line">root     pts/0        121.32.197.136   Mon Jul 18 10:59   still logged in</span><br><span class="line">reboot   system boot  3.10.0-1160.66.1 Wed Jun 29 23:54 - 13:55 (18+14:01)</span><br><span class="line"></span><br><span class="line">utmp begins Wed Jun 29 23:54:09 2022</span><br></pre></td></tr></table></figure>

<h3 id="3-6-lastb"><a href="#3-6-lastb" class="headerlink" title="3.6 lastb"></a>3.6 lastb</h3><p>åˆ—å‡ºå¤±è´¥çš„å°è¯•ç™»é™†ä¿¡æ¯ï¼Œå’Œ last å‘½ä»¤åŠŸèƒ½ç›¸åŒï¼Œä¸è¿‡é»˜è®¤è¯»å–çš„æ–‡ä»¶æ˜¯ï¼š<code>/var/log/btmp</code>ã€‚<br>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ <code>-f</code> å‚æ•°æŒ‡å®šå…¶ä»–çš„è¯»å–æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict log]# lastb -n 20</span><br><span class="line">avorion  ssh:notty    150.185.5.6      Mon Jul 18 13:25 - 13:25  (00:00)</span><br><span class="line">admin    ssh:notty    109.197.194.157  Mon Jul 18 13:18 - 13:18  (00:00)</span><br><span class="line">admin    ssh:notty    150.185.10.122   Mon Jul 18 13:18 - 13:18  (00:00)</span><br><span class="line">lucas    ssh:notty    103.169.34.130   Mon Jul 18 12:57 - 12:57  (00:00)</span><br><span class="line">abby     ssh:notty    193.122.108.42   Mon Jul 18 12:55 - 12:55  (00:00)</span><br><span class="line">nick     ssh:notty    195.218.137.42   Mon Jul 18 12:53 - 12:53  (00:00)</span><br><span class="line">anurag   ssh:notty    43.128.104.254   Mon Jul 18 12:40 - 12:40  (00:00)</span><br><span class="line">admin    ssh:notty    206.189.87.108   Mon Jul 18 12:32 - 12:32  (00:00)</span><br><span class="line">testuser ssh:notty    192.3.211.39     Mon Jul 18 12:31 - 12:31  (00:00)</span><br><span class="line">quagga   ssh:notty    118.27.36.26     Mon Jul 18 12:30 - 12:30  (00:00)</span><br><span class="line">ismael   ssh:notty    175.47.205.72    Mon Jul 18 12:28 - 12:28  (00:00)</span><br><span class="line">tanya    ssh:notty    62.64.86.44      Mon Jul 18 12:26 - 12:26  (00:00)</span><br><span class="line">weixin   ssh:notty    218.111.88.185   Mon Jul 18 12:25 - 12:25  (00:00)</span><br><span class="line">bob      ssh:notty    121.26.142.238   Mon Jul 18 11:29 - 11:29  (00:00)</span><br><span class="line">test03   ssh:notty    190.147.165.61   Mon Jul 18 11:25 - 11:25  (00:00)</span><br><span class="line">ubuntu   ssh:notty    107.184.205.109  Mon Jul 18 10:33 - 10:33  (00:00)</span><br><span class="line">cafe24   ssh:notty    190.246.155.29   Mon Jul 18 10:11 - 10:11  (00:00)</span><br><span class="line">upload   ssh:notty    196.20.68.81     Mon Jul 18 10:09 - 10:09  (00:00)</span><br><span class="line">postgres ssh:notty    202.29.13.51     Mon Jul 18 10:07 - 10:07  (00:00)</span><br><span class="line">scanner  ssh:notty    111.67.197.134   Mon Jul 18 08:18 - 08:18  (00:00)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°å­˜åœ¨ <code>ssh</code> æš´åŠ›ç ´è§£çš„æƒ…å†µã€‚</p>
<h3 id="3-7-utmpdump"><a href="#3-7-utmpdump" class="headerlink" title="3.7 utmpdump"></a>3.7 utmpdump</h3><p>ç”¨äºè½¬å‚¨äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åˆ°æ–‡æœ¬æ ¼å¼çš„çš„æ–‡ä»¶ä»¥ä¾¿æŸ¥çœ‹ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¿®æ”¹äºŒè¿›åˆ¶æ–‡ä»¶ã€‚åŒ…æ‹¬</p>
<ul>
<li><code>/var/run/utmp</code></li>
<li><code>/var/log/wtmp</code></li>
<li><code>/var/log/btmp</code></li>
</ul>
<p>ä¿®æ”¹æ–‡ä»¶å¯ä»¥ç¯¡æ”¹è®°å½•ï¼Œæ‰€ä»¥æƒé™ä¸€å®šè¦ä¸¥æ ¼é™å®šï¼Œé˜²æ­¢éæ³•æ“ä½œï¼Œä¾‹å¦‚ç¯¡æ”¹ <code>wtmp</code> æ–‡ä»¶ä¸­çš„ç™»å½•åœ°å€ï¼Œç¥¸æ°´ä¸œå¼•ã€‚</p>
<p>æŸ¥çœ‹ <code>wtmp</code> æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict log]# utmpdump wtmp</span><br><span class="line">Utmp dump of wtmp</span><br><span class="line">[8] [01088] [tyS0] [        ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 5æœˆ 25 10:46:00 2022   ]</span><br><span class="line">[8] [01089] [tty1] [        ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 5æœˆ 25 10:46:00 2022   ]</span><br><span class="line">[2] [00000] [~~  ] [reboot  ] [~           ] [3.10.0-1160.66.1.el7.x86_64] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 23:54:09 2022   ]</span><br><span class="line">[1] [00051] [~~  ] [runlevel] [~           ] [3.10.0-1160.66.1.el7.x86_64] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[5] [01060] [tty1] [        ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[5] [01059] [tyS0] [        ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[6] [01060] [tty1] [LOGIN   ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[6] [01059] [tyS0] [LOGIN   ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[7] [01379] [ts/0] [root    ] [pts/0       ] [113.65.29.194       ] [113.65.29.194  ] [ä¸‰ 6æœˆ 29 15:55:51 2022   ]</span><br><span class="line">[8] [01377] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:56:27 2022   ]</span><br><span class="line">[7] [01404] [ts/0] [root    ] [pts/0       ] [113.65.29.194       ] [113.65.29.194  ] [ä¸‰ 6æœˆ 29 15:56:29 2022   ]</span><br><span class="line">[8] [01402] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 16:03:01 2022   ]</span><br><span class="line">[7] [01589] [ts/0] [root    ] [pts/0       ] [113.65.29.194       ] [113.65.29.194  ] [ä¸‰ 6æœˆ 29 16:04:39 2022   ]</span><br><span class="line">[8] [01587] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 20:12:05 2022   ]</span><br><span class="line">[7] [04064] [ts/0] [root    ] [pts/0       ] [121.32.199.178      ] [121.32.199.178 ] [äºŒ 7æœˆ 12 15:03:05 2022   ]</span><br><span class="line">[8] [04062] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [äºŒ 7æœˆ 12 17:26:21 2022   ]</span><br><span class="line">[7] [14985] [ts/0] [root    ] [pts/0       ] [121.32.197.136      ] [121.32.197.136 ] [ä¸€ 7æœˆ 18 10:59:15 2022   ]</span><br></pre></td></tr></table></figure>

<p>æ¨¡æ‹Ÿä¿®æ”¹æœ€åä¸€è¡Œçš„ <code>IP</code> åœ°å€ï¼ŒæŠŠ <code>121.32.197.136</code> ä¿®æ”¹ä¸º <code>121.32.197.122</code></p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šå¯¼å‡ºæ–‡æœ¬ä¿¡æ¯</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict log]# utmpdump wtmp &gt; tmp_wtmp</span><br><span class="line">Utmp dump of wtmp</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ tmp_wtmp æ–‡ä»¶</strong></p>
<p>å°† <code>121.32.197.136</code> ä¿®æ”¹ä¸º <code>121.32.197.122</code></p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šè¦†ç›–æºæ–‡ä»¶</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict log]# utmpdump -r tmp_wtmp &gt; wtmp</span><br><span class="line">Utmp undump of tmp_wtmp</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬å››æ­¥ï¼šå†æ¬¡æŸ¥çœ‹ï¼Œè¿›è¡Œç¡®è®¤</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@kycool-strict log]# utmpdump wtmp</span><br><span class="line">Utmp dump of wtmp</span><br><span class="line">[8] [01088] [tyS0] [        ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 5æœˆ 25 10:46:00 2022   ]</span><br><span class="line">[8] [01089] [tty1] [        ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 5æœˆ 25 10:46:00 2022   ]</span><br><span class="line">[2] [00000] [~~  ] [reboot  ] [~           ] [3.10.0-1160.66.1.el7.x86_64] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 23:54:09 2022   ]</span><br><span class="line">[1] [00051] [~~  ] [runlevel] [~           ] [3.10.0-1160.66.1.el7.x86_64] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[5] [01060] [tty1] [        ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[5] [01059] [tyS0] [        ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[6] [01060] [tty1] [LOGIN   ] [tty1        ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[6] [01059] [tyS0] [LOGIN   ] [ttyS0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:54:19 2022   ]</span><br><span class="line">[7] [01379] [ts/0] [root    ] [pts/0       ] [113.65.29.194       ] [113.65.29.194  ] [ä¸‰ 6æœˆ 29 15:55:51 2022   ]</span><br><span class="line">[8] [01377] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 15:56:27 2022   ]</span><br><span class="line">[7] [01404] [ts/0] [root    ] [pts/0       ] [113.65.29.194       ] [113.65.29.194  ] [ä¸‰ 6æœˆ 29 15:56:29 2022   ]</span><br><span class="line">[8] [01402] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 16:03:01 2022   ]</span><br><span class="line">[7] [01589] [ts/0] [root    ] [pts/0       ] [113.65.29.194       ] [113.65.29.194  ] [ä¸‰ 6æœˆ 29 16:04:39 2022   ]</span><br><span class="line">[8] [01587] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [ä¸‰ 6æœˆ 29 20:12:05 2022   ]</span><br><span class="line">[7] [04064] [ts/0] [root    ] [pts/0       ] [121.32.199.178      ] [121.32.199.178 ] [äºŒ 7æœˆ 12 15:03:05 2022   ]</span><br><span class="line">[8] [04062] [    ] [        ] [pts/0       ] [                    ] [0.0.0.0        ] [äºŒ 7æœˆ 12 17:26:21 2022   ]</span><br><span class="line">[7] [14985] [ts/0] [root    ] [pts/0       ] [121.32.197.122      ] [121.32.197.122 ] [ä¸€ 7æœˆ 18 10:59:15 2022   ]</span><br></pre></td></tr></table></figure>

<p>æœ€åä¸€è¡Œä¸­çš„ <code>IP</code> åœ°å€å·²ç»å˜æˆäº† <code>121.32.197.122</code></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>æ—¥å¿—</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux ä¸åŒçš„å‘è¡Œç‰ˆè®¾ç½®é™æ€ IP</title>
    <url>/posts/29624/</url>
    <content><![CDATA[<p>è¿‘æ¥åœ¨æŠ˜è…¾æœ¬åœ°æœåŠ¡å™¨ï¼Œä¸ºäº†æ–¹å¼æ¯æ¬¡é‡å¯ IP åœ°å€çš„å˜åŒ–ï¼Œæ‰€ä»¥è¦ç»™æœºå™¨è®¾ç½®é™æ€ IP <span id="more"></span></p>
<h2 id="ä¸€-ä¸åŒå‘è¡Œç‰ˆé™æ€-IP-è®¾ç½®"><a href="#ä¸€-ä¸åŒå‘è¡Œç‰ˆé™æ€-IP-è®¾ç½®" class="headerlink" title="ä¸€ ä¸åŒå‘è¡Œç‰ˆé™æ€ IP è®¾ç½®"></a>ä¸€ ä¸åŒå‘è¡Œç‰ˆé™æ€ IP è®¾ç½®</h2><h3 id="1-Centos-è®¾ç½®é™æ€-IP"><a href="#1-Centos-è®¾ç½®é™æ€-IP" class="headerlink" title="1 Centos è®¾ç½®é™æ€ IP"></a>1 Centos è®¾ç½®é™æ€ IP</h3><h4 id="1-1-æ‰¾å‡ºéœ€è¦è®¾ç½®é™æ€-IP-çš„ç½‘ç»œæ¥å£åç§°"><a href="#1-1-æ‰¾å‡ºéœ€è¦è®¾ç½®é™æ€-IP-çš„ç½‘ç»œæ¥å£åç§°" class="headerlink" title="1.1 æ‰¾å‡ºéœ€è¦è®¾ç½®é™æ€ IP çš„ç½‘ç»œæ¥å£åç§°"></a>1.1 æ‰¾å‡ºéœ€è¦è®¾ç½®é™æ€ IP çš„ç½‘ç»œæ¥å£åç§°</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[isproot@192 ~]$ nmcli device status</span><br><span class="line">DEVICE      TYPE      STATE      CONNECTION</span><br><span class="line">eth192        ethernet  connected  System eth192</span><br><span class="line">virbr0      bridge    connected  virbr0</span><br><span class="line">lo          loopback  unmanaged  --</span><br><span class="line">virbr0-nic  tun       unmanaged  --</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°éœ€è¦è®¾ç½®çš„æ¥å£å¯¹åº”çš„åç§°æ˜¯ <code>eth192</code></p>
<h4 id="1-2-ä¿®æ”¹ç½‘ç»œæ¥å£ç›¸å…³çš„é…ç½®æ–‡ä»¶"><a href="#1-2-ä¿®æ”¹ç½‘ç»œæ¥å£ç›¸å…³çš„é…ç½®æ–‡ä»¶" class="headerlink" title="1.2 ä¿®æ”¹ç½‘ç»œæ¥å£ç›¸å…³çš„é…ç½®æ–‡ä»¶"></a>1.2 ä¿®æ”¹ç½‘ç»œæ¥å£ç›¸å…³çš„é…ç½®æ–‡ä»¶</h4><p>è¯¥æ–‡ä»¶é€šå¸¸ä½äº <code>/etc/sysconfig/network-scripts/</code> ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åæ ¼å¼ä¸º <code>ifcfg-&lt;æ¥å£åç§°&gt;</code>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¥å£åç§°ä¸º ens33ï¼Œéœ€è¦ç¼–è¾‘ &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33 æ–‡ä»¶ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰“å¼€æ–‡ä»¶ï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig<span class="regexp">/network-scripts/i</span>fcfg-eth192</span><br></pre></td></tr></table></figure>

<p>ç„¶ååšä»¥ä¸‹æ”¹åŠ¨</p>
<ol>
<li>æ‰¾åˆ° <code>BOOTPROTO=dhcp</code> è¡Œï¼Œå°† <code>dhcp</code> æ›´æ”¹ä¸º <code>static</code> æˆ– <code>none</code></li>
<li>åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œ</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é™æ€ IP</span></span><br><span class="line">IPADDR=<span class="number">192.168</span><span class="number">.1</span><span class="number">.12</span></span><br><span class="line"><span class="comment"># é»˜è®¤ç½‘å…³</span></span><br><span class="line">GATEWAY=<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line"><span class="comment"># è¿™é‡Œå¯ä»¥ä½¿ç”¨ static æˆ–è€… no</span></span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens192</span><br><span class="line">UUID=cd93f1df-d2d5-4c63-a64c-761e9ee23aae</span><br><span class="line">DEVICE=ens192</span><br><span class="line"><span class="comment"># å¼€æœºå¯ç”¨æ­¤é…ç½®</span></span><br><span class="line">ONBOOT=yes</span><br><span class="line"><span class="comment"># é™æ€ IP</span></span><br><span class="line">IPADDR=<span class="number">192.168</span><span class="number">.1</span><span class="number">.12</span></span><br><span class="line"><span class="comment"># é»˜è®¤ç½‘å…³</span></span><br><span class="line">GATEWAY=<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h4 id="1-3-é‡å¯ç½‘ç»œæœåŠ¡"><a href="#1-3-é‡å¯ç½‘ç»œæœåŠ¡" class="headerlink" title="1.3 é‡å¯ç½‘ç»œæœåŠ¡"></a>1.3 é‡å¯ç½‘ç»œæœåŠ¡</h4><p>å¯¹äº <code>Centos7</code>:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">systemctl restart network</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äº <code>Centos8</code>:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">systemctl restart NetworkManager</span></span><br></pre></td></tr></table></figure>

<h4 id="1-4-æŸ¥çœ‹åœ°å€"><a href="#1-4-æŸ¥çœ‹åœ°å€" class="headerlink" title="1.4 æŸ¥çœ‹åœ°å€"></a>1.4 æŸ¥çœ‹åœ°å€</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[isproot@192 ~]$ ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:51:63:21 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.1.12/24 brd 192.168.1.255 scope global noprefixroute ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 2408:8256:a80:313:6ba6:7ad0:edd0:defe/64 scope global noprefixroute dynamic</span><br><span class="line">       valid_lft 183241sec preferred_lft 96841sec</span><br><span class="line">    inet6 fe80::b6f3:1daa:4b7b:6994/64 scope link noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼ŒCentOS ç³»ç»Ÿåº”è¯¥ä½¿ç”¨æŒ‡å®šçš„é™æ€ IP åœ°å€è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚è¯·æ³¨æ„ï¼Œä¸ºäº†é¿å… IP åœ°å€å†²çªï¼Œæ‚¨éœ€è¦ç¡®ä¿åˆ†é…ç»™ CentOS ç³»ç»Ÿçš„é™æ€ IP åœ°å€åœ¨æœ¬åœ°ç½‘ç»œä¸­æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”ä¸åœ¨ DHCP æœåŠ¡å™¨çš„åˆ†é…èŒƒå›´å†…</p>
<h3 id="2-Debian-è®¾ç½®é™æ€-IP"><a href="#2-Debian-è®¾ç½®é™æ€-IP" class="headerlink" title="2 Debian è®¾ç½®é™æ€ IP"></a>2 Debian è®¾ç½®é™æ€ IP</h3><h4 id="2-1-æ‰¾å‡ºéœ€è¦è®¾ç½®é™æ€-IP-çš„ç½‘ç»œæ¥å£åç§°"><a href="#2-1-æ‰¾å‡ºéœ€è¦è®¾ç½®é™æ€-IP-çš„ç½‘ç»œæ¥å£åç§°" class="headerlink" title="2.1 æ‰¾å‡ºéœ€è¦è®¾ç½®é™æ€ IP çš„ç½‘ç»œæ¥å£åç§°"></a>2.1 æ‰¾å‡ºéœ€è¦è®¾ç½®é™æ€ IP çš„ç½‘ç»œæ¥å£åç§°</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@debian:~# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:92:2d:16 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.1.103/24 brd 192.168.1.255 scope global noprefixroute ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::6c5d:abfc:8b6:bd5c/64 scope link noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>å°†çœ‹åˆ°ç±»ä¼¼äº eth0ã€enp0s3 æˆ– enp192 ç­‰çš„æ¥å£åç§°ã€‚è¯·è®°ä¸‹è¦è®¾ç½®é™æ€ IP çš„æ¥å£åç§°ï¼Œè¿™é‡Œéœ€è¦è°ƒæ•´çš„æ¥å£å³ä¸º <code>eth192</code></p>
<h4 id="2-2-ä¿®æ”¹ç½‘ç»œé…ç½®"><a href="#2-2-ä¿®æ”¹ç½‘ç»œé…ç½®" class="headerlink" title="2.2 ä¿®æ”¹ç½‘ç»œé…ç½®"></a>2.2 ä¿®æ”¹ç½‘ç»œé…ç½®</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/network/interfaces</span><br></pre></td></tr></table></figure>

<p>åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°æ‚¨è¦è®¾ç½®é™æ€ IP çš„æ¥å£ã€‚å®ƒåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">iface eth192 inet dhcp</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>eth192</code> æ˜¯ç½‘ç»œæ¥å£çš„åç§°ï¼Œ<code>dhcp</code> è¡¨ç¤ºè¯¥æ¥å£ä½¿ç”¨ <code>DHCP</code> è·å– IP åœ°å€ã€‚</p>
<p>å°† <code>dhcp</code> æ›´æ”¹ä¸º <code>static</code>ï¼Œç„¶åæ·»åŠ  <code>address</code>ã€<code>netmask</code>ã€<code>gateway</code> å’Œ <code>dns-nameservers</code> å‚æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">iface eth0 inet static</span><br><span class="line">    address <span class="number">192.168</span><span class="number">.1</span><span class="number">.11</span></span><br><span class="line">    netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">    gateway <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">    dns-nameservers <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span> <span class="number">8.8</span><span class="number">.4</span><span class="number">.4</span></span><br></pre></td></tr></table></figure>

<p>ç¡®ä¿ä½¿ç”¨é€‚å½“çš„ IP åœ°å€ã€å­ç½‘æ©ç ã€ç½‘å…³å’Œ DNS æœåŠ¡å™¨æ›¿æ¢ä¸Šè¿°ç¤ºä¾‹ä¸­çš„å€¼ã€‚</p>
<p>ä¿®æ”¹åæ–‡ä»¶å¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"></span><br><span class="line">source /etc/network/interfaces.d/*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The loopback network interface</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The primary network interface</span></span><br><span class="line">allow-hotplug ens192</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">iface ens192 inet dhcp</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®æˆé™æ€ IP</span></span><br><span class="line">iface ens192 inet static</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½® IP</span></span><br><span class="line">address 192.168.1.11</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å­ç½‘æ©ç </span></span><br><span class="line">netmask 255.255.255.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®ç½‘å…³</span></span><br><span class="line">gateway 192.168.1.1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½® DNS æœåŠ¡å™¨ï¼Œæˆ‘è¿™é‡Œè®¾ç½®æˆè·¯ç”±å™¨çš„åœ°å€</span></span><br><span class="line">dns-nameservers 192.168.1.1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is an autoconfigured IPv6 interface</span></span><br><span class="line">iface ens192 inet6 auto</span><br></pre></td></tr></table></figure>

<h4 id="2-3-é‡å¯ç½‘ç»œæœåŠ¡"><a href="#2-3-é‡å¯ç½‘ç»œæœåŠ¡" class="headerlink" title="2.3 é‡å¯ç½‘ç»œæœåŠ¡"></a>2.3 é‡å¯ç½‘ç»œæœåŠ¡</h4><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service networking restart</span></span><br></pre></td></tr></table></figure>

<h4 id="2-4-æŸ¥çœ‹åœ°å€"><a href="#2-4-æŸ¥çœ‹åœ°å€" class="headerlink" title="2.4 æŸ¥çœ‹åœ°å€"></a>2.4 æŸ¥çœ‹åœ°å€</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@debian:~# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:0a:14:07 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.1.11/24 brd 192.168.1.255 scope global ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 2408:8256:a81:c14f:20c:29ff:fe0a:1407/64 scope global dynamic mngtmpaddr</span><br><span class="line">       valid_lft 206755sec preferred_lft 120355sec</span><br><span class="line">    inet6 fe80::20c:29ff:fe0a:1407/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h2 id="äºŒ-å°ç»“"><a href="#äºŒ-å°ç»“" class="headerlink" title="äºŒ å°ç»“"></a>äºŒ å°ç»“</h2><p>ä»é…ç½®çš„è¿‡ç¨‹æ¥çœ‹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯é…ç½®æ–‡ä»¶çš„ç›®å½•å’Œé…ç½®é¡¹ä¸åŒè€Œå·²ï¼Œå…¶ä»–åŸºæœ¬ä¸Šéƒ½å·®ä¸å¤šï¼Œæ¯•ç«ŸåŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Debian</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§æ¨¡å‹ | CPU æ¨¡å¼éƒ¨ç½²è¿è¡Œ Qwen 2.5 å¤§æ¨¡å‹</title>
    <url>/posts/51728/</url>
    <content><![CDATA[<p>ç®€å•æ¢³ç†ä¸‹ä½¿ç”¨ vllm é€šè¿‡ CPU æ¨¡å¼ï¼Œéƒ¨ç½²è¿è¡Œ Qwen&#x2F;Qwen2.5-1.5B-Instruct<span id="more"></span></p>
<h3 id="1-ç¯å¢ƒå‡†å¤‡"><a href="#1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1 ç¯å¢ƒå‡†å¤‡"></a>1 ç¯å¢ƒå‡†å¤‡</h3><h4 id="1-1-æ“ä½œç³»ç»Ÿ"><a href="#1-1-æ“ä½œç³»ç»Ÿ" class="headerlink" title="1.1 æ“ä½œç³»ç»Ÿ"></a>1.1 æ“ä½œç³»ç»Ÿ</h4><p>ä½¿ç”¨çš„æ˜¯ <code>Ubuntu</code> ç‰ˆæœ¬å·ï¼š<code>24.04.1 LTS</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># lsb_release -a</span></span><br><span class="line"></span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:	Ubuntu</span><br><span class="line">Description:	Ubuntu <span class="number">24.04</span><span class="number">.1</span> LTS</span><br><span class="line">Release:	<span class="number">24.04</span></span><br><span class="line">Codename:	noble</span><br></pre></td></tr></table></figure>

<h4 id="1-2-conda-å®‰è£…"><a href="#1-2-conda-å®‰è£…" class="headerlink" title="1.2 conda å®‰è£…"></a>1.2 conda å®‰è£…</h4><p>python ç¯å¢ƒï¼Œä½¿ç”¨çš„æ˜¯ <code>Miniconda</code><br>å®‰è£…ç›´æ¥å‚è€ƒå®˜æ–¹æ–‡æ¡£å³å¯ï¼š<a href="https://docs.anaconda.com/miniconda/#quick-command-line-install">https://docs.anaconda.com/miniconda/#quick-command-line-install</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mkdir -p ~/miniconda3</span><br><span class="line">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh</span><br><span class="line">bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3</span><br><span class="line">rm -rf ~/miniconda3/miniconda.sh</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ¿€æ´» miniconda</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">conda init bash</span><br><span class="line"></span><br><span class="line">source /root/.bashrc</span><br></pre></td></tr></table></figure>

<h4 id="1-3-conda-é•œåƒè®¾ç½®"><a href="#1-3-conda-é•œåƒè®¾ç½®" class="headerlink" title="1.3 conda é•œåƒè®¾ç½®"></a>1.3 conda é•œåƒè®¾ç½®</h4><p>é…ç½®é•œåƒæ˜¯ä¸ºäº†åŠ é€Ÿå®‰è£…åŒ…ï¼Œä½¿ç”¨çš„æ˜¯ <code>æ¸…åå¤§å­¦</code> é•œåƒ<br>æ£€æŸ¥ç”¨æˆ·ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨ <code>.condarc</code>ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œåˆ›å»º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">conda config --<span class="built_in">set</span> show_channel_urls yes</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰“å¼€ .condarc æ–‡ä»¶ï¼Œè®¾ç½®æ¸…åå¤§å­¦é•œåƒ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">show_channel_urls: true</span><br><span class="line">channels:</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">  - defaults</span><br><span class="line">custom_channels:</span><br><span class="line">  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  pytorch-lts: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜åï¼Œé€šè¿‡ conda info æŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(base) root@local:~<span class="comment"># conda info</span></span><br><span class="line"></span><br><span class="line">     active environment : base</span><br><span class="line">    active env location : /root/miniconda3</span><br><span class="line">            shell level : <span class="number">1</span></span><br><span class="line">       user config file : /root/.condarc</span><br><span class="line"> populated config files : /root/.condarc</span><br><span class="line">          conda version : <span class="number">24.7</span><span class="number">.1</span></span><br><span class="line">    conda-build version : <span class="keyword">not</span> installed</span><br><span class="line">         python version : <span class="number">3.12</span><span class="number">.4</span>.final<span class="number">.0</span></span><br><span class="line">                 solver : libmamba (default)</span><br><span class="line">       virtual packages : __archspec=<span class="number">1</span>=haswell</span><br><span class="line">                          __conda=<span class="number">24.7</span><span class="number">.1</span>=<span class="number">0</span></span><br><span class="line">                          __glibc=<span class="number">2.39</span>=<span class="number">0</span></span><br><span class="line">                          __linux=<span class="number">6.8</span><span class="number">.0</span>=<span class="number">0</span></span><br><span class="line">                          __unix=<span class="number">0</span>=<span class="number">0</span></span><br><span class="line">       base environment : /root/miniconda3  (writable)</span><br><span class="line">      conda av data <span class="built_in">dir</span> : /root/miniconda3/etc/conda</span><br><span class="line">  conda av metadata url : <span class="literal">None</span></span><br><span class="line">           channel URLs : https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/linux-<span class="number">64</span></span><br><span class="line">                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/noarch</span><br><span class="line">                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/linux-<span class="number">64</span></span><br><span class="line">                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/noarch</span><br><span class="line">                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/linux-<span class="number">64</span></span><br><span class="line">                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/noarch</span><br><span class="line">                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/linux-<span class="number">64</span></span><br><span class="line">                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/noarch</span><br><span class="line">                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/linux-<span class="number">64</span></span><br><span class="line">                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/noarch</span><br><span class="line">                          https://repo.anaconda.com/pkgs/main/linux-<span class="number">64</span></span><br><span class="line">                          https://repo.anaconda.com/pkgs/main/noarch</span><br><span class="line">                          https://repo.anaconda.com/pkgs/r/linux-<span class="number">64</span></span><br><span class="line">                          https://repo.anaconda.com/pkgs/r/noarch</span><br><span class="line">          package cache : /root/miniconda3/pkgs</span><br><span class="line">                          /root/.conda/pkgs</span><br><span class="line">       envs directories : /root/miniconda3/envs</span><br><span class="line">                          /root/.conda/envs</span><br><span class="line">               platform : linux-<span class="number">64</span></span><br><span class="line">             user-agent : conda/<span class="number">24.7</span><span class="number">.1</span> requests/<span class="number">2.32</span><span class="number">.3</span> CPython/<span class="number">3.12</span><span class="number">.4</span> Linux/<span class="number">6.8</span><span class="number">.0</span>-<span class="number">47</span>-generic ubuntu/<span class="number">24.04</span><span class="number">.1</span> glibc/<span class="number">2.39</span> solver/libmamba conda-libmamba-solver/<span class="number">24.7</span><span class="number">.0</span> libmambapy/<span class="number">1.5</span><span class="number">.8</span> aau/<span class="number">0.4</span><span class="number">.4</span> c/. s/. e/.</span><br><span class="line">                UID:GID : <span class="number">0</span>:<span class="number">0</span></span><br><span class="line">             netrc file : <span class="literal">None</span></span><br><span class="line">           offline mode : <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h4 id="1-4-åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"><a href="#1-4-åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="1.4 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"></a>1.4 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h4><p>åˆ›å»ºç¯å¢ƒåä¸º <code>ravllm</code> çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½¿ç”¨çš„æ˜¯ <code>Python 3.10</code>ï¼Œç„¶åæ¿€æ´»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">conda create --name ravllM python=<span class="number">3.10</span> -y</span><br><span class="line"></span><br><span class="line">conda activate ravllM</span><br></pre></td></tr></table></figure>

<h4 id="1-5-å®‰è£…-vllm"><a href="#1-5-å®‰è£…-vllm" class="headerlink" title="1.5 å®‰è£… vllm"></a>1.5 å®‰è£… vllm</h4><p>å› ä¸º vllm é»˜è®¤æ”¯æŒ GPUï¼Œæ‰€ä»¥éœ€è¦å®‰è£… CPU ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦è‡ªè¡Œç¼–è¯‘å®‰è£…</p>
<blockquote>
<p>ğŸ”¥ å¦‚æœä½ æœ‰ GPU æ˜¾å¡ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨ GPU ç‰ˆæœ¬</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install vllm</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>ğŸ”¥ å¦‚æœä½ æ²¡æœ‰ GPU æ˜¾å¡ï¼Œå¦‚æœç”¨ CPU ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦è‡ªè¡Œç¼–è¯‘å®‰è£…</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… gcc ç¼–è¯‘å™¨</span></span><br><span class="line">apt update  -y</span><br><span class="line">apt install -y gcc-12 g++-12 libnuma-dev</span><br><span class="line">update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 10 --slave /usr/bin/g++ g++ /usr/bin/g++-12</span><br><span class="line">apt install -y cmake</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…‹éš† vllm ä»“åº“</span></span><br><span class="line">mkdir ~/codespace &amp;&amp; cd ~/codespace</span><br><span class="line">git clone https://github.com/vllm-project/vllm.git vllm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… vllm ä»“åº“æ‰€éœ€çš„ä¾èµ–</span></span><br><span class="line">cd vllm</span><br><span class="line">pip install wheel packaging ninja &quot;setuptools&gt;=49.4.0&quot; numpy</span><br><span class="line">pip install -v -r requirements-cpu.txt --extra-index-url https://download.pytorch.org/whl/cpu</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“åŒ…å®‰è£…</span></span><br><span class="line">VLLM_TARGET_DEVICE=cpu python setup.py install</span><br></pre></td></tr></table></figure>

<h3 id="2-å¤§æ¨¡å‹ä¸‹è½½"><a href="#2-å¤§æ¨¡å‹ä¸‹è½½" class="headerlink" title="2 å¤§æ¨¡å‹ä¸‹è½½"></a>2 å¤§æ¨¡å‹ä¸‹è½½</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… git ç¯å¢ƒ</span></span><br><span class="line">apt install -y git git-lfs</span><br><span class="line">git lfs install</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€šè¿‡ git ä¸‹è½½å¤§æ¨¡å‹</span></span><br><span class="line">mkdir -p ~/modelspace &amp;&amp; cd ~/modelspace</span><br><span class="line">git clone https://huggingface.co/Qwen/Qwen2.5-1.5B-Instruct Qwen2.5-1.5B-Instruct</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>å¦‚æœä» <a href="https://huggingface.co/">https://huggingface.co</a> ä¸‹è½½è¾ƒæ…¢ï¼Œå¯ä»¥ä»å›½å†…çš„ <a href="https://www.modelscope.cn/">https://www.modelscope.cn</a> è¿›è¡Œä¸‹è½½</li>
<li>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ sdk æˆ–è€…å‘½ä»¤è¡Œçš„æ–¹å¼è¿›è¡Œä¸‹è½½ï¼Œå¯ä»¥è‡ªè¡Œå‚è€ƒå®˜æ–¹æ–‡æ¡£</li>
</ul>
<p>clone å®Œåï¼ŒæŸ¥çœ‹ä¸‹å¤§æ¨¡å‹ç›®å½•ç»“æ„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(base) root@local:~/modelspace/Qwen2.5-1.5B-Instruct# ls -lah</span><br><span class="line">total 2.9G</span><br><span class="line">drwxr-xr-x 3 root root 4.0K Oct 30 06:05 .</span><br><span class="line">drwxr-xr-x 5 root root 4.0K Oct 30 07:11 ..</span><br><span class="line">-rw-r--r-- 1 root root  660 Oct 30 06:05 config.json</span><br><span class="line">-rw-r--r-- 1 root root  242 Oct 30 06:05 generation_config.json</span><br><span class="line">drwxr-xr-x 8 root root 4.0K Oct 30 06:07 .git</span><br><span class="line">-rw-r--r-- 1 root root 1.5K Oct 30 06:05 .gitattributes</span><br><span class="line">-rw-r--r-- 1 root root  12K Oct 30 06:05 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root 1.6M Oct 30 06:05 merges.txt</span><br><span class="line">-rw-r--r-- 1 root root 2.9G Oct 30 06:05 model.safetensors</span><br><span class="line">-rw-r--r-- 1 root root 4.9K Oct 30 06:05 README.md</span><br><span class="line">-rw-r--r-- 1 root root 7.2K Oct 30 06:05 tokenizer_config.json</span><br><span class="line">-rw-r--r-- 1 root root 6.8M Oct 30 06:05 tokenizer.json</span><br><span class="line">-rw-r--r-- 1 root root 2.7M Oct 30 06:05 vocab.json</span><br></pre></td></tr></table></figure>

<h3 id="3-æ¨¡å‹éƒ¨ç½²"><a href="#3-æ¨¡å‹éƒ¨ç½²" class="headerlink" title="3 æ¨¡å‹éƒ¨ç½²"></a>3 æ¨¡å‹éƒ¨ç½²</h3><h4 id="3-1-ç›´æ¥é€šè¿‡è„šæœ¬"><a href="#3-1-ç›´æ¥é€šè¿‡è„šæœ¬" class="headerlink" title="3.1 ç›´æ¥é€šè¿‡è„šæœ¬"></a>3.1 ç›´æ¥é€šè¿‡è„šæœ¬</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"><span class="keyword">from</span> vllm <span class="keyword">import</span> LLM, SamplingParams</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">os.environ[<span class="string">&#x27;VLLM_TARGET_DEVICE&#x27;</span>] = <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹ IDï¼šæˆ‘ä»¬ä¸‹è½½çš„æ¨¡å‹æƒé‡æ–‡ä»¶ç›®å½•</span></span><br><span class="line">model_dir = <span class="string">&#x27;/root/modelspace/Qwen2.5-1.5B-Instruct&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Tokenizer åˆå§‹åŒ–</span></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(</span><br><span class="line">    model_dir,</span><br><span class="line">    local_files_only=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">messages = [</span><br><span class="line">    &#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;You are a helpful assistant.&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;è·Ÿæˆ‘è®²è®²è‚¡å¸‚è¿è¡Œçš„é€»è¾‘&#x27;</span>&#125;</span><br><span class="line">]</span><br><span class="line">text = tokenizer.apply_chat_template(</span><br><span class="line">    messages,</span><br><span class="line">    tokenize=<span class="literal">False</span>,</span><br><span class="line">    add_generation_prompt=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">llm = LLM(</span><br><span class="line">    model=model_dir,</span><br><span class="line">    tensor_parallel_size=<span class="number">1</span>,</span><br><span class="line">    device=<span class="string">&#x27;cpu&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">sampling_params = SamplingParams(temperature=<span class="number">0.7</span>, top_p=<span class="number">0.8</span>, repetition_penalty=<span class="number">1.05</span>, max_tokens=<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">outputs = llm.generate([text], sampling_params)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> output <span class="keyword">in</span> outputs:</span><br><span class="line">    prompt = output.prompt</span><br><span class="line">    generated_text = output.outputs[<span class="number">0</span>].text</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;æç¤ºè¯ï¼š<span class="subst">&#123;prompt!r&#125;</span>, å¤§æ¨¡å‹æ¨ç†ç»“æœè¾“å‡ºï¼š<span class="subst">&#123;generated_text!r&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æ¿€æ´»çš„ ravllm ç¯å¢ƒä¸‹è¿è¡Œæ­¤è„šæœ¬ï¼Œåœ¨ç»“æœæœªè¾“å‡ºä¹‹å‰ï¼Œçœ‹ä¸‹å†…å­˜å’Œ CPU çš„çŠ¶æ€<br><img src="/posts/51728/cpu-status.png" alt="cpu-status.png"></p>
<p>å¯ä»¥çœ‹åˆ° 16 æ ¸çš„ CPU éƒ½åœ¨åŠªåŠ›çš„å·¥ä½œã€‚</p>
<p>æ¨ç†ç»“æŸï¼Œæ¨ç†ç»“æœå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(ravllm) root@local:~/lmcode/25# python local.py</span><br><span class="line">INFO 10-31 08:51:52 importing.py:13] Triton not installed; certain</span><br><span class="line">GPU-related functions will not be available.</span><br><span class="line">WARNING 10-31 08:52:02 config.py:421] Async output processing is</span><br><span class="line">only supported for CUDA, TPU, XPU. Disabling it for other platforms.</span><br><span class="line"></span><br><span class="line">INFO 10-31 08:52:02 llm_engine.py:240] Initializing an LLM engine</span><br><span class="line">(v0.6.3.post2.dev76+g51c24c97) with config: model=&#x27;/root/modelspace/</span><br><span class="line">Qwen2.5-1.5B-Instruct&#x27;, speculative_config=None, tokenizer=&#x27;/root/</span><br><span class="line">modelspace/Qwen2.5-1.5B-Instruct&#x27;, skip_tokenizer_init=False,</span><br><span class="line">tokenizer_mode=auto, revision=None, override_neuron_config=None,</span><br><span class="line">rope_scaling=None, rope_theta=None, tokenizer_revision=None,</span><br><span class="line">trust_remote_code=False, dtype=torch.bfloat16, max_seq_len=32768,</span><br><span class="line">download_dir=None, load_format=LoadFormat.AUTO,</span><br><span class="line">tensor_parallel_size=1, pipeline_parallel_size=1,</span><br><span class="line">disable_custom_all_reduce=False, quantization=None,</span><br><span class="line">enforce_eager=False, kv_cache_dtype=auto,</span><br><span class="line">quantization_param_path=None, device_config=cpu,</span><br><span class="line">decoding_config=DecodingConfig(guided_decoding_backend=&#x27;outlines&#x27;),</span><br><span class="line">observability_config=ObservabilityConfig(otlp_traces_endpoint=None,</span><br><span class="line">collect_model_forward_time=False, collect_model_execute_time=False),</span><br><span class="line">seed=0, served_model_name=/root/modelspace/Qwen2.5-1.5B-Instruct,</span><br><span class="line">num_scheduler_steps=1, chunked_prefill_enabled=False</span><br><span class="line">multi_step_stream_outputs=True, enable_prefix_caching=False,</span><br><span class="line">use_async_output_proc=False, use_cached_outputs=False,</span><br><span class="line">mm_processor_kwargs=None)</span><br><span class="line"></span><br><span class="line">WARNING 10-31 08:52:03 cpu_executor.py:332] CUDA graph is not</span><br><span class="line">supported on CPU, fallback to the eager mode.</span><br><span class="line"></span><br><span class="line">WARNING 10-31 08:52:03 cpu_executor.py:362] Environment variable</span><br><span class="line">VLLM_CPU_KVCACHE_SPACE (GB) for CPU backend is not set, using 4 by</span><br><span class="line">default.</span><br><span class="line">INFO 10-31 08:52:03 selector.py:193]</span><br><span class="line">Cannot use _Backend.FLASH_ATTN backend on CPU.</span><br><span class="line">INFO 10-31 08:52:03 selector.py:131] Using Torch SDPA backend.</span><br><span class="line">INFO 10-31 08:52:03 selector.py:193]</span><br><span class="line">Cannot use _Backend.FLASH_ATTN backend on CPU.</span><br><span class="line">INFO 10-31 08:52:03 selector.py:131] Using Torch SDPA backend.</span><br><span class="line">Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00&lt;?, ?it/s]</span><br><span class="line">Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00&lt;00:00,  1.43it/s]</span><br><span class="line">Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00&lt;00:00,  1.43it/s]</span><br><span class="line"></span><br><span class="line">INFO 10-31 08:52:05 cpu_executor.py:214] # CPU blocks: 9362</span><br><span class="line">Processed prompts:   0%|                  | 0/1</span><br><span class="line">[00:00&lt;?, ?it/s, eProcessed prompts: 100%|â–ˆ| 1/1</span><br><span class="line">[07:28&lt;00:00 44833s Processed prompts: 100%|â–ˆ| 1/1</span><br><span class="line">[07:28&lt;00:00, 448.33s</span><br><span class="line">Promptæç¤ºè¯:</span><br><span class="line">&#x27;&lt;|im_start|&gt;system\nYou are a helpful assistant.&lt;|im_end|&gt;\n</span><br><span class="line">&lt;|im_start|&gt;user\nè·Ÿæˆ‘è®²è®²è‚¡å¸‚è¿è¡Œçš„é€»è¾‘&lt;|im_end|&gt;\n</span><br><span class="line">&lt;|im_start|&gt;assistant\n&#x27;,</span><br><span class="line">å¤§æ¨¡å‹æ¨ç†è¾“å‡º: &#x27;è‚¡å¸‚æ˜¯ä¸€ä¸ªå¤æ‚çš„å¸‚åœºï¼Œå…¶è¿è¡Œå—åˆ°å¤šç§</span><br><span class="line">å› ç´ çš„å½±å“ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬çš„é€»è¾‘ï¼š\n\n1. ä¾›æ±‚å…³ç³»ï¼šè‚¡ç¥¨ä»·æ ¼é€šå¸¸ç”±ä¾›ç»™å’Œéœ€æ±‚å†³å®šã€‚</span><br><span class="line">å¦‚æœå¸‚åœºä¸Šæœ‰æ›´å¤šçš„äººæƒ³è¦è´­ä¹°è‚¡ç¥¨ï¼Œè€Œä¾›åº”è€…å´æœ‰é™ï¼Œé‚£ä¹ˆè‚¡ç¥¨çš„ä»·æ ¼å°±ä¼šä¸Šå‡ã€‚åä¹‹ï¼Œå¦‚</span><br><span class="line">æœä¾›åº”é‡å¤§äºéœ€æ±‚é‡ï¼Œè‚¡ç¥¨çš„ä»·æ ¼å°±ä¼šä¸‹é™ã€‚\n\n2. å…¬å¸åŸºæœ¬é¢ï¼šå…¬å¸çš„è´¢åŠ¡çŠ¶å†µã€ç›ˆåˆ©èƒ½</span><br><span class="line">åŠ›ã€å¢é•¿æ½œåŠ›ç­‰å› ç´ éƒ½ä¼šå½±å“è‚¡ç¥¨ä»·æ ¼ã€‚æŠ•èµ„è€…ä¼šå…³æ³¨å…¬å¸çš„ç›ˆåˆ©é¢„æµ‹ã€å¸‚ç›ˆç‡ã€è‚¡æ¯æ”¯ä»˜ç­‰</span><br><span class="line">æŒ‡æ ‡ã€‚\n\n3. å¸‚åœºæƒ…ç»ªï¼šå¸‚åœºæƒ…ç»ªä¹Ÿä¼šå½±å“è‚¡ç¥¨ä»·æ ¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»æµè¡°é€€æ—¶æœŸï¼ŒæŠ•èµ„è€…å¯èƒ½</span><br><span class="line">ä¼šæ›´åŠ è°¨æ…ï¼Œä»è€Œå¯¼è‡´è‚¡ç¥¨ä»·æ ¼ä¸‹è·Œã€‚è€Œåœ¨ç»æµç¹è£æ—¶æœŸï¼ŒæŠ•èµ„è€…å¯èƒ½ä¼šæ›´åŠ ä¹è§‚ï¼Œå¯¼è‡´è‚¡ç¥¨</span><br><span class="line">ä»·æ ¼ä¸Šæ¶¨ã€‚\n\n4. åˆ©ç‡æ°´å¹³ï¼šåˆ©ç‡æ°´å¹³ä¹Ÿä¼šå½±å“è‚¡ç¥¨ä»·æ ¼ã€‚å½“åˆ©ç‡ä¸Šå‡æ—¶ï¼ŒæŠ•èµ„è€…å¯èƒ½ä¼šæ›´</span><br><span class="line">æ„¿æ„å°†èµ„é‡‘æŠ•èµ„äºå€ºåˆ¸ç­‰å›ºå®šæ”¶ç›Šäº§å“ï¼Œè€Œä¸æ˜¯è‚¡ç¥¨ï¼Œä»è€Œå¯¼è‡´è‚¡ç¥¨ä»·æ ¼ä¸‹è·Œã€‚ç›¸åï¼Œå½“åˆ©ç‡</span><br><span class="line">ä¸‹é™æ—¶ï¼Œè‚¡ç¥¨ä»·æ ¼å¯èƒ½ä¼šä¸Šæ¶¨ã€‚\n\n5. å¤–éƒ¨äº‹ä»¶ï¼šå¤–éƒ¨äº‹ä»¶ï¼Œå¦‚è‡ªç„¶ç¾å®³ã€æ”¿ç­–å˜åŒ–ã€åœ°ç¼˜</span><br><span class="line">æ”¿æ²»å†²çªç­‰ï¼Œä¹Ÿå¯èƒ½å¯¹è‚¡å¸‚äº§ç”Ÿé‡å¤§å½±å“ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›å› ç´ å¹¶ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œå®ƒä»¬</span><br><span class="line">ä¹‹é—´å¯èƒ½å­˜åœ¨ç›¸äº’ä½œç”¨ã€‚æ­¤å¤–ï¼Œè‚¡å¸‚ä»·æ ¼ä¹Ÿä¼šå—åˆ°å…¶ä»–å„ç§å› ç´ çš„å½±å“ï¼Œå¦‚å…¬å¸ä¸šç»©ã€æ–°é—»æŠ¥</span><br><span class="line">é“ã€å¸‚åœºé¢„æœŸç­‰ã€‚å› æ­¤ï¼ŒæŠ•èµ„è€…éœ€è¦ç»¼åˆè€ƒè™‘å„ç§å› ç´ ï¼Œå¹¶ç»“åˆè‡ªå·±çš„æŠ•èµ„ç­–ç•¥è¿›è¡Œå†³ç­–ã€‚&#x27;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>äººå·¥æ™ºèƒ½</category>
      </categories>
      <tags>
        <tag>å¤§æ¨¡å‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql | ç´¢å¼•æŸ¥è¯¢</title>
    <url>/posts/8256/</url>
    <content><![CDATA[<p>å‘ç°äº†ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢<span id="more"></span>ï¼Œ</p>
<blockquote>
<p>mysql ç‰ˆæœ¬ï¼š8.x</p>
</blockquote>
<h2 id="1-æŸ¥è¯¢è¯­æ³•"><a href="#1-æŸ¥è¯¢è¯­æ³•" class="headerlink" title="1 æŸ¥è¯¢è¯­æ³•"></a>1 æŸ¥è¯¢è¯­æ³•</h2><h3 id="1-1-è¯­æ³•è§£è¯»"><a href="#1-1-è¯­æ³•è§£è¯»" class="headerlink" title="1.1 è¯­æ³•è§£è¯»"></a>1.1 è¯­æ³•è§£è¯»</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> [EXTENDED] &#123;INDEX <span class="operator">|</span> INDEXES <span class="operator">|</span> KEYS&#125;</span><br><span class="line">    &#123;<span class="keyword">FROM</span> <span class="operator">|</span> <span class="keyword">IN</span>&#125; tbl_name</span><br><span class="line">    [&#123;<span class="keyword">FROM</span> <span class="operator">|</span> <span class="keyword">IN</span>&#125; db_name]</span><br><span class="line">    [<span class="keyword">WHERE</span> expr]</span><br></pre></td></tr></table></figure>

<p><strong>è¯­æ³•è§£è¯»</strong><br>è¿™æ˜¯ <code>SHOW INDEX</code> å‘½ä»¤çš„å®Œæ•´è¯­æ³•ï¼Œä¸‹é¢æˆ‘å°†é€ä¸ªè§£é‡Šæ¯ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><code>SHOW</code>ï¼šè¿™æ˜¯å¼€å§‹æ‰§è¡Œå‘½ä»¤çš„å…³é”®å­—ã€‚</li>
<li><code>[EXTENDED]</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å…³é”®å­—ï¼Œå¦‚æœä½¿ç”¨äº†ï¼Œå®ƒä¼šæ˜¾ç¤ºéšè—çš„ç´¢å¼•ã€‚</li>
<li><code>&#123;INDEX | INDEXES | KEYS&#125;</code>ï¼šä½ å¯ä»¥é€‰æ‹©å…¶ä¸­ä»»ä½•ä¸€ä¸ªå…³é”®å­—ï¼Œå®ƒä»¬éƒ½å¯ä»¥ç”¨æ¥æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ã€‚è¿™ä¸‰ä¸ªå…³é”®å­—åœ¨åŠŸèƒ½ä¸Šæ˜¯ç­‰ä»·çš„ã€‚</li>
<li><code>&#123;FROM | IN&#125;</code>ï¼šè¿™ä¸¤ä¸ªå…³é”®å­—åœ¨è¿™é‡Œçš„åŠŸèƒ½ä¹Ÿæ˜¯ç­‰ä»·çš„ï¼Œå®ƒä»¬ç”¨æ¥æŒ‡å®šæˆ‘ä»¬å°†ä»å“ªä¸ªè¡¨æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ã€‚</li>
<li><code>tbl_name</code>ï¼šè¿™æ˜¯ä½ æƒ³è¦æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯çš„è¡¨çš„åç§°ã€‚</li>
<li><code>[ &#123;FROM | IN&#125; db_name ]</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„éƒ¨åˆ†ï¼Œç”¨æ¥æŒ‡å®š <code>tbl_name</code> æ‰€åœ¨çš„æ•°æ®åº“ã€‚å¦‚æœä½ å·²ç»ä½¿ç”¨ <code>USE db_name;</code> é€‰æ‹©äº†æ•°æ®åº“ï¼Œé‚£ä¹ˆä½ å¯ä»¥çœç•¥è¿™éƒ¨åˆ†ã€‚</li>
<li><code>[WHERE expr]</code>ï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰çš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨æ¥è¿‡æ»¤ç»“æœã€‚ä½ å¯ä»¥æä¾›ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼æ¥é™åˆ¶è¿”å›çš„è¡Œã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>WHERE Key_name = &#39;PRIMARY&#39;</code> æ¥åªæ˜¾ç¤ºä¸»é”®çš„ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> my_table <span class="keyword">FROM</span> my_database <span class="keyword">WHERE</span> Key_name <span class="operator">=</span> <span class="string">&#x27;PRIMARY&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤å°†æ˜¾ç¤ºæ•°æ®åº“ <code>my_database`` ä¸­è¡¨ </code>my_table&#96;&#96; çš„ä¸»é”®ä¿¡æ¯ã€‚</p>
<h3 id="1-2-æé†’"><a href="#1-2-æé†’" class="headerlink" title="1.2 æé†’"></a>1.2 æé†’</h3><p><strong>An alternative to tbl_name FROM db_name syntax is db_name.tbl_name</strong>. ä¸‹é¢è¿™ä¸¤æ¡è¯­å¥æ˜¯ç­‰ä»·çš„ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> mytable <span class="keyword">FROM</span> mydb;</span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> mydb.mytable;</span><br></pre></td></tr></table></figure>

<h2 id="2-ç»“æœå­—æ®µ"><a href="#2-ç»“æœå­—æ®µ" class="headerlink" title="2 ç»“æœå­—æ®µ"></a>2 ç»“æœå­—æ®µ</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> extended index <span class="keyword">from</span> country <span class="keyword">in</span> mybatis <span class="keyword">where</span> Column_name <span class="operator">=</span> <span class="string">&#x27;id&#x27;</span> \G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">        <span class="keyword">Table</span>: country</span><br><span class="line">   Non_unique: <span class="number">0</span></span><br><span class="line">     Key_name: <span class="keyword">PRIMARY</span></span><br><span class="line"> Seq_in_index: <span class="number">1</span></span><br><span class="line">  Column_name: id</span><br><span class="line">    <span class="keyword">Collation</span>: A</span><br><span class="line">  <span class="keyword">Cardinality</span>: <span class="number">5</span></span><br><span class="line">     Sub_part: <span class="keyword">NULL</span></span><br><span class="line">       Packed: <span class="keyword">NULL</span></span><br><span class="line">         <span class="keyword">Null</span>:</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment:</span><br><span class="line">Index_comment:</span><br><span class="line">      Visible: YES</span><br><span class="line">   Expression: <span class="keyword">NULL</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢é’ˆå¯¹æŸ¥è¯¢ç»“æœä¸­æ¯ä¸ªå­—æ®µç»™å‡ºè¯¦ç»†çš„è§£é‡Šï¼š</p>
<ul>
<li><p><strong>Table</strong><br>è¡¨åã€‚</p>
</li>
<li><p><strong>Non_unique</strong><br>å¦‚æœç´¢å¼•ä¸èƒ½åŒ…å«é‡å¤é¡¹ï¼Œåˆ™ä¸º <code>0</code>ï¼›å¦‚æœå¯ä»¥ï¼Œåˆ™ä¸º <code>1</code>ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶æ‰€è¯´çš„å”¯ä¸€ç´¢å¼•</p>
</li>
<li><p><strong>Key_name</strong><br>ç´¢å¼•çš„åç§°ï¼Œå¦‚æœåå­—ç›¸åŒåˆ™è¡¨æ˜æ˜¯åŒä¸€ä¸ªç´¢å¼•ï¼Œè€Œå¹¶ä¸æ˜¯é‡å¤ï¼Œåå­—ç›¸åŒçš„æ˜¯è”åˆç´¢å¼•ã€‚å¦‚æœç´¢å¼•æ˜¯ä¸»é”®ç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•åç§°æ°¸è¿œéƒ½æ˜¯ <code>PRIMARY</code></p>
</li>
<li><p><strong>Seq_in_index</strong><br>ç´¢å¼•ä¸­çš„åˆ—åºå·ï¼Œå¯¹äºå¤šåˆ—ç´¢å¼•ï¼Œç¬¬ä¸€åˆ—ä¸º <code>1</code>ï¼Œç¬¬äºŒåˆ—ä¸º <code>2</code>ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
</li>
<li><p><strong>Column_name</strong><br>ç´¢å¼•çš„åˆ—åã€‚</p>
</li>
<li><p><strong>Collation</strong><br>åˆ—åœ¨ç´¢å¼•ä¸­çš„æ’åºæ–¹å¼ã€‚æœ‰ <code>Aï¼ˆå‡åºï¼‰</code>ï¼Œ<code>Dï¼ˆé™åºï¼‰</code>ï¼Œ<code>NULLï¼ˆæ— æ’åºï¼‰</code>ã€‚</p>
</li>
<li><p><strong>Cardinality</strong><br>ç´¢å¼•ä¸­å”¯ä¸€å€¼çš„æ•°ç›®çš„ä¼°è®¡å€¼ã€‚å¯¹äºéå”¯ä¸€ç´¢å¼•ï¼Œè¯¥å€¼æ˜¯ <code>NULL</code>ã€‚è¦æ›´æ–°è¿™ä¸ªæ•°å­—ï¼Œè¯·è¿è¡Œ <code> ANALYZE TABLE</code> æˆ–ï¼ˆå¯¹äº <code>MyISAM</code> è¡¨ï¼‰<code>myisamchk -a</code>ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“æŸä¸ªå­—æ®µçš„é‡å¤å€¼è¶Šå°‘è¶Šé€‚åˆå»ºç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯æ ¹æ® <code>Cardinality</code> æ¥åˆ¤æ–­ç´¢å¼•æ˜¯å¦å…·æœ‰é«˜é€‰æ‹©æ€§ï¼Œå¦‚æœè¿™ä¸ªå€¼éå¸¸å°ï¼Œé‚£å°±éœ€è¦é‡æ–°è¯„ä¼°è¿™ä¸ªå­—æ®µæ˜¯å¦é€‚åˆå»ºç«‹ç´¢å¼•ã€‚<code>Cardinality</code> è¶Šå¤§ï¼Œä½¿ç”¨æ­¤ç´¢å¼•çš„æœºä¼šå°±è¶Šå¤§ã€‚</p>
</li>
<li><p><strong>Sub_part</strong><br>å‰ç½®ç´¢å¼•çš„æ„æ€ï¼Œå¦‚æœåˆ—åªæ˜¯è¢«éƒ¨åˆ†åœ°ç¼–å…¥ç´¢å¼•ï¼Œåˆ™ä¸ºè¢«ç¼–å…¥ç´¢å¼•çš„å­—ç¬¦æ•°ã€‚å¯¹äºå®Œå…¨ç¼–å…¥ç´¢å¼•çš„åˆ—ï¼Œæ­¤å€¼ä¸º <code>NULL</code>ã€‚</p>
</li>
<li><p><strong>Packed</strong><br>MySQL ç”¨æ¥ä½¿ç´¢å¼•æ›´å°çš„æ•°æ®å‹ç¼©æ–¹å¼ã€‚æ­¤å€¼é€šå¸¸ä¸º <code>NULL</code>ã€‚å‹ç¼©ä¸€èˆ¬åŒ…æ‹¬å‹ç¼©ä¼ è¾“åè®®ã€å‹ç¼©åˆ—è§£å†³æ–¹æ¡ˆå’Œå‹ç¼©è¡¨è§£å†³æ–¹æ¡ˆã€‚</p>
</li>
<li><p><strong>Null</strong><br>å¦‚æœåˆ—å¯èƒ½åŒ…å« <code>NULL</code> å€¼ï¼Œåˆ™ä¸º <code>YES</code>ï¼›å¦åˆ™ï¼Œåˆ™ä¸º <code>NO</code>ã€‚</p>
</li>
<li><p><strong>Index_type</strong><br>ä½¿ç”¨çš„ç´¢å¼•æ–¹æ³•ï¼ˆä¾‹å¦‚ <code>BTREE, FULLTEXT, HASH, RTREE</code>ï¼‰ã€‚</p>
</li>
<li><p><strong>Comment</strong><br>ç´¢å¼•åˆ—ä¸­æœªè¯´æ˜çš„æœ‰å…³ç´¢å¼•çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œå¦‚æœç´¢å¼•å·²ç¦ç”¨ï¼Œåˆ™è¡¨ç¤ºå·²ç¦ç”¨ã€‚</p>
</li>
<li><p><strong>Index_comment</strong><br>è¿™ä¸ªå­—æ®µåŒ…å«äº†åœ¨åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®šçš„æ³¨é‡Šã€‚ä¾‹å¦‚ï¼Œåœ¨æ‰§è¡Œ <code>CREATE INDEX</code> æˆ– <code>ALTER TABLE</code> è¯­å¥æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>COMMENT</code> é€‰é¡¹æ¥æ·»åŠ æ³¨é‡Šã€‚ã€‚</p>
</li>
<li><p><strong>Visible</strong><br>è¿™ä¸ªå­—æ®µåœ¨ <code>MySQL 8.0.12</code> åŠä¹‹åçš„ç‰ˆæœ¬ä¸­è¢«å¼•å…¥ã€‚å®ƒè¡¨æ˜ç´¢å¼•æ˜¯å¦æ˜¯å¯è§çš„ã€‚å¦‚æœç´¢å¼•æ˜¯å¯è§çš„ï¼ˆ<code>Visible</code> çš„å€¼ä¸º <code>YES</code>ï¼‰ï¼Œé‚£ä¹ˆä¼˜åŒ–å™¨å¯ä»¥é€‰æ‹©ä½¿ç”¨è¿™ä¸ªç´¢å¼•æ¥æ‰§è¡ŒæŸ¥<br>è¯¢ã€‚å¦‚æœç´¢å¼•æ˜¯ä¸å¯è§çš„ï¼ˆ<code>Visible</code> çš„å€¼ä¸º <code>NO</code>ï¼‰ï¼Œé‚£ä¹ˆä¼˜åŒ–å™¨å°†ä¸ä¼šä½¿ç”¨è¿™ä¸ªç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚</p>
</li>
<li><p><strong>Expression</strong><br>å…³äºç´¢å¼•çš„ä¸€äº›æ³¨è§£ä¿¡æ¯ã€‚</p>
</li>
</ul>
<p>è¯·æ³¨æ„ï¼Œå¦‚æœä½ è¦æŸ¥çœ‹çš„è¡¨åœ¨ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“ä¸­ï¼Œä½ å¯èƒ½éœ€è¦å…ˆä½¿ç”¨ <code>USE database_name;</code> æ¥é€‰æ‹©é‚£ä¸ªæ•°æ®åº“ã€‚</p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>Mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€å•å¤‡ä»½æ–‡ä»¶å¹¶å‘é€åˆ°æŒ‡å®šé‚®ç®±</title>
    <url>/posts/13676/</url>
    <content><![CDATA[<h3 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1 èƒŒæ™¯"></a>1 èƒŒæ™¯</h3><p>ä¸€å“¥ä»¬å‘äº†ä¸ªè¯‰æ±‚ï¼Œæ€»è§‰å¾—è‡ªå·±çš„æœåŠ¡å™¨ä¸å®‰å…¨ï¼Œæƒ³æä¸ªå®šæ—¶å¤‡ä»½æ–‡ä»¶å¹¶å‘é€åˆ°è‡ªå·±çš„é‚®ç®±</p>
<span id="more"></span>

<h3 id="2-å®ç°ä»£ç å¦‚ä¸‹"><a href="#2-å®ç°ä»£ç å¦‚ä¸‹" class="headerlink" title="2 å®ç°ä»£ç å¦‚ä¸‹"></a>2 å®ç°ä»£ç å¦‚ä¸‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import, unicode_literals</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">from</span> email.mime.application <span class="keyword">import</span> MIMEApplication</span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"></span><br><span class="line">name = datetime.datetime.now().strftime(<span class="string">&quot;%Y%m%d%H%M%S&quot;</span>)</span><br><span class="line">base_path = <span class="string">&#x27;/root/xxxx/temp&#x27;</span></span><br><span class="line">zip_path = <span class="string">&#x27;/root/xxxx/backup/&#123;&#125;.tar.bz2&#x27;</span>.<span class="built_in">format</span>(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_logging</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    log_dir, log_file = <span class="string">&#x27;/root/xxxx/logs&#x27;</span>, <span class="string">&#x27;/root/xxxx/logs/backup.log&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(log_dir):</span><br><span class="line">        os.mkdir(log_dir)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(log_file):</span><br><span class="line">        <span class="built_in">open</span>(log_file, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    DEFAULT_LOGGING = &#123;</span><br><span class="line">        <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;formatters&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;formatone&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;[%(asctime)s] %(levelname)s : %(message)s&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;file&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;filename&#x27;</span>: <span class="string">&#x27;/root/xxxx/logs/backup.log&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;formatter&#x27;</span>: <span class="string">&#x27;formatone&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;logging.handlers.RotatingFileHandler&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;maxBytes&#x27;</span>: <span class="number">100</span> * <span class="number">1024</span> * <span class="number">1024</span>,</span><br><span class="line">                <span class="string">&#x27;backupCount&#x27;</span>: <span class="number">10</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;backup&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;file&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;INFO&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    logging.config.dictConfig(DEFAULT_LOGGING)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">zip_files</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;zip files&quot;&quot;&quot;</span></span><br><span class="line">    os.system(<span class="string">&#x27;tar -cjf &#123;&#125; -C &#123;&#125; data&#x27;</span>.<span class="built_in">format</span>(zip_path, base_path))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendmail</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;send mail&quot;&quot;&quot;</span></span><br><span class="line">    set_logging()</span><br><span class="line">    zip_files()</span><br><span class="line"></span><br><span class="line">    logger = logging.getLogger(<span class="string">&#x27;backup&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    mail_from, password = <span class="string">&#x27;xxxxxxx@aliyun.com&#x27;</span>, <span class="string">&#x27;xxxxxxx&#x27;</span></span><br><span class="line">    mail_to = <span class="string">&#x27;xxxxx@qq.com&#x27;</span></span><br><span class="line">    smtp_server = <span class="string">&#x27;smtp.aliyun.com&#x27;</span></span><br><span class="line"></span><br><span class="line">    msgRoot = MIMEMultipart(<span class="string">&#x27;related&#x27;</span>)</span><br><span class="line">    msgRoot[<span class="string">&#x27;Subject&#x27;</span>] = <span class="string">&#x27;send backup files &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(name)</span><br><span class="line">    msgRoot[<span class="string">&#x27;From&#x27;</span>] = <span class="string">&#x27;&#123;&#125;&lt;&#123;&#125;&gt;&#x27;</span>.<span class="built_in">format</span>(Header(<span class="string">&#x27;backup&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>), mail_from)</span><br><span class="line">    msgRoot[<span class="string">&#x27;To&#x27;</span>] = mail_to</span><br><span class="line"></span><br><span class="line">    msgText = MIMEText(<span class="string">&#x27;backup files&#x27;</span>, <span class="string">&#x27;plain&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    msgRoot.attach(msgText)</span><br><span class="line"></span><br><span class="line">    zip_con = MIMEApplication(<span class="built_in">open</span>(zip_path,<span class="string">&#x27;rb&#x27;</span>).read())</span><br><span class="line">    zip_con.add_header(<span class="string">&#x27;Content-Disposition&#x27;</span>, <span class="string">&#x27;attachment&#x27;</span>,</span><br><span class="line">                       filename=<span class="string">&#x27;&#123;&#125;.tar.bz2&#x27;</span>.<span class="built_in">format</span>(name))</span><br><span class="line">    msgRoot.attach(zip_con)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        server = smtplib.SMTP_SSL(smtp_server)</span><br><span class="line">        server.login(mail_from, password)</span><br><span class="line">        server.sendmail(mail_from, mail_to, msgRoot.as_string())</span><br><span class="line">        server.quit()</span><br><span class="line">        logger.info(<span class="string">&#x27;send &#123;&#125; backup files success&#x27;</span>.<span class="built_in">format</span>(name))</span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">        logger.error(<span class="string">&#x27;send &#123;&#125; failed &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(name, e))</span><br><span class="line">        sendmail()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sendmail()</span><br></pre></td></tr></table></figure>

<h3 id="3-ç®€å•è¯´æ˜"><a href="#3-ç®€å•è¯´æ˜" class="headerlink" title="3 ç®€å•è¯´æ˜"></a>3 ç®€å•è¯´æ˜</h3><h4 id="3-1-æ‰“åŒ…æ–‡ä»¶"><a href="#3-1-æ‰“åŒ…æ–‡ä»¶" class="headerlink" title="3.1 æ‰“åŒ…æ–‡ä»¶"></a>3.1 æ‰“åŒ…æ–‡ä»¶</h4><p>è¿™ä¸ªå®ç°æ¯”è¾ƒåˆçº§ï¼Œç›´æ¥ç”¨ <code>shell</code> å‘½ä»¤è¿›è¡Œæ‰“åŒ…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">zip_files</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;zip files&quot;&quot;&quot;</span></span><br><span class="line">    os.system(<span class="string">&#x27;tar -cjf &#123;&#125; -C &#123;&#125; data&#x27;</span>.<span class="built_in">format</span>(zip_path, base_path))</span><br></pre></td></tr></table></figure>

<h4 id="3-2-å‘é€é‚®ä»¶"><a href="#3-2-å‘é€é‚®ä»¶" class="headerlink" title="3.2 å‘é€é‚®ä»¶"></a>3.2 å‘é€é‚®ä»¶</h4><p>è¿™ä¸ªå°±ä¸è¯´äº†ï¼Œç°æˆçš„æ¨¡å—ç›´æ¥æ‹¿æ¥ç”¨</p>
<h4 id="3-3-æ—¥å¿—è®°å½•"><a href="#3-3-æ—¥å¿—è®°å½•" class="headerlink" title="3.3 æ—¥å¿—è®°å½•"></a>3.3 æ—¥å¿—è®°å½•</h4><p>åŠ ä¸Šæ—¥å¿—ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šçš„è®©æˆ‘çŸ¥é“å‘é€æƒ…å†µå¦‚ä¸‹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="number">2017</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">03</span>,<span class="number">251</span>] <span class="variable constant_">INFO</span> : send <span class="number">20170414000001</span> backup files success</span><br><span class="line">[<span class="number">2017</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">03</span>:<span class="number">00</span>:<span class="number">02</span>,<span class="number">620</span>] <span class="variable constant_">INFO</span> : send <span class="number">20170414030001</span> backup files success</span><br><span class="line">[<span class="number">2017</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">06</span>:<span class="number">00</span>:<span class="number">02</span>,<span class="number">406</span>] <span class="variable constant_">INFO</span> : send <span class="number">20170414060001</span> backup files success</span><br><span class="line">[<span class="number">2017</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">09</span>:<span class="number">00</span>:<span class="number">02</span>,<span class="number">349</span>] <span class="variable constant_">INFO</span> : send <span class="number">20170414090001</span> backup files success</span><br><span class="line">[<span class="number">2017</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">12</span>:<span class="number">00</span>:<span class="number">02</span>,<span class="number">299</span>] <span class="variable constant_">INFO</span> : send <span class="number">20170414120001</span> backup files success</span><br><span class="line">[<span class="number">2017</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">01</span>:<span class="number">04</span>,<span class="number">696</span>] <span class="variable constant_">ERROR</span> : send <span class="number">20170414150001</span> failed [<span class="title class_">Errno</span> <span class="number">110</span>] <span class="title class_">Connection</span> timed out</span><br><span class="line">[<span class="number">2017</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">01</span>:<span class="number">05</span>,<span class="number">401</span>] <span class="variable constant_">INFO</span> : send <span class="number">20170414150001</span> backup files success</span><br></pre></td></tr></table></figure>

<h4 id="3-4-å®šæ—¶å¤„ç†"><a href="#3-4-å®šæ—¶å¤„ç†" class="headerlink" title="3.4 å®šæ—¶å¤„ç†"></a>3.4 å®šæ—¶å¤„ç†</h4><p>å®šæ—¶è¿™ä¸ªå¤„ç†ï¼Œç›´æ¥ä½¿ç”¨ <code>crontab</code> å‘½ä»¤ï¼Œåˆ›å»ºä¸ª <code>backup_cron</code> æ–‡ä»¶ï¼Œå†™å…¥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0 */3 * * *  python /root/xxxxx/backup.py</span><br></pre></td></tr></table></figure>

<h3 id="4-ç®€å•å°ç»“"><a href="#4-ç®€å•å°ç»“" class="headerlink" title="4 ç®€å•å°ç»“"></a>4 ç®€å•å°ç»“</h3><p>ä¸šåŠ¡æ¯”è¾ƒç®€å•ï¼Œå®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæ²¡å•¥å¯è¯´çš„</p>
]]></content>
      <categories>
        <category>åç«¯</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>Django | é€šç”¨çš„å¼€å‘åŒ…</title>
    <url>/posts/51719/</url>
    <content><![CDATA[<p>æ›´æ–°æ—¶é—´ï¼š2019-12-20 22:05:03</p>
<p>åŸºäº <code>Django</code> é¡¹ç›®ï¼Œé€šç”¨çš„ç¬¬ä¸‰æ–¹å¼€å‘å·¥å…·åŒ…ï¼Œè¿™é‡Œåªåˆ—å‡ºäº†é€šç”¨çš„å¼€å‘åŒ…ï¼Œä¹ŸåŒ…å«äº†éƒ¨åˆ†ä¸šåŠ¡åŒ…ï¼Œå…¶ä»–å¸¸è§çš„æ¶‰åŠåˆ°å…·ä½“çš„ä¸šåŠ¡åŒ…ï¼Œä¸å†ä¸€ä¸€åˆ—å‡ºã€‚</p>
<h4 id="1-DjangoRestFramework"><a href="#1-DjangoRestFramework" class="headerlink" title="1 DjangoRestFramework"></a>1 DjangoRestFramework</h4><p><a href="https://www.django-rest-framework.org/">https://www.django-rest-framework.org/</a></p>
<p>å¼€å‘ <code>Restful</code> æ¥å£çš„ä¸»åŠ›å·¥å…·</p>
<h4 id="2-django-cors-headers"><a href="#2-django-cors-headers" class="headerlink" title="2 django-cors-headers"></a>2 django-cors-headers</h4><p><a href="https://github.com/adamchainz/django-cors-headers">https://github.com/adamchainz/django-cors-headers</a></p>
<p>è§£å†³å‰åç«¯åˆ†ç¦»æ¥å£è¯·æ±‚è·¨åŸŸ</p>
<h4 id="3-django-extensions"><a href="#3-django-extensions" class="headerlink" title="3 django-extensions"></a>3 django-extensions</h4><p><a href="https://github.com/django-extensions/django-extensions">https://github.com/django-extensions/django-extensions</a></p>
<p><code>Django</code> æ‰©å±•å¢å¼ºå·¥å…·</p>
<h4 id="4-ipython"><a href="#4-ipython" class="headerlink" title="4 ipython"></a>4 ipython</h4><p><a href="https://ipython.org/">https://ipython.org/</a></p>
<p>å¼ºå¤§çš„äº¤äº’å¼ <code>shell</code>ï¼Œæµ‹è¯•è°ƒè¯•éå¸¸é¡ºæ‰‹ï¼Œå½“ç„¶ä¸ä»…ä»…é™äº <code>Django</code> å¼€å‘</p>
<h4 id="5-django-environ"><a href="#5-django-environ" class="headerlink" title="5 django-environ"></a>5 django-environ</h4><p><a href="https://github.com/joke2k/django-environ">https://github.com/joke2k/django-environ</a></p>
<p>åŒºåˆ†å„ç§ç¯å¢ƒçš„é…ç½®åˆ©å™¨</p>
<h4 id="6-celery"><a href="#6-celery" class="headerlink" title="6 celery"></a>6 celery</h4><p><a href="https://github.com/celery/celery">https://github.com/celery/celery</a></p>
<p>åˆ†å¸ƒå¼çš„ä»»åŠ¡é˜Ÿåˆ—åˆ†å‘å™¨</p>
<h4 id="7-wechatpy"><a href="#7-wechatpy" class="headerlink" title="7 wechatpy"></a>7 wechatpy</h4><p><a href="https://github.com/wechatpy/wechatpy">https://github.com/wechatpy/wechatpy</a></p>
<p>å¾®ä¿¡å¼€å‘å¿…å¤‡çš„ SDK</p>
<h4 id="8-gunicorn"><a href="#8-gunicorn" class="headerlink" title="8 gunicorn"></a>8 gunicorn</h4><p><a href="https://gunicorn.org/">https://gunicorn.org/</a></p>
<p><code>Python WSGI HTTP Server</code></p>
<h4 id="9-factory-boy"><a href="#9-factory-boy" class="headerlink" title="9 factory-boy"></a>9 factory-boy</h4><p><a href="https://github.com/FactoryBoy/factory_boy">https://github.com/FactoryBoy/factory_boy</a></p>
<p>æµ‹è¯•æ•°æ®ç”Ÿæˆå·¥å…·</p>
<h4 id="10-parameterized"><a href="#10-parameterized" class="headerlink" title="10 parameterized"></a>10 parameterized</h4><p><a href="https://github.com/wolever/parameterized">https://github.com/wolever/parameterized</a></p>
<p>ä¸ºæµ‹è¯•ç”¨ä¾‹æä¾›å‚æ•°åŒ–çš„ï¼Œé‡å¤æ€§æ”¯æŒ</p>
<h4 id="11-pytest"><a href="#11-pytest" class="headerlink" title="11 pytest"></a>11 pytest</h4><p><a href="https://docs.pytest.org/en/latest/">https://docs.pytest.org/en/latest/</a></p>
<p>å¼ºå¤§çš„ç¬¬ä¸‰æ–¹æµ‹è¯•æ¡†æ¶ï¼Œä¸°å¯Œçš„æ’ä»¶é›†ï¼Œæ´»è·ƒçš„ç¤¾åŒº</p>
<p>å½“ç„¶è¿˜æœ‰ <code>nose</code> å’Œ å®ƒçš„ç»§ä»»è€… <code>nose2</code>ï¼Œä¸è¿‡ç›¸æ¯”è¾ƒè€Œè¨€ï¼Œè¿˜æ˜¯æ›´åŠ é’çäº <code>pytest</code></p>
<p><code>nose</code>ï¼š<a href="https://nose.readthedocs.io/en/latest/">https://nose.readthedocs.io/en/latest/</a><br><code>nose2</code>ï¼š<a href="https://github.com/nose-devs/nose2">https://github.com/nose-devs/nose2</a></p>
<p>ä¸è¿‡ <code>nose</code> å·²ç»ä¸å†æ›´æ–°ï¼Œè¿›å…¥äº†ç»´æŠ¤é˜¶æ®µï¼Œå¦‚æœä½¿ç”¨å»ºè®®ä½¿ç”¨ <code>nose2</code></p>
<h4 id="12-raven"><a href="#12-raven" class="headerlink" title="12 raven"></a>12 raven</h4><p><a href="https://raven.readthedocs.io/en/feature-federated-docs/">https://raven.readthedocs.io/en/feature-federated-docs/</a></p>
<p>è¿™ä¸ªä¸€èˆ¬éƒ½æ˜¯ç»“åˆ <code>Sentry</code> ä½¿ç”¨</p>
<h4 id="13-mysqlclient"><a href="#13-mysqlclient" class="headerlink" title="13 mysqlclient"></a>13 mysqlclient</h4><p><a href="https://github.com/PyMySQL/mysqlclient-python">https://github.com/PyMySQL/mysqlclient-python</a></p>
<p>å› ä¸ºæˆ‘ä½¿ç”¨ <code>Mysql</code> è¾ƒå¤š</p>
<h4 id="14-django-silk"><a href="#14-django-silk" class="headerlink" title="14 django-silk"></a>14 django-silk</h4><p><a href="https://github.com/jazzband/django-silk">https://github.com/jazzband/django-silk</a></p>
<p>ç®€å•çš„æ€§èƒ½ç›‘æ§å·¥å…·</p>
<h4 id="15-django-debug-toolbar"><a href="#15-django-debug-toolbar" class="headerlink" title="15 django-debug-toolbar"></a>15 django-debug-toolbar</h4><p><a href="https://github.com/jazzband/django-debug-toolbar">https://github.com/jazzband/django-debug-toolbar</a></p>
<p><code>debug</code> å·¥å…·</p>
<h4 id="16-django-reversion"><a href="#16-django-reversion" class="headerlink" title="16 django-reversion"></a>16 django-reversion</h4><p><a href="https://github.com/etianen/django-reversion">https://github.com/etianen/django-reversion</a></p>
<p>æ¨¡å‹ç‰ˆæœ¬æ§åˆ¶</p>
<h4 id="17-whitenoise"><a href="#17-whitenoise" class="headerlink" title="17 whitenoise"></a>17 whitenoise</h4><p><a href="https://github.com/evansd/whitenoise">https://github.com/evansd/whitenoise</a></p>
<p>é™æ€èµ„æºç®¡ç†ï¼Œé€šå¸¸æ˜¯ç”¨æ¥ç®¡ç† <code>django admin</code> å’Œå…¶ä»–ç¬¬ä¸‰æ–¹åŒ…çš„é™æ€èµ„æºã€‚</p>
<h4 id="18-django-sql-explorer"><a href="#18-django-sql-explorer" class="headerlink" title="18 django-sql-explorer"></a>18 django-sql-explorer</h4><p><a href="https://github.com/groveco/django-sql-explorer">https://github.com/groveco/django-sql-explorer</a></p>
<p><code>SQL</code> è¿è¡ŒæŸ¥è¯¢è¾…åŠ©å·¥å…·</p>
<h4 id="19-django-import-export"><a href="#19-django-import-export" class="headerlink" title="19 django-import-export"></a>19 django-import-export</h4><p><a href="https://github.com/django-import-export/django-import-export">https://github.com/django-import-export/django-import-export</a></p>
<p>æ•°æ®å¯¼å…¥å¯¼å‡º</p>
<h4 id="20-django-compressor"><a href="#20-django-compressor" class="headerlink" title="20 django-compressor"></a>20 django-compressor</h4><p><a href="https://django-compressor.readthedocs.io/en/stable/">https://django-compressor.readthedocs.io/en/stable/</a></p>
<p>åˆå¹¶é™æ€èµ„æºï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚ï¼Œä¸€èˆ¬ä½¿ç”¨åœ¨ <code>django admin</code> ä¸­ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django | ä¿¡å·ä½¿ç”¨æ€è€ƒ</title>
    <url>/posts/51727/</url>
    <content><![CDATA[<p>é‡æ‹¾äº›è®¸å…³äºä¿¡å·æ¨¡å—ä½¿ç”¨çš„è®°å¿†ï¼Œè®°å½•å¯¹äº <code>Django</code> ä¿¡å·ä½¿ç”¨çš„æ€è€ƒã€‚ <span id="more"></span></p>
<blockquote>
<p>æœ¬æ–‡ä½¿ç”¨çš„ Django çš„ç‰ˆæœ¬æ˜¯ 4.2</p>
</blockquote>
<h1 id="1-æºç æ³¨é‡Š"><a href="#1-æºç æ³¨é‡Š" class="headerlink" title="1 æºç æ³¨é‡Š"></a>1 æºç æ³¨é‡Š</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> weakref</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.utils.inspect <span class="keyword">import</span> func_accepts_kwargs</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&quot;django.dispatch&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_make_id</span>(<span class="params">target</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å¯¹ä¼ é€’è¿›æ¥çš„å‡½æ•°ç”Ÿæˆå¯¹åº”çš„æ ‡è¯†ï¼Œè¿™é‡Œä½¿ç”¨äº† id å‡½æ•°</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœå¯¹è±¡å…·æœ‰ __func__ å±æ€§ï¼Œåˆ™æ„å‘³ç€å‡½æ•°æ˜¯ç±»ä¸­çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(target, <span class="string">&quot;__func__&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">id</span>(target.__self__), <span class="built_in">id</span>(target.__func__))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">id</span>(target)</span><br><span class="line"></span><br><span class="line"><span class="comment"># None å¯¹åº”çš„æ ‡è¯†ï¼Œæ„å‘³ç€æ— æ„ä¹‰çš„é”®</span></span><br><span class="line">NONE_ID = _make_id(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># A marker for caching</span></span><br><span class="line">NO_RECEIVERS = <span class="built_in">object</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Signal</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Base class for all signals</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Internal attributes:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        receivers</span></span><br><span class="line"><span class="string">            &#123; receiverkey (id) : weakref(receiver) &#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, use_caching=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        åˆ›å»ºä¸€ä¸ªæ–°çš„ä¿¡å·å¯¹è±¡</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Create a new signal.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># æ¥æ”¶å™¨åˆ—è¡¨ï¼Œå¥½æ¯”è®¢é˜…è€…åˆ—è¡¨</span></span><br><span class="line">        <span class="variable language_">self</span>.receivers = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Django çš„ Signal ç³»ç»Ÿéœ€è¦å¤„ç†å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å¹¶å‘é—®é¢˜ã€‚åœ¨å¤šçº¿ç¨‹åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šæœ‰</span></span><br><span class="line">        <span class="comment"># å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ Signal å¯¹è±¡ï¼Œä¾‹å¦‚è¿æ¥æˆ–æ–­å¼€æ¥æ”¶å™¨ã€å‘é€ä¿¡å·ç­‰ã€‚ä¸ºäº†ç¡®ä¿ Signal</span></span><br><span class="line">        <span class="comment"># å¯¹è±¡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„ä¸€è‡´æ€§å’Œçº¿ç¨‹å®‰å…¨ï¼ŒDjango ä½¿ç”¨ threading.Lock å¯¹å…³é”®</span></span><br><span class="line">        <span class="comment"># éƒ¨åˆ†çš„ä»£ç è¿›è¡ŒåŠ é”ã€‚</span></span><br><span class="line">        <span class="variable language_">self</span>.lock = threading.Lock()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ˜¯å¦ä½¿ç”¨ç¼“å­˜</span></span><br><span class="line">        <span class="variable language_">self</span>.use_caching = use_caching</span><br><span class="line"></span><br><span class="line">        <span class="comment"># For convenience we create empty caches even if they are not used.</span></span><br><span class="line">        <span class="comment"># A note about caching: if use_caching is defined, then for each</span></span><br><span class="line">        <span class="comment"># distinct sender we cache the receivers that sender has in</span></span><br><span class="line">        <span class="comment"># &#x27;sender_receivers_cache&#x27;. The cache is cleaned when .connect() or</span></span><br><span class="line">        <span class="comment"># .disconnect() is called and populated on send().</span></span><br><span class="line">        <span class="comment"># ç¼“å­˜å‘é€è€…å¯¹è±¡å’Œå¯¹åº”çš„æ¥æ”¶å™¨</span></span><br><span class="line">        <span class="variable language_">self</span>.sender_receivers_cache = weakref.WeakKeyDictionary() <span class="keyword">if</span> use_caching <span class="keyword">else</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ ‡è¯†æ˜¯å¦å­˜åœ¨å·²ç»å¤±æ•ˆçš„æ¥æ”¶å™¨</span></span><br><span class="line">        <span class="variable language_">self</span>._dead_receivers = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">connect</span>(<span class="params">self, receiver, sender=<span class="literal">None</span>, weak=<span class="literal">True</span>, dispatch_uid=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ç”¨äºå°†ä¿¡å·æ¥æ”¶å™¨ï¼ˆreceiverï¼‰æ³¨å†Œåˆ°ä¿¡å·å¯¹è±¡ï¼ˆsignalï¼‰ã€‚æ¥æ”¶å™¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“ä¿¡å·</span></span><br><span class="line"><span class="string">        è¢«å‘é€æ—¶ï¼Œå¯¹åº”å‘é€è€…æ‰€æœ‰å¯¹åº”çš„æ¥æ”¶å™¨å°†è¢«è§¦å‘</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Connect receiver to sender for signal.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Arguments:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            receiver æ¥æ”¶å™¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                æ¥æ”¶å™¨æ˜¯ä¸€ä¸ªç”¨æ¥æ¥æ”¶ä¿¡å·çš„å‡½æ•°æˆ–è€…å¯¹è±¡çš„æ–¹æ³•ï¼Œæ¥æ”¶å™¨å¿…é¡»å¯ hashã€‚</span></span><br><span class="line"><span class="string">                A function or an instance method which is to receive signals.</span></span><br><span class="line"><span class="string">                Receivers must be hashable objects.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                å½“ weak ä¸º True æ—¶ï¼Œæ¥æ”¶å™¨ä¸€å®šå¯ä»¥è¢«å¼±å¼•ç”¨ã€‚</span></span><br><span class="line"><span class="string">                If weak is True, then receiver must be weak referenceable.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                æ¥æ”¶å™¨å¿…é¡»å¯ä»¥æ¥å—å…³é”®å­—å‚æ•°</span></span><br><span class="line"><span class="string">                Receivers must be able to accept keyword arguments.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                å¦‚æœä¸€ä¸ªæ¥æ”¶å™¨ï¼ˆA) è¿æ¥æ—¶ï¼Œä½¿ç”¨äº† dispatch_uid å‚æ•°ï¼Œé‚£ä¹ˆå¦‚æœå…¶ä»–æ¥æ”¶å™¨ï¼ˆBï¼‰è¿æ¥æ—¶ï¼Œ</span></span><br><span class="line"><span class="string">                ä½¿ç”¨äº†åŒæ ·çš„ dispatch_uidï¼Œé‚£ä¹ˆæ¥æ”¶å™¨ï¼ˆAï¼‰å°†ä¸ä¼šè¢«æ·»åŠ ï¼Œå³ dispatch_uid ä¸èƒ½é‡å¤ã€‚</span></span><br><span class="line"><span class="string">                If a receiver is connected with a dispatch_uid argument, it</span></span><br><span class="line"><span class="string">                will not be added if another receiver was already connected</span></span><br><span class="line"><span class="string">                with that dispatch_uid.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            sender å‘é€è€…</span></span><br><span class="line"><span class="string">                ä¸€ä¸ªç”¨äºè§¦å‘æ¥æ”¶å™¨å“åº”çš„å¯¹è±¡ã€‚å¦‚æœä¸º sender è®¾ç½®ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œé‚£ä¹ˆåªæœ‰æ¥è‡ªè¯¥</span></span><br><span class="line"><span class="string">                å¯¹è±¡å‘é€çš„ä¿¡å·æ‰ä¼šè§¦å‘æ¥æ”¶å™¨ã€‚å¦‚æœçœç•¥ sender å‚æ•°ï¼Œé‚£ä¹ˆè¯¥æ¥æ”¶å™¨å°†å“åº”æ‰€æœ‰å‘é€è€…çš„ä¿¡å·ã€‚</span></span><br><span class="line"><span class="string">                åœ¨ django çš„è°ƒç”¨ä¸­ï¼Œå¤šå¤„åŸºæœ¬ä¸Šéƒ½æ˜¯ç±»ã€‚ä¾‹å¦‚ request_started ä¿¡å·å¯¹åº”çš„å‘é€è€…æ˜¯</span></span><br><span class="line"><span class="string">                class &#x27;django.core.handlers.wsgi.WSGIHandler&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                The sender to which the receiver should respond. Must either be</span></span><br><span class="line"><span class="string">                a Python object, or None to receive events from any sender.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            weak å¼±å¼•ç”¨</span></span><br><span class="line"><span class="string">                æ˜¯å¦ä½¿ç”¨å¯¹æ¥æ”¶å™¨çš„å¼±å¼•ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å—å°†å°è¯•ä½¿ç”¨å¼±å¼•ç”¨æ¥å¼•ç”¨æ¥æ”¶å™¨ã€‚</span></span><br><span class="line"><span class="string">                å¦‚æœè¿™ä¸ªå‚æ•°ä¸º falseï¼Œé‚£ä¹ˆå°†ä½¿ç”¨å¼ºå¼•ç”¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                Whether to use weak references to the receiver. By default, the</span></span><br><span class="line"><span class="string">                module will attempt to use weak references to the receiver</span></span><br><span class="line"><span class="string">                objects. If this parameter is false, then strong references will</span></span><br><span class="line"><span class="string">                be used.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            dispatch_uid</span></span><br><span class="line"><span class="string">                åœ¨å¯èƒ½å‘é€é‡å¤ä¿¡å·çš„æƒ…å†µä¸‹ï¼Œä¿¡å·æ¥æ”¶å™¨çš„å”¯ä¸€æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                ä¸€ä¸ªç”¨äºå”¯ä¸€åœ°æ ‡è¯†ä¸€ä¸ªç‰¹å®šæ¥æ”¶å™¨å¯¹è±¡çš„æ ‡è¯†ç¬¦ï¼Œå®ƒé€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè™½ç„¶å®ƒå¯ä»¥æ˜¯</span></span><br><span class="line"><span class="string">                ä»»ä½•å¯å“ˆå¸Œçš„ä¸œè¥¿ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                An identifier used to uniquely identify a particular instance of</span></span><br><span class="line"><span class="string">                a receiver. This will usually be a string, though it may be</span></span><br><span class="line"><span class="string">                anything hashable.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If DEBUG is on, check that we got a good receiver</span></span><br><span class="line">        <span class="comment"># å¦‚æœå¼€å¯ DEBUG æ¨¡å¼ï¼Œæ£€æµ‹æ¥æ”¶å™¨æ˜¯å¦ç¬¦åˆè¦æ±‚</span></span><br><span class="line">        <span class="keyword">if</span> settings.configured <span class="keyword">and</span> settings.DEBUG:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">callable</span>(receiver):</span><br><span class="line">                <span class="keyword">raise</span> TypeError(<span class="string">&quot;Signal receivers must be callable.&quot;</span>)</span><br><span class="line">            <span class="comment"># Check for **kwargs</span></span><br><span class="line">            <span class="comment"># æ£€æŸ¥æ¥æ”¶å™¨æ¥æ”¶çš„æ˜¯å¦éƒ½æ˜¯å…³é”®å­—å‚æ•°</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> func_accepts_kwargs(receiver):</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">&quot;Signal receivers must accept keyword arguments (**kwargs).&quot;</span></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœæŒ‡å®šäº† dispatch_uidï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ dispatch_uidï¼Œæ‰€ä»¥é’ˆå¯¹åŒä¸€ä¸ªä¿¡å·ï¼ŒåŒæ ·çš„å‘é€è€…</span></span><br><span class="line">        <span class="comment"># dispatch_uid æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œå¦åˆ™åç»­éªŒè¯ lookup_key å·²ç»å­˜åœ¨çš„è¯ï¼Œæ¥æ”¶å™¨åˆ™ä¸ä¼šåŠ å…¥</span></span><br><span class="line">        <span class="comment"># åˆ°æ¥æ”¶å™¨åˆ—è¡¨ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> dispatch_uid:</span><br><span class="line">            lookup_key = (dispatch_uid, _make_id(sender))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            lookup_key = (_make_id(receiver), _make_id(sender))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é»˜è®¤ä½¿ç”¨å¼±å¼•ç”¨ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¼±å¼•ç”¨çš„å¦™ç”¨ä¹‹å¤„ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> weak:</span><br><span class="line">            ref = weakref.ref</span><br><span class="line">            receiver_object = receiver</span><br><span class="line">            <span class="comment"># Check for bound methods</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(receiver, <span class="string">&quot;__self__&quot;</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(receiver, <span class="string">&quot;__func__&quot;</span>):</span><br><span class="line">                ref = weakref.WeakMethod</span><br><span class="line">                receiver_object = receiver.__self__</span><br><span class="line">            receiver = ref(receiver)</span><br><span class="line">            weakref.finalize(receiver_object, <span class="variable language_">self</span>._remove_receiver)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">            <span class="comment"># æ¸…é™¤æ— æ•ˆçš„æ¥æ”¶å™¨</span></span><br><span class="line">            <span class="variable language_">self</span>._clear_dead_receivers()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(r_key == lookup_key <span class="keyword">for</span> r_key, _ <span class="keyword">in</span> <span class="variable language_">self</span>.receivers):</span><br><span class="line">                <span class="comment"># å¦‚æœæ¥æ”¶å™¨å¯¹åº”çš„é”®ä¸åœ¨ä¿¡å·å¯¹è±¡çš„æ¥æ”¶å™¨åˆ—è¡¨ä¸­ï¼Œåˆ™åŠ å…¥åˆ°æ¥æ”¶å™¨åˆ—è¡¨ä¸­</span></span><br><span class="line">                <span class="variable language_">self</span>.receivers.append((lookup_key, receiver))</span><br><span class="line">            <span class="comment"># æ¸…é™¤ sender_receivers_cache ç¼“å­˜</span></span><br><span class="line">            <span class="variable language_">self</span>.sender_receivers_cache.clear()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disconnect</span>(<span class="params">self, receiver=<span class="literal">None</span>, sender=<span class="literal">None</span>, dispatch_uid=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ä¸ºæŒ‡å®šçš„å‘é€è€…å¯¹è±¡ç§»é™¤å¯¹åº”çš„æ¥æ”¶å™¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Disconnect receiver from sender for signal.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        å¦‚æœä½¿ç”¨äº†å¼±å¼•ç”¨ï¼Œdisconnect å‡½æ•°ä¸éœ€è¦è°ƒç”¨ã€‚å› ä¸ºå¼±å¼•ç”¨çš„æ¥æ”¶å™¨ä¼šè‡ªåŠ¨ç§»é™¤ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        If weak references are used, disconnect need not be called. The receiver</span></span><br><span class="line"><span class="string">        will be removed from dispatch automatically.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Arguments:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            receiver</span></span><br><span class="line"><span class="string">                The registered receiver to disconnect. May be none if</span></span><br><span class="line"><span class="string">                dispatch_uid is specified.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            sender</span></span><br><span class="line"><span class="string">                The registered sender to disconnect</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            dispatch_uid</span></span><br><span class="line"><span class="string">                the unique identifier of the receiver to disconnect</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># è®¡ç®—ç´¢å¼•é”®</span></span><br><span class="line">        <span class="keyword">if</span> dispatch_uid:</span><br><span class="line">            lookup_key = (dispatch_uid, _make_id(sender))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            lookup_key = (_make_id(receiver), _make_id(sender))</span><br><span class="line"></span><br><span class="line">        disconnected = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">            <span class="variable language_">self</span>._clear_dead_receivers()</span><br><span class="line">            <span class="comment"># é€šè¿‡å¯¹æ¯”ç´¢å¼•é”®ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿›è¡Œåˆ é™¤</span></span><br><span class="line">            <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.receivers)):</span><br><span class="line">                (r_key, _) = <span class="variable language_">self</span>.receivers[index]</span><br><span class="line">                <span class="keyword">if</span> r_key == lookup_key:</span><br><span class="line">                    disconnected = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">del</span> <span class="variable language_">self</span>.receivers[index]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># åˆ é™¤å®Œåéœ€è¦é‡ç½® sender_receivers_cache ç¼“å­˜</span></span><br><span class="line">            <span class="variable language_">self</span>.sender_receivers_cache.clear()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿”å›æ˜¯å¦æ–­å¼€çš„æ ‡è¯†ï¼Œæ•°æ®ç±»å‹ä¸ºå¸ƒå°”å‹</span></span><br><span class="line">        <span class="keyword">return</span> disconnected</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_listeners</span>(<span class="params">self, sender=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ˜¯å¦å­˜åœ¨æŒ‡å®šå‘é€è€…æœ‰æ•ˆçš„æ¥æ”¶å™¨&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bool</span>(<span class="variable language_">self</span>._live_receivers(sender))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, sender, **named</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å‘é€ä¿¡å·åˆ°æŒ‡å®šå‘é€è€…çš„æ¥æ”¶å™¨ä¸­</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Send signal from sender to all connected receivers.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        If any receiver raises an error, the error propagates back through send,</span></span><br><span class="line"><span class="string">        terminating the dispatch loop. So it&#x27;s possible that all receivers</span></span><br><span class="line"><span class="string">        won&#x27;t be called if an error is raised.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Arguments:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            sender</span></span><br><span class="line"><span class="string">                The sender of the signal. Either a specific object or None.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            named</span></span><br><span class="line"><span class="string">                Named arguments which will be passed to receivers.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Return a list of tuple pairs [(receiver, response), ... ].</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.receivers <span class="keyword">or</span> <span class="variable language_">self</span>.sender_receivers_cache.get(sender) <span class="keyword">is</span> NO_RECEIVERS:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [(receiver, receiver(signal=<span class="variable language_">self</span>, sender=sender, **named)) <span class="keyword">for</span> receiver <span class="keyword">in</span> <span class="variable language_">self</span>._live_receivers(sender)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_robust</span>(<span class="params">self, sender, **named</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Send signal from sender to all connected receivers catching errors.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Arguments:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            sender</span></span><br><span class="line"><span class="string">                The sender of the signal. Can be any Python object (normally one</span></span><br><span class="line"><span class="string">                registered with a connect if you actually want something to</span></span><br><span class="line"><span class="string">                occur).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            named</span></span><br><span class="line"><span class="string">                Named arguments which will be passed to receivers.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Return a list of tuple pairs [(receiver, response), ... ].</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        If any receiver raises an error (specifically any subclass of</span></span><br><span class="line"><span class="string">        Exception), return the error instance as the result for that receiver.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.receivers <span class="keyword">or</span> <span class="variable language_">self</span>.sender_receivers_cache.get(sender) <span class="keyword">is</span> NO_RECEIVERS:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Call each receiver with whatever arguments it can accept.</span></span><br><span class="line">        <span class="comment"># Return a list of tuple pairs [(receiver, response), ... ].</span></span><br><span class="line">        responses = []</span><br><span class="line">        <span class="keyword">for</span> receiver <span class="keyword">in</span> <span class="variable language_">self</span>._live_receivers(sender):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = receiver(signal=<span class="variable language_">self</span>, sender=sender, **named)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">                logger.error(</span><br><span class="line">                    <span class="string">&quot;Error calling %s in Signal.send_robust() (%s)&quot;</span>,</span><br><span class="line">                    receiver.__qualname__,</span><br><span class="line">                    err,</span><br><span class="line">                    exc_info=err,</span><br><span class="line">                )</span><br><span class="line">                responses.append((receiver, err))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                responses.append((receiver, response))</span><br><span class="line">        <span class="keyword">return</span> responses</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_clear_dead_receivers</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ¸…é™¤æ— æ•ˆçš„æ¥æ”¶å™¨&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># Note: caller is assumed to hold self.lock.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._dead_receivers:</span><br><span class="line">            <span class="variable language_">self</span>._dead_receivers = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># è¿­ä»£å¤„ç†ï¼Œè·å–æœ‰æ•ˆçš„æ¥æ”¶å™¨</span></span><br><span class="line">            <span class="comment"># - å¦‚æœæ˜¯å¼ºå¼•ç”¨ï¼Œè¿™ç›´æ¥ç•¥è¿‡</span></span><br><span class="line">            <span class="comment"># - å¦‚æœæ˜¯å¼±å¼•ç”¨ï¼Œå¼±å¼•ç”¨å¯¹è±¡æ‰§è¡Œä¸º Noneï¼Œåˆ™ä»£è¡¨æ˜¯æ— æ•ˆçš„æ¥æ”¶å™¨</span></span><br><span class="line">            <span class="variable language_">self</span>.receivers = [</span><br><span class="line">                r <span class="keyword">for</span> r <span class="keyword">in</span> <span class="variable language_">self</span>.receivers <span class="keyword">if</span> <span class="keyword">not</span> (<span class="built_in">isinstance</span>(r[<span class="number">1</span>], weakref.ReferenceType) <span class="keyword">and</span> r[<span class="number">1</span>]() <span class="keyword">is</span> <span class="literal">None</span>)</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_live_receivers</span>(<span class="params">self, sender</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        æ ¹æ®æŒ‡å®šçš„å‘é€è€…è·å–æ¥æ”¶å™¨åˆ—è¡¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Filter sequence of receivers to get resolved, live receivers.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This checks for weak references and resolves them, then returning only</span></span><br><span class="line"><span class="string">        live receivers.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–æ¥æ”¶å™¨åˆ—è¡¨å¯¹è±¡</span></span><br><span class="line">        receivers = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœä½¿ç”¨äº†ç¼“å­˜ï¼ŒåŒæ—¶ _dead_receivers ä¸º False æ—¶</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.use_caching <span class="keyword">and</span> <span class="keyword">not</span> <span class="variable language_">self</span>._dead_receivers:</span><br><span class="line">            <span class="comment"># ç›´æ¥é€šè¿‡å‘é€è€…å¯¹è±¡è·å–æ¥æ”¶å™¨åˆ—è¡¨</span></span><br><span class="line">            receivers = <span class="variable language_">self</span>.sender_receivers_cache.get(sender)</span><br><span class="line">            <span class="comment"># We could end up here with NO_RECEIVERS even if we do check this case in</span></span><br><span class="line">            <span class="comment"># .send() prior to calling _live_receivers() due to concurrent .send() call.</span></span><br><span class="line">            <span class="comment"># å¦‚æœæ¥æ”¶å™¨åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™ä¸åšä»»ä½•åŠ¨ä½œï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">if</span> receivers <span class="keyword">is</span> NO_RECEIVERS:</span><br><span class="line">                <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœæ¥æ”¶å™¨åˆ—è¡¨ä¸º None</span></span><br><span class="line">        <span class="keyword">if</span> receivers <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">                <span class="comment"># æ¸…é™¤æ— æ•ˆçš„æ¥æ”¶å™¨</span></span><br><span class="line">                <span class="variable language_">self</span>._clear_dead_receivers()</span><br><span class="line">                senderkey = _make_id(sender)</span><br><span class="line">                receivers = []</span><br><span class="line"></span><br><span class="line">                <span class="comment"># æ ¹æ®å‘é€è€…æ ¡éªŒï¼Œè·å–å‘é€è€…å¯¹è±¡å¯¹åº”çš„æ¥æ”¶å™¨åˆ—è¡¨</span></span><br><span class="line">                <span class="keyword">for</span> (receiverkey, r_senderkey), receiver <span class="keyword">in</span> <span class="variable language_">self</span>.receivers:</span><br><span class="line">                    <span class="comment"># å› ä¸º sender åœ¨æœ‰äº›ä¿¡å·å¯¹è±¡ä¸­æ˜¯ä¸º Noneï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯ NONE_ID</span></span><br><span class="line">                    <span class="keyword">if</span> r_senderkey == NONE_ID <span class="keyword">or</span> r_senderkey == senderkey:</span><br><span class="line">                        receivers.append(receiver)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># å¦‚æœä½¿ç”¨ç®¡ç†ç¼“å­˜ï¼Œåˆ™è¿›è¡Œç¼“å­˜</span></span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.use_caching:</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> receivers:</span><br><span class="line">                        <span class="variable language_">self</span>.sender_receivers_cache[sender] = NO_RECEIVERS</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment"># Note, we must cache the weakref versions.</span></span><br><span class="line">                        <span class="variable language_">self</span>.sender_receivers_cache[sender] = receivers</span><br><span class="line">        non_weak_receivers = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿­ä»£å¤„ç†è·å–éå¼±å¼•ç”¨çš„æ¥æ”¶å™¨ï¼ˆå³æ­£å¸¸çš„æ¥æ”¶å™¨ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> receiver <span class="keyword">in</span> receivers:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(receiver, weakref.ReferenceType):</span><br><span class="line">                <span class="comment"># Dereference the weak reference.</span></span><br><span class="line">                receiver = receiver()</span><br><span class="line">                <span class="keyword">if</span> receiver <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    non_weak_receivers.append(receiver)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># å¦‚æœæ˜¯å¼ºå¼•ç”¨ï¼Œåˆ™ç›´æ¥åŠ å…¥</span></span><br><span class="line">                non_weak_receivers.append(receiver)</span><br><span class="line">        <span class="keyword">return</span> non_weak_receivers</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_remove_receiver</span>(<span class="params">self, receiver=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å½“å¼±å¼•ç”¨å¼•ç”¨çš„å¯¹è±¡ä¸å­˜åœ¨æ—¶ï¼Œç»™å½“å‰çš„ä¿¡å·æ ‡è¯†å­˜åœ¨æ— æ•ˆçš„æ¥æ”¶å™¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        æ ‡æ³¨ self.receivers å­˜åœ¨æ— æ•ˆçš„å¼±å¼•ç”¨ã€‚å¦‚æœå­˜åœ¨æ— æ•ˆçš„å¼±å¼•ç”¨ï¼Œ</span></span><br><span class="line"><span class="string">        å°†åœ¨ connectã€disconnect å’Œ _live_receivers ä¸­æ¸…ç†è¿™äº›</span></span><br><span class="line"><span class="string">        æ— æ•ˆçš„å¼±å¼•ç”¨å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Mark that the self.receivers list has dead weakrefs. If so, we will</span></span><br><span class="line">        <span class="comment"># clean those up in connect, disconnect and _live_receivers while</span></span><br><span class="line">        <span class="comment"># holding self.lock. Note that doing the cleanup here isn&#x27;t a good</span></span><br><span class="line">        <span class="comment"># idea, _remove_receiver() will be called as side effect of garbage</span></span><br><span class="line">        <span class="comment"># collection, and so the call can happen while we are already holding</span></span><br><span class="line">        <span class="comment"># self.lock.</span></span><br><span class="line">        <span class="variable language_">self</span>._dead_receivers = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">receiver</span>(<span class="params">signal, **kwargs</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è¿æ¥æ¥æ”¶å™¨åˆ°ä¿¡å·çš„è£…é¥°å™¨ï¼Œå…¶å†…éƒ¨å®é™…ä¸Šæ˜¯å¯¹ connect æ–¹æ³•çš„åŒ…è£…ï¼Œä½¿ç”¨è£…é¥°å™¨çœ‹èµ·æ¥æ›´ç›´è§‚ä¸€äº›ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    A decorator for connecting receivers to signals. Used by passing in the</span></span><br><span class="line"><span class="string">    signal (or list of signals) and keyword arguments to connect::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @receiver(post_save, sender=MyModel)</span></span><br><span class="line"><span class="string">        def signal_receiver(sender, **kwargs):</span></span><br><span class="line"><span class="string">            ...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @receiver([post_save, post_delete], sender=MyModel)</span></span><br><span class="line"><span class="string">        def signals_receiver(sender, **kwargs):</span></span><br><span class="line"><span class="string">            ...</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_decorator</span>(<span class="params">func</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(signal, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">            <span class="keyword">for</span> s <span class="keyword">in</span> signal:</span><br><span class="line">                s.connect(func, **kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            signal.connect(func, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _decorator</span><br></pre></td></tr></table></figure>

<h1 id="2-å‡½æ•°æ¸…å•"><a href="#2-å‡½æ•°æ¸…å•" class="headerlink" title="2 å‡½æ•°æ¸…å•"></a>2 å‡½æ•°æ¸…å•</h1><h2 id="2-1-make-id-æ–¹æ³•"><a href="#2-1-make-id-æ–¹æ³•" class="headerlink" title="2.1 _make_id æ–¹æ³•"></a>2.1 _make_id æ–¹æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_make_id</span>(<span class="params">target</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(target, <span class="string">&quot;__func__&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">id</span>(target.__self__), <span class="built_in">id</span>(target.__func__))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">id</span>(target)</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè®¤çœŸåˆ†æä¸‹å…¶ä¸šåŠ¡å®ç°ï¼Œ<code>target</code> å‚æ•°æ˜¯æ¥æ”¶å™¨ï¼ˆå³æ™®é€šçš„å‡½æ•°æˆ–è€…æ˜¯ <code>bound</code> æ–¹æ³•ï¼‰</p>
<ul>
<li>å¦‚æœæ˜¯æ™®é€šçš„å‡½æ•°ï¼Œåˆ™ä½¿ç”¨ <code>id</code> å‡½æ•°è·å– <code>target</code> çš„å”¯ä¸€æ ‡è¯†ï¼Œè¿”å›çš„ç±»å‹æ˜¯æ•´å‹ï¼Œå³ä¸€ä¸ªæ•°å­—ã€‚</li>
<li>å¦‚æœæ˜¯ <code>bound</code> æ–¹æ³•ï¼Œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œå…¶å…ƒç»„åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ <code>target</code> æ‰€å…³è”å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ <code>target</code> çš„å”¯ä¸€æ ‡è¯†ã€‚</li>
</ul>
<p>åŒæ—¶å‚è€ƒä¸‹ <code>connect</code> æ–¹æ³•ä¸­å¯¹ <code>_make_id</code> çš„è°ƒç”¨ï¼Œä¸‹é¢æ‘˜å–ä¸€äº›ç‰‡æ®µ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> dispatch_uid:</span><br><span class="line">    lookup_key = (dispatch_uid, _make_id(sender))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    lookup_key = (_make_id(receiver), _make_id(sender))</span><br><span class="line"></span><br><span class="line"><span class="comment"># çœç•¥ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">    <span class="comment"># çœç•¥ä»£ç </span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(r_key == lookup_key <span class="keyword">for</span> r_key, _ <span class="keyword">in</span> <span class="variable language_">self</span>.receivers):</span><br><span class="line">        <span class="comment"># å¦‚æœæ¥æ”¶å™¨å¯¹åº”çš„é”®ä¸åœ¨ä¿¡å·å¯¹è±¡çš„æ¥æ”¶å™¨åˆ—è¡¨ä¸­ï¼Œåˆ™åŠ å…¥åˆ°æ¥æ”¶å™¨åˆ—è¡¨ä¸­</span></span><br><span class="line">        <span class="variable language_">self</span>.receivers.append((lookup_key, receiver))</span><br><span class="line">    <span class="comment"># çœç•¥ä»£ç </span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ° <code>lookup_key</code> æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œé‡ç‚¹å…³æ³¨äº†æ¥æ”¶å™¨ï¼Œæ‰€ä»¥å°±å…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ åšäº›è¯´æ˜ï¼Œå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ ¹æ®æ¥æ”¶å™¨çš„ç±»å‹ï¼Œæ‰€ä»¥æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå…ƒç»„ã€‚æ¥ä¸‹æ¥ä½¿ç”¨ä¸€ä¸ªç¤ºä¾‹éªŒè¯ä¸‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.signals <span class="keyword">import</span> request_started</span><br><span class="line"><span class="keyword">from</span> django.dispatch <span class="keyword">import</span> receiver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomSignal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bound_method</span>(<span class="params">self, signal=<span class="literal">None</span>, sender=<span class="literal">None</span>, environ=<span class="literal">None</span>, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;bound method receiver run&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(request_started.receivers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">custom_signal = CustomSignal()</span><br><span class="line">request_started.connect(custom_signal.bound_method)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@receiver(<span class="params">request_started</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">common_function</span>(<span class="params">signal=<span class="literal">None</span>, sender=<span class="literal">None</span>, environ=<span class="literal">None</span>, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;common method receiver run&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç¤ºä¾‹é’ˆå¯¹ request_started ä¿¡å·åšäº†ä¸¤ä¸ªæ¥æ”¶å™¨</p>
<ul>
<li><code>bound</code> æ–¹æ³•ï¼šcustom_signal.bound_method</li>
<li>æ™®é€šå‡½æ•°ï¼šcommon_function</li>
</ul>
<p>ç„¶åæ‰§è¡Œåçœ‹ä¸‹ç»“æœï¼š</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">bound <span class="keyword">method</span> <span class="title function_">receiver</span> <span class="title function_">run</span></span><br><span class="line">[</span><br><span class="line">    <span class="params">((4507063040, 4496364336)</span>, &lt;<span class="title function_">weakref</span> <span class="title function_">at</span> 0<span class="title function_">x10ca179c0</span>; <span class="keyword">to</span> <span class="string">&#x27;function&#x27;</span> at <span class="number">0</span>x10ca45300 (reset_queries)&gt;),</span><br><span class="line">    ((<span class="number">4507064640</span>, <span class="number">4496364336</span>), &lt;weakref at <span class="number">0</span>x10ca509a0<span class="punctuation">;</span> <span class="keyword">to</span> <span class="string">&#x27;function&#x27;</span> at <span class="number">0</span>x10ca45940 (close_old_connections)&gt;),</span><br><span class="line">    (((<span class="number">4522035984</span>, <span class="number">4521976480</span>), <span class="number">4496364336</span>), &lt;weakref at <span class="number">0</span>x10d859310<span class="punctuation">;</span> <span class="keyword">to</span> <span class="string">&#x27;CustomSignal&#x27;</span> at <span class="number">0</span>x10d88cb10&gt;),</span><br><span class="line">    ((<span class="number">4521976640</span>, <span class="number">4496364336</span>), &lt;weakref at <span class="number">0</span>x10d888b80<span class="punctuation">;</span> <span class="keyword">to</span> <span class="string">&#x27;function&#x27;</span> at <span class="number">0</span>x10d87e340 (common_function)&gt;)</span><br><span class="line">]</span><br><span class="line">common <span class="keyword">method</span> <span class="title function_">receiver</span> <span class="title function_">run</span></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æ‰§è¡Œç»“æœå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°</p>
<ul>
<li>å¦‚æœæ˜¯ bound æ–¹æ³•ï¼š<code>lookup_key</code> æ˜¯ <code>((4522035984, 4521976480), 4496364336)</code>ï¼Œå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¹Ÿæ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŸå‹å³ <code>(id(target.__self__), id(target.__func__))</code></li>
<li>å¦‚æœæ˜¯æ™®é€šçš„å‡½æ•°ï¼š<code>lookup_key</code> æ˜¯ <code>(4521976640, 4496364336)</code></li>
</ul>
<h2 id="2-2-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-threading-Lock"><a href="#2-2-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-threading-Lock" class="headerlink" title="2.2 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ threading.Lock"></a>2.2 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ threading.Lock</h2><p><code>Django</code> çš„ <code>Signal</code> ç³»ç»Ÿéœ€è¦å¤„ç†å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å¹¶å‘é—®é¢˜ã€‚åœ¨å¤šçº¿ç¨‹åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ <code>Signal</code> å¯¹è±¡ï¼Œä¾‹å¦‚è¿æ¥æˆ–æ–­å¼€æ¥æ”¶å™¨ã€å‘é€ä¿¡å·ç­‰ã€‚ä¸ºäº†ç¡®ä¿ <code>Signal</code> å¯¹è±¡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„ä¸€è‡´æ€§å’Œçº¿ç¨‹å®‰å…¨ï¼Œ<code>Django</code> ä½¿ç”¨ <code>threading.Lock</code> å¯¹å…³é”®éƒ¨åˆ†çš„ä»£ç è¿›è¡ŒåŠ é”ã€‚</p>
<p><code>threading.Lock</code> æ˜¯ Python æ ‡å‡†åº“ä¸­æä¾›çš„ä¸€ä¸ªåŸºæœ¬åŒæ­¥åŸè¯­ï¼Œç”¨äºåœ¨çº¿ç¨‹ä¹‹é—´æä¾›äº’æ–¥è®¿é—®å…±äº«èµ„æºçš„èƒ½åŠ›ã€‚é€šè¿‡ä½¿ç”¨é”ï¼Œ<code>Django</code> å¯ä»¥ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹ <code>Signal</code> å¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼Œé¿å…äº†æ½œåœ¨çš„ç«äº‰æ¡ä»¶å’Œä¸ä¸€è‡´é—®é¢˜ã€‚</p>
<p>ä»¥ä¸‹æ˜¯åœ¨ <code>Django Signal</code> ä¸­ä½¿ç”¨é”çš„å‡ ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>åœ¨è¿æ¥æ¥æ”¶å™¨æ—¶ï¼Œ<code>Django</code> ä½¿ç”¨é”æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨åœ°æ›´æ–°æ¥æ”¶å™¨åˆ—è¡¨ã€‚è¿™å¯ä»¥é˜²æ­¢åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­åŒæ—¶è¿æ¥æ¥æ”¶å™¨æ—¶å¯¼è‡´çš„ä¸ä¸€è‡´çŠ¶æ€ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">    <span class="variable language_">self</span>.receivers.append((lookup_key, receiver))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨æ–­å¼€æ¥æ”¶å™¨æ—¶ï¼ŒDjango åŒæ ·ä½¿ç”¨é”æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨åœ°ä»æ¥æ”¶å™¨åˆ—è¡¨ä¸­ç§»é™¤æ¥æ”¶å™¨</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.receivers)):</span><br><span class="line">        <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨å‘é€ä¿¡å·æ—¶ï¼ŒDjango ä½¿ç”¨é”æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨åœ°éå†æ¥æ”¶å™¨åˆ—è¡¨å¹¶è°ƒç”¨ç›¸åº”çš„æ¥æ”¶å™¨ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢åœ¨å‘é€ä¿¡å·çš„è¿‡ç¨‹ä¸­ä¿®æ”¹æ¥æ”¶å™¨åˆ—è¡¨å¯¼è‡´çš„æ½œåœ¨é—®é¢˜</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">    <span class="keyword">for</span> _, receiver <span class="keyword">in</span> <span class="variable language_">self</span>.receivers:</span><br><span class="line">        <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>æ€»ä¹‹ï¼Œ<code>Django</code> ä½¿ç”¨ <code>threading.Lock</code> æ¥ç¡®ä¿ <code>Signal</code> å¯¹è±¡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„çº¿ç¨‹å®‰å…¨ã€‚é€šè¿‡åœ¨å…³é”®ä»£ç æ®µä¸­ä½¿ç”¨é”ï¼Œå¯ä»¥é¿å…å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„ä¸ä¸€è‡´é—®é¢˜å’Œç«äº‰æ¡ä»¶ã€‚è¿™ä½¿å¾— Django çš„ Signal ç³»ç»Ÿåœ¨å¤šçº¿ç¨‹åº”ç”¨ä¸­èƒ½å¤Ÿå¯é åœ°å·¥ä½œ</p>
<h2 id="2-3-sender-å’Œ-sender-robust-çš„åŒºåˆ«"><a href="#2-3-sender-å’Œ-sender-robust-çš„åŒºåˆ«" class="headerlink" title="2.3 sender å’Œ sender_robust çš„åŒºåˆ«"></a>2.3 sender å’Œ sender_robust çš„åŒºåˆ«</h2><p>è¿™é‡Œé€šè¿‡æºç å¯ä»¥æ¸…æ¥šçœ‹åˆ°å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<p>åœ¨ <code>Django</code> ä¿¡å·ç³»ç»Ÿä¸­ï¼Œ<code>sender</code> å’Œ <code>sender_robust</code> å¹¶æ²¡æœ‰ç›´æ¥çš„åŒºåˆ«ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªè¯æ²¡æœ‰ç‰¹å®šçš„å®šä¹‰ã€‚å®ƒä»¬éƒ½æ˜¯ <code>Signal</code> ç±»çš„æ–¹æ³•ï¼Œç”¨äºå‘é€ä¿¡å·ï¼Œä½†åœ¨å¤„ç†æ¥æ”¶å™¨å¼‚å¸¸æ—¶ï¼Œè¡Œä¸ºæ˜¯ä¸åŒçš„ã€‚ä¸‹é¢è¯¦ç»†è§£é‡Šè¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«ï¼š</p>
<ul>
<li><strong>send</strong>: <code>send</code> æ–¹æ³•ç”¨äºå‘é€ä¿¡å·ã€‚å½“ä½¿ç”¨ <code>send</code> å‘é€ä¿¡å·æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ä¸ä¿¡å·å…³è”çš„æ‰€æœ‰æ¥æ”¶å™¨ã€‚å¦‚æœæ¥æ”¶å™¨å¼•å‘å¼‚å¸¸ï¼Œ<code>send</code> ä¼šå°†è¯¥å¼‚å¸¸æŠ›å‡ºï¼Œå¯¼è‡´ç¨‹åºä¸­æ­¢ã€‚æ¢å¥è¯è¯´ï¼Œ<code>send</code> åœ¨é‡åˆ°æ¥æ”¶å™¨å¼‚å¸¸æ—¶æ²¡æœ‰é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, sender, **named</span>):</span><br><span class="line">    <span class="comment"># ...çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">    responses = []</span><br><span class="line">    <span class="keyword">for</span> receiver <span class="keyword">in</span> <span class="variable language_">self</span>._live_receivers(sender):</span><br><span class="line">        response = receiver(signal=<span class="variable language_">self</span>, sender=sender, **named)</span><br><span class="line">        responses.append((receiver, response))</span><br><span class="line">    <span class="keyword">return</span> responses</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>send_robust</strong>: <code>send_robust</code> æ–¹æ³•ä¸ <code>send</code> ç±»ä¼¼ï¼Œä¹Ÿç”¨äºå‘é€ä¿¡å·ã€‚ä½†æ˜¯ï¼Œå®ƒä¼šå¤„ç†æ¥æ”¶å™¨æŠ›å‡ºçš„å¼‚å¸¸ã€‚å¦‚æœæ¥æ”¶å™¨å¼•å‘å¼‚å¸¸ï¼Œ<code>send_robust</code> ä¼šæ•è·å¼‚å¸¸å¹¶å°†å…¶æ·»åŠ åˆ°å“åº”åˆ—è¡¨ï¼Œè€Œä¸æ˜¯ä¸­æ–­ç¨‹åºã€‚è¿™æ„å‘³ç€ï¼Œåœ¨ä½¿ç”¨ <code>send_robust</code> æ—¶ï¼Œç¨‹åºä¼šç»§ç»­è¿è¡Œï¼Œå³ä½¿æŸä¸ªæ¥æ”¶å™¨æŠ›å‡ºäº†å¼‚å¸¸ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">send_robust</span>(<span class="params">self, sender, **named</span>):</span><br><span class="line">    <span class="comment"># ...çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">    responses = []</span><br><span class="line">    <span class="keyword">for</span> receiver <span class="keyword">in</span> <span class="variable language_">self</span>._live_receivers(sender):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = receiver(signal=<span class="variable language_">self</span>, sender=sender, **named)</span><br><span class="line">            responses.append((receiver, response))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            responses.append((receiver, err))</span><br><span class="line">    <span class="keyword">return</span> responses</span><br></pre></td></tr></table></figure>

<p>æ€»ä¹‹ï¼Œ<code>send</code> å’Œ <code>send_robust</code> çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬å¦‚ä½•å¤„ç†æ¥æ”¶å™¨æŠ›å‡ºçš„å¼‚å¸¸ã€‚<code>send</code> æ–¹æ³•åœ¨é‡åˆ°å¼‚å¸¸æ—¶ä¼šä¸­æ–­ç¨‹åºï¼Œè€Œ <code>send_robust</code> ä¼šæ•è·å¼‚å¸¸å¹¶å°†å…¶æ·»åŠ åˆ°å“åº”åˆ—è¡¨ï¼Œä»¥ä¾¿åœ¨åç»­å¤„ç†ã€‚<code>send_robust</code> ä¸ºç¨‹åºæä¾›äº†æ›´å¥å£®çš„é”™è¯¯å¤„ç†ï¼Œå› æ­¤åœ¨å¤„ç†æ½œåœ¨çš„æ¥æ”¶å™¨é”™è¯¯æ—¶æ›´å®‰å…¨ã€‚</p>
<h2 id="2-4-live-receivers-è¾…åŠ©å‡½æ•°"><a href="#2-4-live-receivers-è¾…åŠ©å‡½æ•°" class="headerlink" title="2.4 _live_receivers è¾…åŠ©å‡½æ•°"></a>2.4 _live_receivers è¾…åŠ©å‡½æ•°</h2><p><strong>_live_receivers</strong> æ˜¯ä¸€ä¸ªå†…éƒ¨è¾…åŠ©å‡½æ•°ï¼Œç”¨äºç­›é€‰å‡ºæœ‰æ•ˆçš„æ¥æ”¶å™¨åˆ—è¡¨ã€‚åœ¨å‘é€ä¿¡å·æ—¶ï¼Œ<code>Django</code> éœ€è¦æ‰¾åˆ°æ‰€æœ‰æ´»è·ƒçš„ã€æœ‰æ•ˆçš„æ¥æ”¶å™¨æ¥å“åº”ä¿¡å·ã€‚ç”±äºæŸäº›æ¥æ”¶å™¨å¯èƒ½ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆ<code>weak reference</code>ï¼‰æ¥é¿å…å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå½“æ¥æ”¶å™¨æŒ‡å‘çš„å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œå¼±å¼•ç”¨å°†ä¸å†æœ‰æ•ˆã€‚å› æ­¤ï¼Œåœ¨å‘é€ä¿¡å·å‰ï¼Œéœ€è¦ç­›é€‰å‡ºä»ç„¶æœ‰æ•ˆçš„æ¥æ”¶å™¨ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>DRFï¼šä¹¦å†™æ¥å£çš„é€šç”¨æµç¨‹</title>
    <url>/posts/11214/</url>
    <content><![CDATA[<p>æè¿°ï¼šä¹¦å†™æ¥å£çš„åŸºæœ¬æµç¨‹</p>
<span id="more"></span>

<p>åœ¨ä½¿ç”¨ <code>django-restful-framework</code> å†™åå°æ¥å£çš„ä¸šåŠ¡ä¸­ï¼Œåœ¨ä¸‹é€šç”¨çš„åšæ³•ï¼›</p>
<blockquote>
<p>å‰ç«¯æ•°æ®æ•°æ®â€”-&gt;æ£€æµ‹(åŒ…å«é™æµï¼Œè®¤è¯ï¼Œæƒé™éªŒè¯ï¼Œæ•°æ®æ£€æµ‹)â€”-&gt;æŒä¹…åŒ–</p>
</blockquote>
<p>å…¶ä¸­å¯¹äºé™æµå’Œæƒé™éªŒè¯ï¼Œéƒ½å¯ä»¥è‡ªå®šä¹‰ç±»è§£å†³éœ€æ±‚ï¼Œé‡ç‚¹è¿˜æ˜¯åœ¨äºæ•°æ®æ£€æµ‹ï¼Œæœ¬ç€ä¸èƒ½ç›¸ä¿¡å‰ç«¯è¾“å…¥çš„æ•°æ®çš„åŸåˆ™ï¼Œè¦åšå¥½æ•°æ®æ£€æµ‹ï¼Œä¹Ÿä¸æ˜¯ä»¶è½»è€Œæ˜“ä¸¾çš„äº‹æƒ…ï¼Œæ¯•ç«Ÿç–¯å­çš„æƒ³æ³•ä½ æ˜¯çŒœä¸é€çš„ã€‚</p>
<p>è¿™é‡Œé’ˆå¯¹æ•°æ®æ£€æµ‹ï¼Œåœ¨è¿™é‡Œè¯´è¯´æˆ‘çš„é€šç”¨åšæ³•ï¼Œè¿˜æ˜¯ä»¥ä¾‹è¯´æ˜ï¼š</p>
<h3 id="1-åœºæ™¯ï¼šè®¤è¯æœåŠ¡"><a href="#1-åœºæ™¯ï¼šè®¤è¯æœåŠ¡" class="headerlink" title="1 åœºæ™¯ï¼šè®¤è¯æœåŠ¡"></a>1 åœºæ™¯ï¼šè®¤è¯æœåŠ¡</h3><p>è¿™é‡Œåªæ˜¯ç®€å•çš„éªŒè¯ç”¨æˆ·ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥çš„å§“åï¼Œèº«ä»½è¯å·ç ï¼Œæ‰‹æœºå·ç ï¼ˆéœ€è¦å¡«å†™æ‰‹æœºå·ç æ˜¯ä¸ºäº†çŸ­ä¿¡éªŒè¯ï¼Œè¿™å¹´å¤´ï¼Œä¸åŠ ç‚¹æ–™ï¼Œéƒ½å¯¹ä¸èµ·è‡ªå·±ï¼‰ï¼ŒéªŒè¯è¾“å…¥çš„ä¿¡æ¯æ˜¯å¦åˆæ³•ï¼Œå½“ç„¶è¿™ä¸ªéªŒè¯ä¸æ˜¯å¾ˆé è°±ï¼Œåªæ˜¯ä¸ºäº†åšä¸ªä¾‹å­è€Œå·²ï¼Œä¸ç”¨å¤ªå½“çœŸï¼Œä¸ç„¶æ‰è¿›äº†ä½ æ˜¯è°ï¼Œæˆ‘åˆæ˜¯è°çš„é»‘æ´ï¼Œé‚£å°±å®Œè›‹äº†ã€‚</p>
<h3 id="2-ä¸šåŠ¡æµç¨‹æ­¥éª¤"><a href="#2-ä¸šåŠ¡æµç¨‹æ­¥éª¤" class="headerlink" title="2 ä¸šåŠ¡æµç¨‹æ­¥éª¤"></a>2 ä¸šåŠ¡æµç¨‹æ­¥éª¤</h3><p>è¯´æ˜ï¼šä»£ç ä»¥ä¼ªä»£ç ä¸ºä¸»</p>
<h4 id="2-1-å‡†å¤‡ä¸¤ä¸ª-serializer"><a href="#2-1-å‡†å¤‡ä¸¤ä¸ª-serializer" class="headerlink" title="2.1 å‡†å¤‡ä¸¤ä¸ª serializer"></a>2.1 å‡†å¤‡ä¸¤ä¸ª serializer</h4><p>ä¸ºä»€ä¹ˆè¦å‡†å¤‡ä¸¤ä¸ª <code>serializer</code>ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>è¾“å…¥çš„æ•°æ®ç»“æ„å’Œä½ æœŸæœ›è¿”å›çš„æ•°æ®ç»“æ„æœ‰å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„</li>
<li>ä¸šåŠ¡æ‹†åˆ†ï¼Œä¿æŒä¸šåŠ¡ç‹¬ç«‹ï¼Œæ¸…æ™°</li>
</ul>
<p>æ£€æµ‹æ•°æ®çš„ serializer:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VerifyForm</span>(serializers.Serializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;éªŒè¯è®¤è¯ç”¨æˆ·è¾“å…¥æ•°æ®&quot;&quot;&quot;</span></span><br><span class="line">    username = serializers.CharField(max_length=<span class="number">64</span>, min_length=<span class="number">2</span>)</span><br><span class="line">    id_number = serializers.CharField(max_length=<span class="number">18</span>, min_length=<span class="number">15</span>)</span><br><span class="line">    sms_code = serializers.CharField(max_length=<span class="number">6</span>, min_length=<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_username</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> æ£€æµ‹è¾“å…¥çš„ç”¨æˆ·åä¸åˆæ³•:</span><br><span class="line">            <span class="keyword">raise</span> å¼‚å¸¸</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_id_number</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> æ£€æµ‹è¾“å…¥çš„èº«ä»½è¯å·ç ä¸åˆæ³•:</span><br><span class="line">            <span class="keyword">raise</span> å¼‚å¸¸</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_sms_code</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> æ£€æµ‹è¾“å…¥çš„çŸ­ä¿¡éªŒè¯ç ä¸åˆæ³•:</span><br><span class="line">            <span class="keyword">raise</span> å¼‚å¸¸</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate</span>(<span class="params">self, attrs</span>):</span><br><span class="line">        <span class="keyword">if</span> å¤–éƒ¨æœåŠ¡(username, id_number) ä¸åˆæ³•:</span><br><span class="line">            <span class="keyword">raise</span> å¼‚å¸¸</span><br><span class="line">        <span class="keyword">return</span> attrs</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, validated_data</span>):</span><br><span class="line">         æŒä¹…åŒ–</span><br><span class="line">         <span class="keyword">return</span> instance</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–å¯¹è±¡çš„ serializer:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VerifySerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åºåˆ—åŒ–æ•°æ®&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    ä½ å¯ä»¥åšç‚¹è‡ªå·±å–œæ¬¢çš„äº‹æƒ…ï¼Œå•Šå“ˆ</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Verify</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-ä¹¦å†™-views"><a href="#2-2-ä¹¦å†™-views" class="headerlink" title="2.2 ä¹¦å†™ views"></a>2.2 ä¹¦å†™ views</h4><p>é’ˆå¯¹åˆ›å»ºçš„ä¸šåŠ¡ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">perform_create</span>(<span class="params">self, serializer</span>):</span><br><span class="line">    <span class="keyword">return</span> serializer.save()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">    serializer = VerifyForm(data=request.data, context=&#123;<span class="string">&#x27;request&#x27;</span>: request&#125;)</span><br><span class="line">    <span class="comment"># æ£€éªŒæ•°æ®</span></span><br><span class="line">    serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># æŒä¹…åŒ–</span></span><br><span class="line">    instance = <span class="variable language_">self</span>.perform_create(serializer)</span><br><span class="line">    <span class="comment"># åºåˆ—åŒ–æ•°æ®</span></span><br><span class="line">    serializer = <span class="variable language_">self</span>.get_serializer(instance)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<h3 id="3-å°ç»“"><a href="#3-å°ç»“" class="headerlink" title="3 å°ç»“"></a>3 å°ç»“</h3><p>è¿™ç§åšæ³•æ˜¯æˆ‘é€šå¸¸å†™æ¥å£ä¸šåŠ¡çš„æµç¨‹ï¼ŒéªŒè¯æ£€æµ‹å½’éªŒè¯æ£€æµ‹ï¼Œåºåˆ—åŒ–å½’åºåˆ—åŒ–ï¼Œä¸¤ç§ç±»å‹äº’ä¸å¹²æ‰°ï¼Œå½“ç„¶å¯¹äºç®€å•çš„ä¸šåŠ¡ä½ å¯ä»¥å…¨éƒ¨æ”¾åˆ°åŒä¸€ä¸ª serializer ä¸­ï¼Œè¿™ä¸ªæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚èµ°ï¼Œæ²¡æœ‰æ›´å¥½ï¼Œåªæœ‰åˆé€‚ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Django</tag>
        <tag>Django-Rest-Framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Django | Mysql è¿”å›ä¸åˆæ³•çš„æ—¥æœŸæ—¶é—´å¯¹è±¡</title>
    <url>/posts/26483/</url>
    <content><![CDATA[<h3 id="1-é”™è¯¯æè¿°"><a href="#1-é”™è¯¯æè¿°" class="headerlink" title="1 é”™è¯¯æè¿°"></a>1 é”™è¯¯æè¿°</h3><p>åœ¨æŸ¥è¯¢æ•°æ®é›†ä¸­çš„æ—¥æœŸæ—¶é—´å¯¹è±¡æ—¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">38</span>]: Device.objects.datetimes(<span class="string">&#x27;latest_alarm_time&#x27;</span>, <span class="string">&#x27;month&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Out[<span class="number">38</span>]: SELECT DISTINCT</span><br><span class="line">CAST(DATE_FORMAT(CONVERT_TZ(`device_device`.`latest_alarm_time`, <span class="string">&#x27;UTC&#x27;</span>, <span class="string">&#x27;Asia/Shanghai&#x27;</span>), <span class="string">&#x27;%Y-%m-01 00:00:00&#x27;</span>) AS DATETIME) AS `datetimefield` FROM `device_device` WHERE `device_device`.`latest_alarm_time` IS NOT NULL ORDER BY `datetimefield` ASC LIMIT <span class="number">21</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæŠ¥é”™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ValueError: Database returned an invalid datetime value. Are time zone definitions <span class="keyword">for</span> your database installed?</span><br></pre></td></tr></table></figure>

<h3 id="2-è§£å†³é—®é¢˜"><a href="#2-è§£å†³é—®é¢˜" class="headerlink" title="2 è§£å†³é—®é¢˜"></a>2 è§£å†³é—®é¢˜</h3><p>å®é™…æƒ…å†µï¼Œæ•°æ®åº“ä¸­æ˜¯æœ‰æ•°æ®ï¼Œç›®æµ‹æœˆä»½æå–å¤±è´¥ï¼›åˆ° mysql æ‰§è¡Œäº†ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mysql root@localhost:py365&gt; select convert_tz(<span class="string">&#x27;2018-05-10 12:30:00&#x27;</span>, <span class="string">&#x27;UTC&#x27;</span>, <span class="string">&#x27;Asia/Shanghai&#x27;</span>);</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">| convert_tz(<span class="string">&#x27;2018-05-10 12:30:00&#x27;</span>, <span class="string">&#x27;UTC&#x27;</span>, <span class="string">&#x27;Asia/Shanghai&#x27;</span>)   |</span><br><span class="line">|-------------------------------------------------------------|</span><br><span class="line">| NULL                                                        |</span><br><span class="line">+-------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>æœç„¶ï¼Œç»“æœè¿”å›ä»¤äººè¯§å¼‚çš„ <code>NULL</code></p>
<p>çœ‹äº†ä¸‹ Django orm çš„ datetimes å®˜æ–¹æ–‡æ¡£</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Note</span><br><span class="line">This function performs time zone conversions directly <span class="keyword">in</span> the database. As a consequence, your database must be able to interpret the value of tzinfo.tzname(<span class="literal">None</span>). This translates into the following requirements:</span><br><span class="line"></span><br><span class="line">SQLite: no requirements. Conversions are performed <span class="keyword">in</span> Python <span class="keyword">with</span> pytz (installed when you install Django).</span><br><span class="line">PostgreSQL: no requirements (see Time Zones).</span><br><span class="line">Oracle: no requirements (see Choosing a Time Zone File).</span><br><span class="line">MySQL: load the time zone tables <span class="keyword">with</span> mysql_tzinfo_to_sql.</span><br></pre></td></tr></table></figure>

<p>å³ mysql éœ€è¦ä½¿ç”¨ mysql_tzinfo_to_sql è½½å…¥æ—¶åŒºè¡¨ï¼Œæ¥ç€è·³åˆ° <a href="https://dev.mysql.com/doc/refman/8.0/en/mysql-tzinfo-to-sql.html">https://dev.mysql.com/doc/refman/8.0/en/mysql-tzinfo-to-sql.html</a></p>
<p>æŒ‰ç…§ mysql å®˜æ–¹çš„æ–‡æ¡£</p>
<p><code>For the first invocation syntax, pass the zoneinfo directory path name to mysql_tzinfo_to_sql and send the output into the mysql program. For example:</code></p>
<p>æˆ‘éœ€è¦æŒ‰ç…§ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œ</p>
<blockquote>
<p>mysql_tzinfo_to_sql &#x2F;usr&#x2F;share&#x2F;zoneinfo | mysql -u root mysql</p>
</blockquote>
<p>ç„¶åå†æ¬¡æ‰§è¡Œä¸Šé¢æ‰§è¡Œè¿‡çš„è½¬æ¢è¯­å¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mysql root@localhost:py365&gt; select convert_tz(<span class="string">&#x27;2018-05-10 12:30:00&#x27;</span>, <span class="string">&#x27;UTC&#x27;</span>, <span class="string">&#x27;Asia/Shanghai&#x27;</span>);</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">| convert_tz(<span class="string">&#x27;2018-05-10 12:30:00&#x27;</span>, <span class="string">&#x27;UTC&#x27;</span>, <span class="string">&#x27;Asia/Shanghai&#x27;</span>)   |</span><br><span class="line">|-------------------------------------------------------------|</span><br><span class="line">| <span class="number">2018</span>-05-<span class="number">10</span> <span class="number">20</span>:<span class="number">30</span>:<span class="number">00</span>                                         |</span><br><span class="line">+-------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>yesï¼Œè¿”å›äº†æ­£ç¡®çš„ç»“æœï¼›</p>
<p>åœ¨ shell ä¸­ æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢è¯­å¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">45</span>]: Device.objects.datetimes(<span class="string">&#x27;latest_alarm_time&#x27;</span>, <span class="string">&#x27;month&#x27;</span>)</span><br><span class="line">Out[<span class="number">45</span>]: SELECT DISTINCT CAST(DATE_FORMAT(CONVERT_TZ(`device_device`.`latest_alarm_time`, <span class="string">&#x27;UTC&#x27;</span>, <span class="string">&#x27;Asia/Shanghai&#x27;</span>), <span class="string">&#x27;%Y-%m-01 00:00:00&#x27;</span>) AS DATETIME) AS `datetimefield` FROM `device_device` WHERE `device_device`.`latest_alarm_time` IS NOT NULL ORDER BY `datetimefield` ASC LIMIT <span class="number">21</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Execution time: <span class="number">0.000591</span>s [Database: default]</span><br><span class="line"></span><br><span class="line">&lt;QuerySet [datetime.datetime(<span class="number">2018</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, tzinfo=&lt;DstTzInfo <span class="string">&#x27;Asia/Shanghai&#x27;</span> CST+<span class="number">8</span>:<span class="number">00</span>:<span class="number">00</span> STD&gt;)]&gt;</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸ï¼Œso é—®é¢˜è§£å†³ï¼Œçœ‹æ¥è¿˜å¾—è®¤çœŸçœ‹æ–‡æ¡£å‘€</p>
]]></content>
      <categories>
        <category>åç«¯</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Mysql</tag>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django | è™šæ‹Ÿå­—æ®µ</title>
    <url>/posts/37001/</url>
    <content><![CDATA[<p>è¿™æ¬¡å†™å†™ Django æ¨¡å‹ä¸­çš„è™šæ‹Ÿå­—æ®µã€‚è¿™ä¸ªè™šæ‹Ÿå­—æ®µå¾ˆæœ‰æ„æ€ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒåæŸ¥å¯ä»¥è®©ä¸šåŠ¡ä»£ç çœ‹èµ·æ¥å¾ˆæ¸…æ™°ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯ç»“åˆ <code>prefetch_related</code> å’Œ <code>select_related</code> æ¥ä½¿ç”¨ã€‚<span id="more"></span></p>
<h3 id="1-æ¨¡å‹"><a href="#1-æ¨¡å‹" class="headerlink" title="1 æ¨¡å‹"></a>1 æ¨¡å‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Category</span>(models.Model):</span><br><span class="line">    user = models.ForeignKey(</span><br><span class="line">        to=settings.AUTH_USER_MODEL,</span><br><span class="line">        on_delete=models.CASCADE,</span><br><span class="line">        related_name=<span class="string">&#x27;category_user&#x27;</span>,</span><br><span class="line">        null=<span class="literal">True</span>,</span><br><span class="line">        default=<span class="literal">None</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span>(models.Model):</span><br><span class="line">    user = models.OneToOneField(to=settings.AUTH_USER_MODEL, on_delete=models.CASCADE)</span><br><span class="line">    category = models.ManyToManyField(Category)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    article = models.OneToOneField(</span><br><span class="line">        Article, on_delete=models.CASCADE, related_name=<span class="string">&#x27;books&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tag</span>(models.Model):</span><br><span class="line">    article = models.ForeignKey(Article, on_delete=models.CASCADE)</span><br><span class="line">    users = models.ManyToManyField(User, related_name=<span class="string">&#x27;tag_users&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå†™äº†åˆ†ç±»æ¨¡å‹å’Œæ–‡ç« æ¨¡å‹ï¼Œé‡Œé¢åŒ…å«äº†åŸºæœ¬çš„ä¸‰ç§å…³ç³»ï¼š</p>
<ul>
<li>OneToOneField</li>
<li>ForeignKey</li>
<li>ManyToManyField</li>
</ul>
<h3 id="2-æ¨¡å‹ä¸­çš„è™šæ‹Ÿå­—æ®µ"><a href="#2-æ¨¡å‹ä¸­çš„è™šæ‹Ÿå­—æ®µ" class="headerlink" title="2 æ¨¡å‹ä¸­çš„è™šæ‹Ÿå­—æ®µ"></a>2 æ¨¡å‹ä¸­çš„è™šæ‹Ÿå­—æ®µ</h3><p>è™šæ‹Ÿå­—æ®µä¸€èˆ¬å­˜åœ¨äºçˆ¶æ¨¡å‹ä¸­ã€‚å¯¹äºä¸Šè¿°ä¸‰ç§å…³ç³»ï¼Œè™šæ‹Ÿå­—æ®µçš„åç§°éƒ½ä¼šå—æ˜¯å¦æŒ‡å®š <code>related_name</code> çš„å½±å“ã€‚</p>
<p><strong>è§„åˆ™ 1ï¼š</strong></p>
<blockquote>
<p>å¦‚æœå¼•ç”¨æ¨¡å‹æŒ‡å®šäº† related_nameï¼Œé‚£ä¹ˆçˆ¶æ¨¡å‹ï¼ˆè¢«å¼•ç”¨æ¨¡å‹ï¼‰å­˜åœ¨æŒ‡å®šçš„ related_name åç§°çš„å­—æ®µ</p>
</blockquote>
<p><strong>è§„åˆ™ 2ï¼š</strong></p>
<blockquote>
<p>å¦‚æœæ²¡æœ‰æŒ‡å®š related_nameï¼Œé‚£ä¹ˆçˆ¶æ¨¡å‹ï¼ˆè¢«å¼•ç”¨æ¨¡å‹ï¼‰å­˜åœ¨å­æ¨¡å‹å°å†™åç§°çš„å­—æ®µ</p>
</blockquote>
<h4 id="2-1-OneToOneField-å…³ç³»ä¸‹çš„éªŒè¯"><a href="#2-1-OneToOneField-å…³ç³»ä¸‹çš„éªŒè¯" class="headerlink" title="2.1 OneToOneField å…³ç³»ä¸‹çš„éªŒè¯"></a>2.1 OneToOneField å…³ç³»ä¸‹çš„éªŒè¯</h4><h5 id="2-1-1-æŒ‡å®šäº†-related-name"><a href="#2-1-1-æŒ‡å®šäº†-related-name" class="headerlink" title="2.1.1 æŒ‡å®šäº† related_name"></a>2.1.1 æŒ‡å®šäº† related_name</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">5</span>]: Article._meta.get_field(<span class="string">&#x27;books&#x27;</span>)</span><br><span class="line">Out[<span class="number">5</span>]: &lt;OneToOneRel: mallshop.book&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: Article._meta.get_field(<span class="string">&#x27;books&#x27;</span>).concrete</span><br><span class="line">Out[<span class="number">7</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><code>Book</code> æ¨¡å‹å¼•ç”¨äº† <code>Article</code> æ¨¡å‹ï¼ŒåŒæ—¶æŒ‡å®šäº† <code>related_name</code>, è¿™æ—¶ <code>Article</code> æ¨¡å‹å­˜åœ¨ <code>books</code> çš„è™šæ‹Ÿå­—æ®µ</p>
<h5 id="2-1-2-æ²¡æœ‰æŒ‡å®š-related-name"><a href="#2-1-2-æ²¡æœ‰æŒ‡å®š-related-name" class="headerlink" title="2.1.2 æ²¡æœ‰æŒ‡å®š related_name"></a>2.1.2 æ²¡æœ‰æŒ‡å®š related_name</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">8</span>]: User._meta.get_field(<span class="string">&#x27;article&#x27;</span>)</span><br><span class="line">Out[<span class="number">8</span>]: &lt;OneToOneRel: mallshop.article&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: User._meta.get_field(<span class="string">&#x27;article&#x27;</span>).concrete</span><br><span class="line">Out[<span class="number">9</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><code>Article</code> æ¨¡å‹å¼•ç”¨äº† <code>User</code> æ¨¡å‹ï¼Œæ²¡æœ‰æŒ‡å®š <code>related_name</code>ï¼Œè¿™æ—¶ <code>User</code> æ¨¡å‹å­˜åœ¨ <code>artilce</code> è™šæ‹Ÿå­—æ®µ</p>
<h4 id="2-2-ForeignKey-å…³ç³»ä¸‹çš„éªŒè¯"><a href="#2-2-ForeignKey-å…³ç³»ä¸‹çš„éªŒè¯" class="headerlink" title="2.2 ForeignKey å…³ç³»ä¸‹çš„éªŒè¯"></a>2.2 ForeignKey å…³ç³»ä¸‹çš„éªŒè¯</h4><h5 id="2-2-1-æŒ‡å®šäº†-related-name"><a href="#2-2-1-æŒ‡å®šäº†-related-name" class="headerlink" title="2.2.1 æŒ‡å®šäº† related_name"></a>2.2.1 æŒ‡å®šäº† related_name</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">10</span>]: User._meta.get_field(<span class="string">&#x27;category_user&#x27;</span>)</span><br><span class="line">Out[<span class="number">10</span>]: &lt;ManyToOneRel: mallshop.category&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: User._meta.get_field(<span class="string">&#x27;category_user&#x27;</span>).concrete</span><br><span class="line">Out[<span class="number">11</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><code>Category</code> æ¨¡å‹å¼•ç”¨äº† <code>User</code> æ¨¡å‹ï¼ŒåŒæ—¶æŒ‡å®šäº† <code>related_name</code>, è¿™æ—¶ <code>User</code> æ¨¡å‹å­˜åœ¨ <code>category_user</code> çš„è™šæ‹Ÿå­—æ®µ</p>
<h5 id="2-2-2-æ²¡æœ‰æŒ‡å®š-related-name"><a href="#2-2-2-æ²¡æœ‰æŒ‡å®š-related-name" class="headerlink" title="2.2.2 æ²¡æœ‰æŒ‡å®š related_name"></a>2.2.2 æ²¡æœ‰æŒ‡å®š related_name</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">12</span>]: Article._meta.get_field(<span class="string">&#x27;tag&#x27;</span>)</span><br><span class="line">Out[<span class="number">12</span>]: &lt;ManyToOneRel: mallshop.tag&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: Article._meta.get_field(<span class="string">&#x27;tag&#x27;</span>).concrete</span><br><span class="line">Out[<span class="number">13</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><code>Tag</code> æ¨¡å‹å¼•ç”¨äº† <code>Article æ¨¡å‹</code>ï¼Œæ²¡æœ‰æŒ‡å®š <code>related_name</code>ï¼Œè¿™æ—¶ <code>Article</code> æ¨¡å‹å­˜åœ¨ <code>tag</code> è™šæ‹Ÿå­—æ®µ</p>
<h4 id="2-3-ManyToManyField-å…³ç³»ä¸‹çš„éªŒè¯"><a href="#2-3-ManyToManyField-å…³ç³»ä¸‹çš„éªŒè¯" class="headerlink" title="2.3 ManyToManyField å…³ç³»ä¸‹çš„éªŒè¯"></a>2.3 ManyToManyField å…³ç³»ä¸‹çš„éªŒè¯</h4><h5 id="2-3-1-æŒ‡å®šäº†-related-name"><a href="#2-3-1-æŒ‡å®šäº†-related-name" class="headerlink" title="2.3.1 æŒ‡å®šäº† related_name"></a>2.3.1 æŒ‡å®šäº† related_name</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: User._meta.get_field(<span class="string">&#x27;tag_users&#x27;</span>)</span><br><span class="line">Out[<span class="number">1</span>]: &lt;ManyToManyRel: mallshop.tag&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: User._meta.get_field(<span class="string">&#x27;tag_users&#x27;</span>).concrete</span><br><span class="line">Out[<span class="number">2</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><code>Tag</code> æ¨¡å‹å¼•ç”¨äº† <code>User</code> æ¨¡å‹ï¼ŒåŒæ—¶æŒ‡å®šäº† <code>related_name</code> ä¸º <code>tag_users</code>, è¿™æ—¶ <code>User</code> æ¨¡å‹å­˜åœ¨ <code>tag_users</code> çš„è™šæ‹Ÿå­—æ®µ</p>
<h5 id="2-3-2-æ²¡æœ‰æŒ‡å®š-related-name"><a href="#2-3-2-æ²¡æœ‰æŒ‡å®š-related-name" class="headerlink" title="2.3.2 æ²¡æœ‰æŒ‡å®š related_name"></a>2.3.2 æ²¡æœ‰æŒ‡å®š related_name</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">15</span>]: Category._meta.get_field(<span class="string">&#x27;article&#x27;</span>)</span><br><span class="line">Out[<span class="number">15</span>]: &lt;ManyToManyRel: mallshop.article&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: Category._meta.get_field(<span class="string">&#x27;article&#x27;</span>).concrete</span><br><span class="line">Out[<span class="number">16</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><code>Article</code> æ¨¡å‹å¼•ç”¨äº† <code>Category</code> æ¨¡å‹ï¼Œæ²¡æœ‰æŒ‡å®š <code>related_name</code>ï¼Œè¿™æ—¶ <code>Category</code> æ¨¡å‹å­˜åœ¨ <code>article</code> è™šæ‹Ÿå­—æ®µ</p>
<h3 id="3-æ¨¡å‹å®ä¾‹è®¿é—®è™šæ‹Ÿå­—æ®µ"><a href="#3-æ¨¡å‹å®ä¾‹è®¿é—®è™šæ‹Ÿå­—æ®µ" class="headerlink" title="3 æ¨¡å‹å®ä¾‹è®¿é—®è™šæ‹Ÿå­—æ®µ"></a>3 æ¨¡å‹å®ä¾‹è®¿é—®è™šæ‹Ÿå­—æ®µ</h3><p>å¦‚æœåœ¨æ¨¡å‹å®ä¾‹ï¼Œè®¿é—®è™šæ‹Ÿå­—æ®µæ—¶ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä»¥ä¸‹è§„åˆ™ï¼š</p>
<p><strong>è§„åˆ™ 1ï¼š</strong></p>
<blockquote>
<p>å¦‚æœæ˜¯ OneToOneField å…³ç³»ï¼Œè®¿é—®æ¨¡å‹å®ä¾‹çš„è™šæ‹Ÿå­—æ®µå±æ€§æ—¶ï¼Œè¿™æ—¶è¿”å›çš„æ˜¯å­æ¨¡å‹çš„å®ä¾‹</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">3</span>]: user = User.objects.first()</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: user.article</span><br><span class="line">Out[<span class="number">4</span>]: &lt;Article: Article <span class="built_in">object</span> (<span class="number">1</span>)&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: user.article.books</span><br><span class="line">Out[<span class="number">5</span>]: &lt;Book: Book <span class="built_in">object</span> (<span class="number">1</span>)&gt;</span><br></pre></td></tr></table></figure>

<p><strong>è§„åˆ™ 2ï¼š</strong></p>
<blockquote>
<p>å¦‚æœæ˜¯é OneToOneField å…³ç³»ï¼ŒåŒæ—¶æŒ‡å®šäº† related_nameï¼Œè®¿é—®æ¨¡å‹å®ä¾‹çš„è™šæ‹Ÿå­—æ®µå±æ€§æ—¶ï¼Œè¿™æ—¶è¿”å›çš„æ˜¯ RelatedManager å®ä¾‹</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">9</span>]: user.category_user</span><br><span class="line">Out[<span class="number">9</span>]: &lt;django.db.models.fields.related_descriptors.create_reverse_many_to_one_manager.&lt;<span class="built_in">locals</span>&gt;.RelatedManager at <span class="number">0x107c10610</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>è§„åˆ™ 3ï¼š</strong></p>
<blockquote>
<p>å¦‚æœæ˜¯é OneToOneField å…³ç³»ï¼ŒåŒæ—¶æ²¡æœ‰æŒ‡å®š related_nameï¼Œè®¿é—®æ¨¡å‹å®ä¾‹çš„è™šæ‹Ÿå­—æ®µå±æ€§æ—¶ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæƒ³å¾—åˆ°ä¸€ä¸ª RelatedManager å®ä¾‹ï¼Œåˆ™éœ€è¦åœ¨è™šæ‹Ÿå­—æ®µååŠ ä¸Š _set åï¼Œåœ¨è¿›è¡Œè®¿é—®</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">6</span>]: article = Article.objects.first()</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: article.tag</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">AttributeError                            Traceback (most recent call last)</span><br><span class="line">&lt;ipython-<span class="built_in">input</span>-<span class="number">7</span>-ad987724bf64&gt; <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">----&gt; <span class="number">1</span> article.tag</span><br><span class="line"></span><br><span class="line">AttributeError: <span class="string">&#x27;Article&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;tag&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: article.tag_set</span><br><span class="line">Out[<span class="number">8</span>]: &lt;django.db.models.fields.related_descriptors.create_reverse_many_to_one_manager.&lt;<span class="built_in">locals</span>&gt;.RelatedManager at <span class="number">0x108053220</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4 å°ç»“"></a>4 å°ç»“</h3><p>è™šæ‹Ÿå­—æ®µï¼Œæ³¨æ„åœ¨æ¨¡å‹å’Œæ¨¡å‹å®ä¾‹ä¸‹çš„ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>è¯è¯´è™šæ‹Ÿå­—æ®µæœ‰å•¥ç”¨ï¼Œå¯ä»¥åæŸ¥ï¼Œåœ¨æˆ‘ä½¿ç”¨çš„åœºæ™¯ä¸­ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯å¯ä»¥åŸºäº <code>DRF</code> åŠ¨æ€æ„å»ºåºåˆ—åŒ–ç±»ï¼Œä¾‹å¦‚æƒ³å¾—åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œè¿™ä¸ªæ–‡ç« è¿˜è¦åŒ…å«äº›ä½œè€…ä¿¡æ¯ï¼Œå‰ç«¯å¯ä»¥è¿™æ ·ä¼ </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;display_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;username&quot;</span><span class="punctuation">,</span> <span class="string">&quot;id&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;id&quot;</span><span class="punctuation">,</span> <span class="string">&quot;name&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿”å›çš„ç»“æœ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ceshi1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å´å°æ¥ &quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tag1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>åç«¯å¯ä»¥æ ¹æ®å‰ç«¯ä¼ é€’çš„è·å–å­—æ®µåˆ—è¡¨è¿›è¡Œæ ¡éªŒï¼ŒéªŒè¯é€šè¿‡åæ ¹æ®è·å–çš„å­—æ®µåŠ¨æ€çš„ç”Ÿæˆå¯¹åº”çš„åºåˆ—åŒ–ç±»ï¼ŒåµŒå¥—çš„åºåˆ—åŒ–ç±»ä¹ŸåªåŒ…å«æŒ‡å®šçš„å­—æ®µï¼Œè¿™æ ·åœ¨æœåŠ¡ç«¯å¯ä»¥æå‡äº›æ¥å£æ€§èƒ½ã€‚è¿”å›ç»™å‰ç«¯ï¼Œè¿™ä¸ªæˆ‘æ˜¯å‚è€ƒäº† <code>graphql</code> çš„æ¨¡å¼ï¼Œå‰ç«¯éœ€è¦è¿”å›ä»€ä¹ˆï¼Œå°±æŒ‡å®šä»€ä¹ˆã€‚</p>
<p>å¦‚æœä½¿ç”¨ Djangoï¼Œè™šæ‹Ÿå­—æ®µçš„ä½¿ç”¨æ—¶é¿å…ä¸äº†çš„ï¼Œæ·±åº¦æŒ–æ˜è™šæ‹Ÿå­—æ®µçš„ä½¿ç”¨ï¼Œä¼šè·Ÿä¸šåŠ¡å¸¦æ¥å¾ˆå¤§çš„ä¾¿åˆ©æ€§ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>èµ„æºåŠ é€Ÿç³»åˆ—ä¹‹ pip</title>
    <url>/posts/26327/</url>
    <content><![CDATA[<p>åœ¨ <code>python</code> é¡¹ç›®ä¸­ï¼Œå®‰è£…åŒ…æ—¶ï¼Œéƒ½ä¼šä»å®˜æ–¹é»˜è®¤çš„æºï¼š<span id="more"></span></p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">https:</span>//pypi<span class="meta">.org</span>/simple</span><br></pre></td></tr></table></figure>

<p>ä¸­ä¸‹è½½ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼ŒåŸå› ä¸å¤šè¯´äº†ï¼Œé’ˆå¯¹è¿™ä¸ªæƒ…å†µï¼Œå›½å†…æœ‰äº›å…¬å¸å’Œæœºæ„åšäº†é•œåƒç«™ï¼Œä»¥ä¾¿å›½å†…çš„ç”¨æˆ·æé«˜ä¸‹è½½é€Ÿåº¦ã€‚</p>
<!--more-->

<h3 id="1-å›½å†…çš„é•œåƒæºåˆ—è¡¨"><a href="#1-å›½å†…çš„é•œåƒæºåˆ—è¡¨" class="headerlink" title="1 å›½å†…çš„é•œåƒæºåˆ—è¡¨"></a>1 å›½å†…çš„é•œåƒæºåˆ—è¡¨</h3><p>åˆ—ä¸¾å‡ ä¸ªå¸¸ç”¨çš„ï¼Œå°‘ç”¨çš„å°±ä¸åˆ—äº†</p>
<ul>
<li><a href="https://mirrors.aliyun.com/pypi/simple/">https://mirrors.aliyun.com/pypi/simple/</a> é˜¿é‡Œäº‘</li>
<li><a href="https://pypi.tuna.tsinghua.edu.cn/simple/">https://pypi.tuna.tsinghua.edu.cn/simple/</a> æ¸…åå¤§å­¦</li>
<li><a href="https://pypi.doubanio.com/simple/">https://pypi.doubanio.com/simple/</a> è±†ç“£</li>
<li><a href="https://mirrors.ustc.edu.cn/pypi/web/simple/">https://mirrors.ustc.edu.cn/pypi/web/simple/</a> ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦</li>
</ul>
<p>ä¸Šé¢çš„æºç«™éƒ½æµ‹è¯•è¿‡ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œé¦–é€‰é˜¿é‡Œäº‘ï¼Œå› ä¸ºç¡®å®å¿«</p>
<h3 id="2-ä¸´æ—¶æŒ‡å®šé•œåƒæº"><a href="#2-ä¸´æ—¶æŒ‡å®šé•œåƒæº" class="headerlink" title="2 ä¸´æ—¶æŒ‡å®šé•œåƒæº"></a>2 ä¸´æ—¶æŒ‡å®šé•œåƒæº</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> -i é•œåƒæºåœ°å€ åŒ…åç§°</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚å®‰è£… <code>django</code>ï¼Œé€‰ç”¨é˜¿é‡Œäº‘é•œåƒæºï¼Œåˆ™</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">pip install -i https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/pypi/</span>simple/ django</span><br></pre></td></tr></table></figure>

<h3 id="3-å…¨å±€è®¾ç½®é•œåƒæº"><a href="#3-å…¨å±€è®¾ç½®é•œåƒæº" class="headerlink" title="3 å…¨å±€è®¾ç½®é•œåƒæº"></a>3 å…¨å±€è®¾ç½®é•œåƒæº</h3><p>æˆ‘ä¸ªäººä½¿ç”¨çš„æ˜¯ macï¼Œæ­¥éª¤ï¼š</p>
<p>1 åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ <code>~/.config</code> ä¸­æ–°å»º <code>pip</code> æ–‡ä»¶å¤¹ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹å»ºç«‹ <code>.pip</code> æ–‡ä»¶å¤¹)</p>
<p>2 åœ¨ä¸Šä¸€æ­¥æ–°å»ºçš„æ–‡ä»¶ä¸­æ–°å»º <code>pip.conf</code></p>
<p>3 åœ¨ <code>pip.conf</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="keyword">global</span>]</span><br><span class="line">timeout = <span class="number">60</span></span><br><span class="line">index-url = https://mirrors.aliyun.com/pypi/simple</span><br><span class="line"></span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é˜…è§ˆå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://pip.pypa.io/en/stable/user_guide/#config-file">https://pip.pypa.io/en/stable/user_guide/#config-file</a></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">You can <span class="built_in">set</span> <span class="keyword">a</span> custom path location <span class="keyword">for</span> this config</span><br><span class="line"><span class="built_in">file</span> <span class="keyword">using</span> <span class="keyword">the</span> environment <span class="built_in">variable</span> PIP_CONFIG_FILE.</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œé…ç½®å¥½ç¯å¢ƒå˜é‡ <code>PIP_CONFIG_FILE</code> å³å¯ã€‚</p>
<p>åç»­å†å®‰è£… <code>python</code> åŒ…éƒ½ä¼šä½¿ç”¨è®¾ç½®å¥½çš„æºï¼ŒèŠ‚çœæ—¶é—´ã€‚</p>
]]></content>
      <categories>
        <category>èµ„æºåŠ é€Ÿ</category>
        <category>åç«¯</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>åŠ é€Ÿ</tag>
        <tag>é•œåƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>èµ„æºåŠ é€Ÿç³»åˆ—ä¹‹ pyenv</title>
    <url>/posts/22631/</url>
    <content><![CDATA[<p>å¯¹äº <code>python</code> ç›¸å…³çš„ä¸šåŠ¡ï¼Œæˆ‘éƒ½æ˜¯ä½¿ç”¨ <code>pyenv</code>ï¼Œæ¥ç®¡ç†æˆ‘æœ¬åœ°çš„ <code>python</code> ç‰ˆæœ¬ï¼Œç”±äºä¸åŒé¡¹ç›®çš„éœ€è¦ï¼Œæœ‰äº›é¡¹ç›®ä½¿ç”¨çš„ <code>python</code> ç‰ˆæœ¬éƒ½æ˜¯ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æœ¬åœ°å®‰è£…äº†ä¸åŒçš„ç‰ˆæœ¬ã€‚<span id="more"></span></p>
<h3 id="1-åŠ é€Ÿ"><a href="#1-åŠ é€Ÿ" class="headerlink" title="1 åŠ é€Ÿ"></a>1 åŠ é€Ÿ</h3><p>åˆšå¼€å§‹è£… <code>python</code>ï¼Œéƒ½æ˜¯æ‰§è¡Œ <code>pyenv install ç‰ˆæœ¬å·</code> è¿›è¡Œå®‰è£…ï¼Œä½†æ˜¯å‘ç°é€Ÿåº¦ï¼Œåœ¨å›½å†…ï¼Œä½ æ‡‚å¾—ï¼Œå¤ªæ…¢ï¼Œæ‰€ä»¥å°±å»æ‰¾é•œåƒï¼Œæˆ‘ä½¿ç”¨äº†æ·˜å®çš„é•œåƒï¼Œåœ°å€å¦‚ä¸‹</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">https:</span>//npm.taobao<span class="meta">.org</span>/mirrors/python/</span><br></pre></td></tr></table></figure>

<p>å…¶å®åŠ é€Ÿå°±æ˜¯ä»é•œåƒåœ°å€æŠŠæŒ‡å®šç‰ˆæœ¬çš„ <code>python</code> å‹ç¼©åŒ…ä¸‹è½½åˆ° <code>~/.pyenv/cache</code> ä¸‹é¢ï¼Œç„¶åæ‰§è¡Œ <code>pyenv install å¯¹åº”çš„ç‰ˆæœ¬å·</code> å³å¯ã€‚</p>
<p>ä¾‹å¦‚å®‰è£… 3.6.7 ç‰ˆæœ¬ï¼Œå‘½ä»¤è¡Œå¦‚ä¸‹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">v=<span class="number">3.6</span>.<span class="number">7</span>;wget https:<span class="regexp">//</span>npm.taobao.org<span class="regexp">/mirrors/</span>python<span class="regexp">/$v/</span>Python-<span class="variable">$v</span>.tar.xz -P ~<span class="regexp">/.pyenv/</span>cache/;pyenv install <span class="variable">$v</span></span><br></pre></td></tr></table></figure>

<h3 id="2-åšæˆå¯æ‰§è¡Œæ–‡ä»¶"><a href="#2-åšæˆå¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="2 åšæˆå¯æ‰§è¡Œæ–‡ä»¶"></a>2 åšæˆå¯æ‰§è¡Œæ–‡ä»¶</h3><p>æˆ‘ä¸ªäººæ˜¯æœ‰æ‡’ç™Œçš„ï¼Œå¦‚æœæ¯æ¬¡å®‰è£…å…¶ä»–ç‰ˆæœ¬ï¼Œéƒ½è¦è¿™ä¹ˆæ‰§è¡Œï¼Œè¾“å…¥ä¸€é•¿ä¸²ï¼Œå—ä¸é¸Ÿï¼Œé‚£å°±å°è£…æˆ <code>shell</code> è„šæœ¬ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">pyenvInstallPython</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">    v=<span class="variable">$1</span></span><br><span class="line">    wget https://npm.taobao.org/mirrors/python/<span class="variable">$v</span>/Python-<span class="variable">$v</span>.tar.xz -P ~/.pyenv/cache/;pyenv install <span class="variable">$v</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pyenvInstallPython $*</span><br></pre></td></tr></table></figure>

<p>ç„¶åæŠŠè¿™ä¸ªè„šæœ¬å†™åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæˆ‘èµ·çš„åå­—å«åš <code>pyversion</code>)ä¸­ï¼Œç„¶åæŠŠå¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ°å¯æ‰§è¡Œç›®å½•ä¸­ï¼ˆå³èƒ½åœ¨ <code>$PATH</code> æŒ‡å®šçš„è·¯å¾„ä¸­æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼‰ï¼Œæˆ‘ä¸ªäººçš„åšæ³•ï¼Œåœ¨æˆ‘çš„ç”¨æˆ·ç›®å½•å»ºç«‹äº†ä¸€ä¸ª <code>bin</code> ç›®å½•ï¼ˆåŠ å…¥åˆ° <code>$PATH</code> ä¸­å»ï¼‰ï¼Œç„¶åæŠŠ <code>pyversion</code> è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ° <code>~/bin</code> ä¸­å»ã€‚</p>
<p>å¥½äº†ï¼Œå¯ä»¥äº†ï¼Œåé¢æƒ³å®‰è£…å¯¹åº”çš„ç‰ˆæœ¬ï¼Œç›´æ¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">pyversion</span> ç‰ˆæœ¬å·</span><br></pre></td></tr></table></figure>

<h3 id="3-æµ‹è¯•"><a href="#3-æµ‹è¯•" class="headerlink" title="3 æµ‹è¯•"></a>3 æµ‹è¯•</h3><p>ä¾‹å¦‚æˆ‘è¦è£… 3.6.7 ç‰ˆæœ¬ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œ <code>pyversion 3.6.7</code>ï¼Œæ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">3.6.7</span><br><span class="line">--2016-10-22 01:16:10--  https://npm.taobao.org/mirrors/python/3.6.7/Python-3.6.7.tar.xz</span><br><span class="line">æ­£åœ¨è§£æä¸»æœº npm.taobao.org (npm.taobao.org)... 114.55.80.225</span><br><span class="line">æ­£åœ¨è¿æ¥ npm.taobao.org (npm.taobao.org)|114.55.80.225|:443... å·²è¿æ¥ã€‚</span><br><span class="line">å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 302 Found</span><br><span class="line">ä½ç½®ï¼šhttps://cdn.npm.taobao.org/dist/python/3.6.7/Python-3.6.7.tar.xz [è·Ÿéšè‡³æ–°çš„ URL]</span><br><span class="line">--2016-10-22 01:16:10--  https://cdn.npm.taobao.org/dist/python/3.6.7/Python-3.6.7.tar.xz</span><br><span class="line">æ­£åœ¨è§£æä¸»æœº cdn.npm.taobao.org (cdn.npm.taobao.org)... 119.147.111.226, 119.147.111.229, 113.105.168.156, ...</span><br><span class="line">æ­£åœ¨è¿æ¥ cdn.npm.taobao.org (cdn.npm.taobao.org)|119.147.111.226|:443... å·²è¿æ¥ã€‚</span><br><span class="line">å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 200 OK</span><br><span class="line">é•¿åº¦ï¼š17178476 (16M) [application/x-xz]</span><br><span class="line">æ­£åœ¨ä¿å­˜è‡³: â€œ/Users/kycool/.pyenv/cache/Python-3.6.7.tar.xzâ€</span><br><span class="line"></span><br><span class="line">Python-3.6.7.tar.xz              100%[========================================================&gt;]  16.38M  8.36MB/s  ç”¨æ—¶ 2.0s</span><br><span class="line"></span><br><span class="line">2016-10-22 01:16:12 (8.36 MB/s) - å·²ä¿å­˜ â€œ/Users/kycool/.pyenv/cache/Python-3.6.7.tar.xzâ€ [17178476/17178476])</span><br><span class="line"></span><br><span class="line">python-build: use openssl@1.1 from homebrew</span><br><span class="line">python-build: use readline from homebrew</span><br><span class="line">Installing Python-3.6.7...</span><br><span class="line">python-build: use readline from homebrew</span><br><span class="line">python-build: use zlib from xcode sdk</span><br><span class="line">Installed Python-3.6.7 to /Users/kycool/.pyenv/versions/3.6.7</span><br></pre></td></tr></table></figure>

<p>é€Ÿåº¦æœç„¶æ˜¯æ æ çš„ï¼Œå†è¾“å…¥ <code>pyenv versions</code> çœ‹ä¸‹</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">$ pyenv versions</span><br><span class="line">* <span class="keyword">system</span> (<span class="built_in">set</span> <span class="keyword">by</span> /Users/kycool/.pyenv/<span class="built_in">version</span>)</span><br><span class="line">  <span class="number">3.6</span><span class="number">.0</span></span><br><span class="line">  <span class="number">3.6</span><span class="number">.7</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ï¼Œåç»­å°±å¯ä»¥è¿™æ ·ç©äº†ï¼Œçœæ—¶çœåŠ›ã€‚</p>
]]></content>
      <categories>
        <category>èµ„æºåŠ é€Ÿ</category>
        <category>åç«¯</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>åŠ é€Ÿ</tag>
        <tag>é•œåƒ</tag>
      </tags>
  </entry>
</search>
